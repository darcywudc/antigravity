<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éš”éœ‡æ”¯åº§å—æ‹‰è„±ç©ºå¯è§†åŒ– | Seismic Uplift Visualization</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 50%, #16213e 100%);
            min-height: 100vh;
            color: #e0e0e0;
            overflow-x: hidden;
        }

        .container {
            max-width: 1500px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 25px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 25px;
        }

        .back-link {
            display: inline-block;
            color: #888;
            text-decoration: none;
            font-size: 0.85rem;
            margin-bottom: 10px;
        }

        .back-link:hover {
            color: #00d4ff;
        }

        h1 {
            font-size: 2rem;
            background: linear-gradient(90deg, #00d4ff, #7c3aed, #f472b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .subtitle {
            color: #888;
            font-size: 0.95rem;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 420px;
            gap: 25px;
        }

        @media (max-width: 1100px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
        }

        .viz-container {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            padding: 20px;
        }

        #canvas {
            width: 100%;
            height: 480px;
            background: linear-gradient(180deg, #1a1a2e 0%, #0f0f1a 100%);
            border-radius: 10px;
        }

        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 12px;
            padding: 12px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.75rem;
            color: #888;
        }

        .legend-color {
            width: 10px;
            height: 10px;
            border-radius: 2px;
        }

        .control-panel {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            padding: 20px;
            max-height: 85vh;
            overflow-y: auto;
        }

        .control-section {
            margin-bottom: 20px;
        }

        .control-section h3 {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #888;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .control-section h3::before {
            content: '';
            width: 3px;
            height: 14px;
            background: linear-gradient(180deg, #00d4ff, #7c3aed);
            border-radius: 2px;
        }

        .slider-group {
            margin-bottom: 15px;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .slider-label span {
            font-size: 0.85rem;
            color: #ccc;
        }

        .slider-value {
            font-family: 'JetBrains Mono', monospace;
            background: rgba(0, 212, 255, 0.15);
            padding: 3px 8px;
            border-radius: 5px;
            color: #00d4ff;
            font-size: 0.8rem;
        }

        input[type="range"] {
            width: 100%;
            height: 5px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background: linear-gradient(135deg, #00d4ff, #7c3aed);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.4);
        }

        .reaction-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }

        .reaction-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s;
        }

        .reaction-card.low-preload {
            border-color: rgba(255, 165, 0, 0.4);
            background: rgba(255, 165, 0, 0.1);
        }

        .reaction-card.uplift {
            border-color: rgba(255, 107, 107, 0.5);
            background: rgba(255, 107, 107, 0.15);
            animation: pulse-danger 1s infinite;
        }

        @keyframes pulse-danger {

            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.3);
            }

            50% {
                box-shadow: 0 0 15px 3px rgba(255, 107, 107, 0.15);
            }
        }

        .reaction-label {
            font-size: 0.7rem;
            color: #888;
            margin-bottom: 4px;
        }

        .reaction-value {
            font-size: 1rem;
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
        }

        .reaction-card.compression .reaction-value {
            color: #2ed573;
        }

        .reaction-card.low-preload .reaction-value {
            color: #ffa502;
        }

        .reaction-card.uplift .reaction-value {
            color: #ff6b6b;
        }

        .reaction-slider {
            margin-top: 8px;
        }

        .reaction-slider input {
            height: 4px;
        }

        .stats-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .stat-card.overturn {
            border-color: rgba(255, 107, 107, 0.3);
        }

        .stat-card.resist {
            border-color: rgba(46, 213, 115, 0.3);
        }

        .stat-label {
            font-size: 0.7rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }

        .stat-card.overturn .stat-value {
            color: #ff6b6b;
        }

        .stat-card.resist .stat-value {
            color: #2ed573;
        }

        .stat-unit {
            font-size: 0.65rem;
            color: #666;
            margin-left: 2px;
        }

        .insight-box {
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.15), rgba(0, 212, 255, 0.1));
            border: 1px solid rgba(124, 58, 237, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .insight-title {
            font-size: 0.8rem;
            color: #7c3aed;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .insight-content {
            font-size: 0.85rem;
            color: #ccc;
            line-height: 1.6;
        }

        .insight-highlight {
            color: #00d4ff;
            font-weight: 600;
        }

        .formula-box {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 12px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
        }

        .formula-title {
            color: #888;
            font-size: 0.7rem;
            margin-bottom: 6px;
        }

        .formula {
            color: #00d4ff;
            margin-bottom: 4px;
        }

        .formula-vars {
            color: #666;
            font-size: 0.7rem;
            line-height: 1.5;
        }

        .var-highlight {
            color: #f472b6;
        }

        .preset-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .preset-btn {
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: #aaa;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .preset-btn:hover {
            background: rgba(0, 212, 255, 0.2);
            border-color: rgba(0, 212, 255, 0.3);
            color: #00d4ff;
        }

        .preset-btn.active {
            background: rgba(0, 212, 255, 0.25);
            border-color: rgba(0, 212, 255, 0.4);
            color: #00d4ff;
        }

        .alert-banner {
            background: linear-gradient(90deg, rgba(255, 107, 107, 0.2), rgba(255, 107, 107, 0.1));
            border: 1px solid rgba(255, 107, 107, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin-top: 15px;
            display: none;
        }

        .alert-banner.show {
            display: block;
        }

        .alert-title {
            color: #ff6b6b;
            font-weight: 600;
            font-size: 0.85rem;
            margin-bottom: 4px;
        }

        .alert-text {
            color: #ccc;
            font-size: 0.8rem;
            line-height: 1.4;
        }

        .animation-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            background: rgba(124, 58, 237, 0.2);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid rgba(124, 58, 237, 0.3);
            margin-top: 10px;
        }

        .animation-toggle:hover {
            background: rgba(124, 58, 237, 0.3);
        }

        .animation-toggle.active {
            background: rgba(124, 58, 237, 0.4);
            border-color: rgba(124, 58, 237, 0.6);
        }

        .toggle-icon {
            font-size: 1rem;
        }

        .toggle-text {
            font-size: 0.8rem;
        }

        /* Center of gravity indicator */
        .cog-indicator {
            background: rgba(255, 165, 2, 0.1);
            border: 1px solid rgba(255, 165, 2, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
        }

        .cog-label {
            font-size: 0.75rem;
            color: #888;
            margin-bottom: 5px;
        }

        .cog-value {
            font-size: 1rem;
            font-weight: 600;
            color: #ffa502;
            font-family: 'JetBrains Mono', monospace;
        }

        .cog-effect {
            font-size: 0.7rem;
            color: #666;
            margin-top: 5px;
        }

        .info-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 20px;
        }

        @media (max-width: 900px) {
            .info-cards {
                grid-template-columns: 1fr;
            }
        }

        .info-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .info-card h4 {
            color: #00d4ff;
            font-size: 0.85rem;
            margin-bottom: 8px;
        }

        .info-card p {
            color: #888;
            font-size: 0.8rem;
            line-height: 1.5;
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-link">â† è¿”å›æ¦‚è§ˆ</a>
            <h1>ğŸ¢ éš”éœ‡æ”¯åº§å—æ‹‰è„±ç©ºå¯è§†åŒ–</h1>
            <p class="subtitle">Seismic Isolation Bearing Uplift - è€ƒè™‘åˆå§‹ååŠ›ä¸å‡åŒ€åˆ†å¸ƒ</p>
        </header>

        <div class="main-layout">
            <div class="viz-container">
                <canvas id="canvas"></canvas>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ff6b6b;"></div>
                        <span>å€¾è¦†åŠ›çŸ© M<sub>o</sub></span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #2ed573;"></div>
                        <span>æŠ—å€¾è¦†åŠ›çŸ© M<sub>r</sub></span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #00d4ff;"></div>
                        <span>åœ°éœ‡åŠ› F</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ffa502;"></div>
                        <span>è´¨å¿ƒ C<sub>M</sub></span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #f472b6;"></div>
                        <span>åˆšå¿ƒ C<sub>S</sub></span>
                    </div>
                </div>
            </div>

            <div class="control-panel">
                <div class="insight-box">
                    <div class="insight-title">ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µ</div>
                    <div class="insight-content">
                        <span class="insight-highlight">å€¾è¦†åŠ›çŸ©</span> M<sub>o</sub> = F Ã— Hï¼ˆåœ°éœ‡åŠ› Ã— é«˜åº¦ï¼‰<br>
                        <span class="insight-highlight">æŠ—å€¾è¦†åŠ›çŸ©</span> M<sub>r</sub> = W Ã— B/2ï¼ˆé‡é‡ Ã— åº•éƒ¨åŠå®½ï¼‰<br>
                        <strong>æ”¯åº§ååŠ›ä¸å‡åŒ€ â†’ åˆšåº¦ä¸­å¿ƒ(C<sub>S</sub>)åç§» â†’ æ‰­è½¬è€¦åˆï¼</strong>
                    </div>
                </div>

                <div class="control-section">
                    <h3>å»ºç­‘å‚æ•°</h3>

                    <div class="slider-group">
                        <div class="slider-label">
                            <span>é«˜åº¦ H</span>
                            <span class="slider-value" id="height-value">30 m</span>
                        </div>
                        <input type="range" id="height-slider" min="10" max="80" value="30">
                    </div>

                    <div class="slider-group">
                        <div class="slider-label">
                            <span>å®½åº¦ B</span>
                            <span class="slider-value" id="width-value">24 m</span>
                        </div>
                        <input type="range" id="width-slider" min="12" max="48" value="24">
                    </div>

                    <div class="slider-group">
                        <div class="slider-label">
                            <span>æ€»é‡ W</span>
                            <span class="slider-value" id="weight-value">6000 kN</span>
                        </div>
                        <input type="range" id="weight-slider" min="2000" max="20000" value="6000" step="100">
                    </div>
                </div>

                <div class="control-section">
                    <h3>åœ°éœ‡ä½œç”¨</h3>

                    <div class="slider-group">
                        <div class="slider-label">
                            <span>æ°´å¹³åœ°éœ‡åŠ› Fï¼ˆå‘å³ä¸ºæ­£ï¼‰</span>
                            <span class="slider-value" id="force-value">0 kN</span>
                        </div>
                        <input type="range" id="force-slider" min="-4000" max="4000" value="0" step="50">
                    </div>

                    <div class="animation-toggle" id="animate-toggle">
                        <span class="toggle-icon">ğŸŒŠ</span>
                        <span class="toggle-text">æ¨¡æ‹Ÿåœ°éœ‡å¾€å¤ä½œç”¨</span>
                    </div>
                </div>

                <div class="control-section">
                    <h3>â­ åˆå§‹æ”¯åº§ååŠ›åˆ†é…</h3>
                    <p style="font-size: 0.75rem; color: #888; margin-bottom: 10px;">
                        è°ƒèŠ‚å„æ”¯åº§çš„åˆå§‹é¢„å‹åŠ›ã€‚ä¸å‡åŒ€åˆ†å¸ƒä¼šå¯¼è‡´<strong>åˆšåº¦ä¸­å¿ƒåç§»</strong>ï¼
                    </p>

                    <div class="preset-buttons">
                        <button class="preset-btn active" data-preset="uniform">å‡åŒ€åˆ†å¸ƒ</button>
                        <button class="preset-btn" data-preset="left-heavy">å·¦ä¾§åé‡</button>
                        <button class="preset-btn" data-preset="right-heavy">å³ä¾§åé‡</button>
                    </div>

                    <div class="reaction-grid" id="reaction-grid"></div>
                </div>

                <!-- Center of Stiffness Indicator -->
                <div class="cog-indicator">
                    <div class="cog-label">åˆšåº¦ä¸­å¿ƒåç§» (C<sub>S</sub> - C<sub>M</sub>)</div>
                    <div class="cog-value" id="cog-value">0.00 mï¼ˆä¸è´¨å¿ƒé‡åˆï¼‰</div>
                    <div class="cog-effect" id="cog-effect">æ— æ‰­è½¬è€¦åˆ</div>
                </div>

                <div class="control-section">
                    <h3>åŠ›çŸ©åˆ†æ</h3>

                    <div class="stats-row">
                        <div class="stat-card overturn">
                            <div class="stat-label">å€¾è¦†åŠ›çŸ© M<sub>o</sub></div>
                            <div class="stat-value" id="overturn-moment">0<span class="stat-unit">kNÂ·m</span></div>
                        </div>
                        <div class="stat-card resist">
                            <div class="stat-label">æŠ—å€¾è¦†åŠ›çŸ© M<sub>r</sub></div>
                            <div class="stat-value" id="resist-moment">72000<span class="stat-unit">kNÂ·m</span></div>
                        </div>
                    </div>

                    <div class="formula-box">
                        <div class="formula-title">å…³é”®å…¬å¼</div>
                        <div class="formula">M<sub>o</sub> = F Ã— Hï¼ˆå€¾è¦†åŠ›çŸ©ï¼‰</div>
                        <div class="formula">M<sub>r</sub> = W Ã— B/2ï¼ˆæŠ—å€¾è¦†åŠ›çŸ©ï¼‰</div>
                        <div class="formula">e = C<sub>S</sub> - C<sub>M</sub>ï¼ˆåå¿ƒè·ï¼‰</div>
                        <div class="formula-vars">
                            <span class="var-highlight">e â‰  0</span> æ—¶äº§ç”Ÿæ‰­è½¬ï¼šM<sub>T</sub> = F Ã— e
                        </div>
                    </div>
                </div>

                <div class="control-section">
                    <h3>åœ°éœ‡æ—¶æ”¯åº§åº”åŠ›çŠ¶æ€</h3>
                    <div id="stress-display"></div>
                </div>

                <div class="alert-banner" id="alert-banner">
                    <div class="alert-title">âš ï¸ æ”¯åº§è„±ç©ºè­¦å‘Š</div>
                    <div class="alert-text" id="alert-text">æ£€æµ‹åˆ°æ”¯åº§è„±ç©ºï¼</div>
                </div>
            </div>
        </div>

        <div class="info-cards">
            <div class="info-card">
                <h4>ğŸ“ å€¾è¦†åŠ›çŸ©ä¸æŠ—å€¾è¦†åŠ›çŸ©</h4>
                <p>
                    <strong>å€¾è¦†åŠ›çŸ©</strong> M<sub>o</sub> = F Ã— Hï¼šåœ°éœ‡åŠ›è¶Šå¤§ã€å»ºç­‘è¶Šé«˜ï¼Œå€¾è¦†åŠ›çŸ©è¶Šå¤§ã€‚<br>
                    <strong>æŠ—å€¾è¦†åŠ›çŸ©</strong> M<sub>r</sub> = W Ã— dï¼šé‡é‡è¶Šå¤§ã€é‡å¿ƒåˆ°å€¾è¦†ç‚¹è·ç¦»è¶Šè¿œï¼ŒæŠ—å€¾è¦†èƒ½åŠ›è¶Šå¼ºã€‚
                </p>
            </div>
            <div class="info-card">
                <h4>âš¡ C<sub>M</sub> vs C<sub>S</sub></h4>
                <p>
                    <strong>è´¨å¿ƒ C<sub>M</sub></strong>ï¼šç”±è´¨é‡åˆ†å¸ƒå†³å®šï¼Œå›ºå®šä¸å˜ã€‚<br>
                    <strong>åˆšå¿ƒ C<sub>S</sub></strong>ï¼šç”±æ”¯åº§åˆšåº¦åˆ†å¸ƒå†³å®šï¼ŒéšååŠ›å˜åŒ–ã€‚<br>
                    å½“ C<sub>M</sub> â‰  C<sub>S</sub> æ—¶ï¼Œåœ°éœ‡åŠ›ä¼šäº§ç”Ÿ<strong>æ‰­è½¬è€¦åˆ</strong>ï¼
                </p>
            </div>
            <div class="info-card">
                <h4>ğŸ”„ åº”åŠ›ä¸‹å˜åŒ–</h4>
                <p>
                    åœ°éœ‡åŠ›å‘å³ â†’ å·¦ä¾§æ”¯åº§å‡å‹ï¼ˆå¯èƒ½è„±ç©ºï¼‰<br>
                    åœ°éœ‡åŠ›å‘å·¦ â†’ å³ä¾§æ”¯åº§å‡å‹ï¼ˆå¯èƒ½è„±ç©ºï¼‰<br>
                    åˆå§‹é¢„å‹åŠ›å°çš„æ”¯åº§æ›´å®¹æ˜“å…ˆè„±ç©ºã€‚
                </p>
            </div>
            <div class="info-card">
                <h4>ğŸ”§ å·¥ç¨‹å¯¹ç­–</h4>
                <p>
                    1. ä¼˜åŒ–ç»“æ„å¸ƒç½®ï¼Œç¡®ä¿é¢„å‹åŠ›å‡åŒ€<br>
                    2. å¢åŠ å»ºç­‘å®½åº¦æˆ–é‡é‡<br>
                    3. é‡‡ç”¨æŠ—æ‹‰éš”éœ‡æ”¯åº§<br>
                    4. è®¾ç½®æŠ—æ‹‰è£…ç½®
                </p>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            const rect = canvas.parentElement.getBoundingClientRect();
            canvas.width = rect.width - 40;
            canvas.height = 480;
        }
        resizeCanvas();
        window.addEventListener('resize', () => { resizeCanvas(); draw(); });

        const NUM_SUPPORTS = 6;

        let state = {
            height: 30,
            width: 24,
            weight: 6000,
            force: 0, // Can be negative (left) or positive (right)
            reactions: new Array(NUM_SUPPORTS).fill(1 / NUM_SUPPORTS)
        };

        let isAnimating = false;
        let animationPhase = 0;

        // DOM Elements
        const heightSlider = document.getElementById('height-slider');
        const widthSlider = document.getElementById('width-slider');
        const weightSlider = document.getElementById('weight-slider');
        const forceSlider = document.getElementById('force-slider');
        const heightValue = document.getElementById('height-value');
        const widthValue = document.getElementById('width-value');
        const weightValue = document.getElementById('weight-value');
        const forceValue = document.getElementById('force-value');
        const overturnMoment = document.getElementById('overturn-moment');
        const resistMoment = document.getElementById('resist-moment');
        const reactionGrid = document.getElementById('reaction-grid');
        const stressDisplay = document.getElementById('stress-display');
        const alertBanner = document.getElementById('alert-banner');
        const alertText = document.getElementById('alert-text');
        const animateToggle = document.getElementById('animate-toggle');
        const cogValue = document.getElementById('cog-value');
        const cogEffect = document.getElementById('cog-effect');

        // Preset distributions
        const presets = {
            'uniform': () => new Array(NUM_SUPPORTS).fill(1 / NUM_SUPPORTS),
            'left-heavy': () => {
                const arr = [];
                for (let i = 0; i < NUM_SUPPORTS; i++) {
                    arr.push((NUM_SUPPORTS - i) / ((NUM_SUPPORTS + 1) * NUM_SUPPORTS / 2));
                }
                return arr;
            },
            'right-heavy': () => {
                const arr = [];
                for (let i = 0; i < NUM_SUPPORTS; i++) {
                    arr.push((i + 1) / ((NUM_SUPPORTS + 1) * NUM_SUPPORTS / 2));
                }
                return arr;
            }
        };

        // Create reaction sliders
        function createReactionGrid() {
            reactionGrid.innerHTML = '';
            for (let i = 0; i < NUM_SUPPORTS; i++) {
                const card = document.createElement('div');
                card.className = 'reaction-card compression';
                card.id = `reaction-card-${i}`;
                card.innerHTML = `
                    <div class="reaction-label">æ”¯åº§ ${i + 1}</div>
                    <div class="reaction-value" id="reaction-value-${i}">${(state.reactions[i] * 100).toFixed(1)}%</div>
                    <div class="reaction-slider">
                        <input type="range" id="reaction-slider-${i}" min="0" max="50" value="${state.reactions[i] * 100}" step="0.5">
                    </div>
                `;
                reactionGrid.appendChild(card);

                document.getElementById(`reaction-slider-${i}`).addEventListener('input', (e) => {
                    updateReaction(i, parseFloat(e.target.value) / 100);
                });
            }
        }

        function createStressDisplay() {
            stressDisplay.innerHTML = '';
            for (let i = 0; i < NUM_SUPPORTS; i++) {
                const row = document.createElement('div');
                row.className = 'reaction-card compression';
                row.id = `stress-card-${i}`;
                row.style.cssText = 'padding: 8px; margin-bottom: 6px; display: flex; justify-content: space-between; align-items: center;';
                row.innerHTML = `
                    <span style="font-size: 0.75rem; color: #aaa;">æ”¯åº§ ${i + 1}</span>
                    <span class="reaction-value" id="stress-value-${i}" style="font-size: 0.9rem;">+100 kPa</span>
                `;
                stressDisplay.appendChild(row);
            }
        }

        function updateReaction(index, value) {
            state.reactions[index] = value;
            const sum = state.reactions.reduce((a, b) => a + b, 0);
            if (sum > 0) {
                state.reactions = state.reactions.map(r => r / sum);
            }
            for (let i = 0; i < NUM_SUPPORTS; i++) {
                document.getElementById(`reaction-value-${i}`).textContent = `${(state.reactions[i] * 100).toFixed(1)}%`;
                document.getElementById(`reaction-slider-${i}`).value = state.reactions[i] * 100;
            }
            draw();
        }

        // Preset buttons
        document.querySelectorAll('.preset-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                state.reactions = presets[btn.dataset.preset]();
                for (let i = 0; i < NUM_SUPPORTS; i++) {
                    document.getElementById(`reaction-value-${i}`).textContent = `${(state.reactions[i] * 100).toFixed(1)}%`;
                    document.getElementById(`reaction-slider-${i}`).value = state.reactions[i] * 100;
                }
                draw();
            });
        });

        // Calculate center of stiffness offset and stresses
        function calculate() {
            const supportSpacing = state.width / (NUM_SUPPORTS - 1);
            const supportPositions = [];
            for (let i = 0; i < NUM_SUPPORTS; i++) {
                supportPositions.push(-state.width / 2 + i * supportSpacing);
            }

            // Calculate center of stiffness (CS) based on reaction/stiffness distribution
            // CS = Î£(xi * Ki) / Î£(Ki), where Ki is proportional to reaction
            // Center of mass (CM) is assumed at geometric center (x=0)
            let csX = 0;
            for (let i = 0; i < NUM_SUPPORTS; i++) {
                csX += supportPositions[i] * state.reactions[i];
            }
            // csX is the offset of CS from CM (which is at center)
            // Eccentricity e = CS - CM = csX - 0 = csX

            // Determine pivot point based on force direction
            const forceDir = state.force >= 0 ? 1 : -1;
            const pivotX = forceDir * state.width / 2;

            // Overturning moment (always positive for calculation)
            const Mo = Math.abs(state.force) * state.height;

            // Resisting moment: W Ã— B/2 (does not change with CS position!)
            // CM is fixed at center, so arm is always width/2
            const Mr = state.weight * state.width / 2;

            // Calculate stress changes at each support due to overturning moment
            // Using beam bending analogy: Ïƒ = M Ã— y / I
            let I = 0;
            for (let i = 0; i < NUM_SUPPORTS; i++) {
                I += Math.pow(supportPositions[i], 2);
            }

            const stresses = [];
            let hasUplift = false;
            const upliftSupports = [];

            for (let i = 0; i < NUM_SUPPORTS; i++) {
                const x = supportPositions[i];
                const initialForce = state.reactions[i] * state.weight;
                const sigma0 = initialForce / (state.width / NUM_SUPPORTS);

                // Stress change due to moment:
                // Force to RIGHT (positive): left side (x < 0) loses compression
                // Force to LEFT (negative): right side (x > 0) loses compression
                // deltaSigma = -(forceDir) Ã— M Ã— x / I
                // When force > 0: left (x<0) gets deltaSigma = -1 Ã— M Ã— (-|x|) / I = +MÃ—|x|/I... wait, that's wrong
                // Let me think again:
                // - Force to right causes clockwise rotation around right pivot
                // - Left side lifts up (tension), right side pushes down (more compression)
                // - For left support (x < 0), stress should DECREASE
                // - deltaSigma should be proportional to -forceDir Ã— x (so left support with x<0 and forceDir=1 gets deltaSigma < 0)
                // Actually: deltaSigma = Mo Ã— (pivotX - x) / I... no
                // 
                // Simple approach: linear stress distribution
                // At x = -width/2 (left edge): maximum reduction
                // At x = +width/2 (right edge): maximum increase
                // deltaSigma at position x = Mo Ã— x / (I Ã— constant)
                // For force to right: left reduces, so deltaSigma âˆ x (negative x = negative deltaSigma)
                // But we need to flip sign based on force direction
                const deltaSigma = forceDir * Mo * x / I * 0.1;

                const sigma = sigma0 + deltaSigma;
                stresses.push(sigma);

                if (sigma < 0) {
                    hasUplift = true;
                    upliftSupports.push(i + 1);
                }
            }

            return {
                Mo, Mr, csX, stresses, hasUplift, upliftSupports,
                supportPositions, forceDir, pivotX,
                torsionMoment: Math.abs(state.force) * Math.abs(csX) // MT = F Ã— e
            };
        }

        function updateDisplays() {
            const calc = calculate();

            // Update moments
            overturnMoment.innerHTML = `${calc.Mo.toFixed(0)}<span class="stat-unit">kNÂ·m</span>`;
            resistMoment.innerHTML = `${calc.Mr.toFixed(0)}<span class="stat-unit">kNÂ·m</span>`;

            // Update CS indicator (eccentricity = CS - CM)
            const csDir = calc.csX > 0.1 ? 'åå³' : calc.csX < -0.1 ? 'åå·¦' : 'å±…ä¸­';
            cogValue.textContent = `${Math.abs(calc.csX).toFixed(2)} mï¼ˆ${csDir}ï¼‰`;

            if (Math.abs(calc.csX) < 0.1) {
                cogEffect.textContent = 'æ— æ‰­è½¬è€¦åˆ';
                cogEffect.style.color = '#2ed573';
            } else {
                // Torsion occurs when CS â‰  CM
                const Mt = calc.torsionMoment;
                cogEffect.innerHTML = `âš ï¸ æ‰­è½¬åŠ›çŸ© M<sub>T</sub> = ${Mt.toFixed(0)} kNÂ·m`;
                cogEffect.style.color = '#f472b6';
            }

            // Update stress cards
            const maxStress = Math.max(...calc.stresses.map(Math.abs), 1);
            for (let i = 0; i < NUM_SUPPORTS; i++) {
                const sigma = calc.stresses[i];
                const card = document.getElementById(`stress-card-${i}`);
                const valueEl = document.getElementById(`stress-value-${i}`);

                valueEl.textContent = `${sigma >= 0 ? '+' : ''}${sigma.toFixed(1)} kPa`;

                if (sigma < 0) {
                    card.className = 'reaction-card uplift';
                    valueEl.style.color = '#ff6b6b';
                } else if (sigma < maxStress * 0.2) {
                    card.className = 'reaction-card low-preload';
                    valueEl.style.color = '#ffa502';
                } else {
                    card.className = 'reaction-card compression';
                    valueEl.style.color = '#2ed573';
                }
            }

            // Alert banner
            if (calc.hasUplift) {
                alertBanner.classList.add('show');
                const side = calc.forceDir > 0 ? 'å·¦ä¾§' : 'å³ä¾§';
                alertText.innerHTML = `${side}æ”¯åº§ ${calc.upliftSupports.join(', ')} å‡ºç°æ‹‰åº”åŠ›ï¼ˆè„±ç©ºï¼‰ï¼<br>
                    <span style="font-size: 0.75rem;">åœ°éœ‡åŠ›å‘${calc.forceDir > 0 ? 'å³' : 'å·¦'}ï¼Œ${side}æ”¯åº§è¢«æ‹‰èµ·ã€‚</span>`;
            } else {
                alertBanner.classList.remove('show');
            }

            return calc;
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const calc = updateDisplays();

            const groundY = canvas.height - 100;
            const centerX = canvas.width / 2;
            const scaleH = 280 / 80;
            const scaleW = 350 / 48;
            const buildingH = state.height * scaleH;
            const buildingW = state.width * scaleW;

            // Tilt based on Mo vs Mr
            const maxTilt = 0.08;
            const tiltFactor = calc.Mr > 0 ? Math.min(1, calc.Mo / calc.Mr) : 1;
            const tilt = state.force !== 0 ? tiltFactor * maxTilt * calc.forceDir : 0;

            // Ground
            ctx.beginPath();
            ctx.moveTo(0, groundY);
            ctx.lineTo(canvas.width, groundY);
            ctx.strokeStyle = '#444';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Ground hatching
            ctx.beginPath();
            for (let x = 0; x < canvas.width; x += 15) {
                ctx.moveTo(x, groundY);
                ctx.lineTo(x - 10, groundY + 12);
            }
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 1;
            ctx.stroke();

            ctx.save();
            ctx.translate(centerX, groundY);
            ctx.rotate(tilt);

            // Draw supports
            const supportSpacing = buildingW / (NUM_SUPPORTS - 1);
            const supportWidth = 22;
            const supportHeight = 14;
            const maxStress = Math.max(...calc.stresses.map(Math.abs), 1);

            for (let i = 0; i < NUM_SUPPORTS; i++) {
                const x = -buildingW / 2 + i * supportSpacing;
                const sigma = calc.stresses[i];

                let color = '#2ed573';
                if (sigma < 0) color = '#ff6b6b';
                else if (sigma < maxStress * 0.2) color = '#ffa502';

                const sizeScale = 0.6 + state.reactions[i] * NUM_SUPPORTS * 0.4;
                const sw = supportWidth * sizeScale;
                const sh = supportHeight * sizeScale;

                ctx.fillStyle = color;
                ctx.fillRect(x - sw / 2, -sh, sw, sh);
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 1;
                ctx.strokeRect(x - sw / 2, -sh, sw, sh);

                // Stress bar
                const barHeight = Math.abs(sigma) / maxStress * 25;
                ctx.fillStyle = sigma >= 0 ? 'rgba(46, 213, 115, 0.5)' : 'rgba(255, 107, 107, 0.5)';
                if (sigma >= 0) {
                    ctx.fillRect(x - 3, 10, 6, barHeight);
                } else {
                    ctx.fillRect(x - 3, 10 - barHeight, 6, barHeight);
                }
            }

            // Building
            const buildingGrad = ctx.createLinearGradient(-buildingW / 2, -buildingH - supportHeight, buildingW / 2, -supportHeight);
            buildingGrad.addColorStop(0, '#3d5a80');
            buildingGrad.addColorStop(1, '#293241');

            ctx.fillStyle = buildingGrad;
            ctx.fillRect(-buildingW / 2, -supportHeight - buildingH, buildingW, buildingH);
            ctx.strokeStyle = '#5c7a99';
            ctx.lineWidth = 2;
            ctx.strokeRect(-buildingW / 2, -supportHeight - buildingH, buildingW, buildingH);

            // Floors
            const numFloors = Math.floor(state.height / 3);
            const floorHeight = buildingH / numFloors;
            ctx.strokeStyle = 'rgba(255,255,255,0.12)';
            ctx.lineWidth = 1;
            for (let i = 1; i < numFloors; i++) {
                const y = -supportHeight - i * floorHeight;
                ctx.beginPath();
                ctx.moveTo(-buildingW / 2, y);
                ctx.lineTo(buildingW / 2, y);
                ctx.stroke();
            }

            // Center of Mass (CM) - fixed at geometric center
            const comY = -supportHeight - buildingH * 0.5;
            const cmX = 0; // CM is always at center (for symmetric building)

            // Center of Stiffness (CS) - varies with stiffness distribution
            const csX_px = calc.csX * (buildingW / state.width); // Scale to pixel

            // Draw CM (Center of Mass) - orange circle
            ctx.beginPath();
            ctx.arc(cmX, comY, 8, 0, Math.PI * 2);
            ctx.fillStyle = '#ffa502';
            ctx.fill();
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            ctx.stroke();

            ctx.font = 'bold 10px Inter';
            ctx.fillStyle = '#ffa502';
            ctx.fillText('CM', cmX + 12, comY + 4);

            // Draw CS (Center of Stiffness) - pink circle
            ctx.beginPath();
            ctx.arc(csX_px, comY + 30, 8, 0, Math.PI * 2);
            ctx.fillStyle = '#f472b6';
            ctx.fill();
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            ctx.stroke();

            ctx.fillStyle = '#f472b6';
            ctx.fillText('CS', csX_px + 12, comY + 34);

            // Eccentricity indicator (e = CS - CM)
            if (Math.abs(calc.csX) > 0.1) {
                // Dashed line showing eccentricity
                ctx.beginPath();
                ctx.setLineDash([4, 4]);
                ctx.moveTo(cmX, comY + 30);
                ctx.lineTo(csX_px, comY + 30);
                ctx.strokeStyle = '#f472b6';
                ctx.lineWidth = 2;
                ctx.stroke();
                ctx.setLineDash([]);

                // Eccentricity label
                ctx.font = '11px JetBrains Mono';
                ctx.fillStyle = '#f472b6';
                const eLabel = `e = ${Math.abs(calc.csX).toFixed(2)}m`;
                ctx.fillText(eLabel, (cmX + csX_px) / 2 - 20, comY + 50);
            }

            // Weight arrow (from CM)
            ctx.beginPath();
            ctx.moveTo(cmX, comY);
            ctx.lineTo(cmX, comY + 40);
            ctx.strokeStyle = '#ffa502';
            ctx.lineWidth = 3;
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(cmX, comY + 40);
            ctx.lineTo(cmX - 6, comY + 32);
            ctx.lineTo(cmX + 6, comY + 32);
            ctx.closePath();
            ctx.fillStyle = '#ffa502';
            ctx.fill();

            ctx.font = 'bold 11px Inter';
            ctx.fillStyle = '#ffa502';
            ctx.fillText('W', cmX - 25, comY + 25);

            // Seismic force arrow
            if (state.force !== 0) {
                const forceScale = Math.min(80, Math.abs(state.force) / 30);
                const dir = calc.forceDir;

                // Arrow points in direction of force
                const startX = dir > 0 ? -buildingW / 2 - forceScale - 10 : buildingW / 2 + 10;
                const endX = dir > 0 ? -buildingW / 2 - 10 : buildingW / 2 + forceScale + 10;

                ctx.beginPath();
                ctx.moveTo(startX, comY);
                ctx.lineTo(endX, comY);
                ctx.strokeStyle = '#00d4ff';
                ctx.lineWidth = 4;
                ctx.stroke();

                // Arrow head
                const tipX = dir > 0 ? -buildingW / 2 - 10 : buildingW / 2 + 10;
                ctx.beginPath();
                ctx.moveTo(tipX, comY);
                ctx.lineTo(tipX - 12 * dir, comY - 8);
                ctx.lineTo(tipX - 12 * dir, comY + 8);
                ctx.closePath();
                ctx.fillStyle = '#00d4ff';
                ctx.fill();

                ctx.font = 'bold 12px Inter';
                ctx.fillStyle = '#00d4ff';
                const forceLabel = dir > 0 ? 'F â†’' : 'â† F';
                ctx.fillText(forceLabel, startX + (dir > 0 ? 0 : forceScale - 30), comY - 15);

                // Moment arcs
                const pivotX = calc.pivotX * (buildingW / state.width);

                // Overturning moment arc
                ctx.beginPath();
                if (dir > 0) {
                    ctx.arc(pivotX, 0, 35, -Math.PI / 2, Math.PI / 2, false);
                } else {
                    ctx.arc(pivotX, 0, 35, Math.PI / 2, -Math.PI / 2, false);
                }
                ctx.strokeStyle = 'rgba(255, 107, 107, 0.6)';
                ctx.lineWidth = 3;
                ctx.stroke();

                ctx.font = 'bold 11px Inter';
                ctx.fillStyle = '#ff6b6b';
                ctx.fillText('Mo', pivotX + 45 * dir, 5);

                // Resisting moment arc
                ctx.beginPath();
                if (dir > 0) {
                    ctx.arc(pivotX, 0, 50, Math.PI / 2, -Math.PI / 2, false);
                } else {
                    ctx.arc(pivotX, 0, 50, -Math.PI / 2, Math.PI / 2, false);
                }
                ctx.strokeStyle = 'rgba(46, 213, 115, 0.6)';
                ctx.lineWidth = 3;
                ctx.stroke();

                ctx.fillStyle = '#2ed573';
                ctx.fillText('Mr', pivotX + 60 * dir, -20);
            }

            ctx.restore();

            // Labels
            ctx.font = '11px Inter';
            ctx.fillStyle = '#666';
            ctx.fillText(`H = ${state.height}m`, centerX + buildingW / 2 + 30, groundY - buildingH / 2);
            ctx.fillText(`B = ${state.width}m`, centerX - 20, groundY + 55);

            const aspectRatio = state.height / state.width;
            ctx.font = 'bold 12px Inter';
            ctx.fillStyle = aspectRatio > 3 ? '#ff6b6b' : aspectRatio > 2 ? '#ffa502' : '#2ed573';
            ctx.fillText(`é«˜å®½æ¯” H/B = ${aspectRatio.toFixed(2)}`, 20, 25);

            ctx.font = '10px Inter';
            ctx.fillStyle = '#888';
            ctx.fillText('æ”¯åº§å¤§å° âˆ åˆå§‹é¢„å‹åŠ›', 20, 42);
        }

        // Event listeners
        heightSlider.addEventListener('input', (e) => {
            state.height = parseInt(e.target.value);
            heightValue.textContent = `${state.height} m`;
            draw();
        });

        widthSlider.addEventListener('input', (e) => {
            state.width = parseInt(e.target.value);
            widthValue.textContent = `${state.width} m`;
            draw();
        });

        weightSlider.addEventListener('input', (e) => {
            state.weight = parseInt(e.target.value);
            weightValue.textContent = `${state.weight} kN`;
            draw();
        });

        forceSlider.addEventListener('input', (e) => {
            state.force = parseInt(e.target.value);
            const dir = state.force > 0 ? 'â†’' : state.force < 0 ? 'â†' : '';
            forceValue.textContent = `${Math.abs(state.force)} kN ${dir}`;
            draw();
        });

        // Animation
        animateToggle.addEventListener('click', () => {
            isAnimating = !isAnimating;
            animateToggle.classList.toggle('active', isAnimating);
            if (isAnimating) animate();
        });

        function animate() {
            if (!isAnimating) return;

            animationPhase += 0.03;
            state.force = Math.sin(animationPhase) * 2000;
            forceSlider.value = state.force;
            const dir = state.force > 0 ? 'â†’' : state.force < 0 ? 'â†' : '';
            forceValue.textContent = `${Math.abs(Math.round(state.force))} kN ${dir}`;

            draw();
            requestAnimationFrame(animate);
        }

        // Initialize
        createReactionGrid();
        createStressDisplay();
        draw();
    </script>
</body>

</html>