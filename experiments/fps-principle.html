<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FPSæ‘©æ“¦æ‘†åŸç† | Friction Pendulum System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0a0a12 0%, #1a1a2e 50%, #0f1928 100%);
            min-height: 100vh;
            color: #e0e0e0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 25px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 25px;
        }

        .back-link {
            display: inline-block;
            color: #888;
            text-decoration: none;
            font-size: 0.85rem;
            margin-bottom: 10px;
        }

        .back-link:hover {
            color: #00d4ff;
        }

        h1 {
            font-size: 2rem;
            background: linear-gradient(90deg, #00d4ff, #7c3aed, #f472b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #888;
            font-size: 0.95rem;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 25px;
        }

        @media (max-width: 1100px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
        }

        .viz-container {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            padding: 20px;
        }

        #canvas {
            width: 100%;
            height: 450px;
            background: linear-gradient(180deg, #1a1a2e 0%, #0f0f1a 100%);
            border-radius: 10px;
            display: block;
        }

        .view-tabs {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .view-tab {
            flex: 1;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #888;
            cursor: pointer;
            text-align: center;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .view-tab.active {
            background: rgba(0, 212, 255, 0.2);
            border-color: rgba(0, 212, 255, 0.4);
            color: #00d4ff;
        }

        .view-tab:hover:not(.active) {
            background: rgba(255, 255, 255, 0.08);
        }

        .control-panel {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            padding: 20px;
            max-height: 85vh;
            overflow-y: auto;
        }

        .section {
            margin-bottom: 20px;
        }

        .section h3 {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #888;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .section h3::before {
            content: '';
            width: 3px;
            height: 14px;
            background: linear-gradient(180deg, #00d4ff, #7c3aed);
            border-radius: 2px;
        }

        /* Core formulas */
        .formula-card {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 15px;
            border-left: 4px solid #00d4ff;
        }

        .formula-title {
            font-size: 0.85rem;
            color: #00d4ff;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .formula-main {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.5rem;
            color: #fff;
            margin-bottom: 8px;
        }

        .formula-main .var {
            color: #f472b6;
        }

        .formula-main .num {
            color: #ffa502;
        }

        .formula-desc {
            font-size: 0.8rem;
            color: #aaa;
            line-height: 1.5;
        }

        /* Parameter displays */
        .param-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .param-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .param-label {
            font-size: 0.7rem;
            color: #888;
            margin-bottom: 4px;
        }

        .param-value {
            font-size: 1.2rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }

        .param-unit {
            font-size: 0.7rem;
            color: #666;
        }

        /* Sliders */
        .slider-group {
            margin-bottom: 15px;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
            font-size: 0.85rem;
            color: #ccc;
        }

        .slider-value {
            font-family: 'JetBrains Mono', monospace;
            color: #00d4ff;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: linear-gradient(135deg, #00d4ff, #7c3aed);
            border-radius: 50%;
            cursor: pointer;
        }

        /* Animation button */
        .btn-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00d4ff, #7c3aed);
            color: #fff;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #ccc;
        }

        /* Coupling diagram */
        .coupling-diagram {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .coupling-title {
            font-size: 0.85rem;
            color: #f472b6;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
        }

        .coupling-flow {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .coupling-step {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            font-size: 0.8rem;
        }

        .coupling-arrow {
            text-align: center;
            color: #666;
            font-size: 1.2rem;
        }

        .coupling-step .icon {
            font-size: 1.2rem;
        }

        .coupling-step .text {
            flex: 1;
            color: #ccc;
        }

        .coupling-step .formula {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            color: #00d4ff;
        }

        /* Insight box */
        .insight-box {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.15), rgba(255, 107, 107, 0.05));
            border: 1px solid rgba(255, 107, 107, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .insight-title {
            color: #ff6b6b;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .insight-text {
            font-size: 0.8rem;
            color: #ccc;
            line-height: 1.6;
        }

        /* Charts area */
        .charts-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .chart-title {
            font-size: 0.75rem;
            color: #888;
            margin-bottom: 10px;
            text-align: center;
        }

        .chart-canvas {
            width: 100%;
            height: 120px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        /* Info cards */
        .info-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 25px;
        }

        @media (max-width: 900px) {
            .info-cards {
                grid-template-columns: 1fr;
            }
        }

        .info-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 18px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .info-card h4 {
            color: #00d4ff;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .info-card p {
            color: #888;
            font-size: 0.8rem;
            line-height: 1.5;
        }

        .formula-inline {
            font-family: 'JetBrains Mono', monospace;
            background: rgba(0, 0, 0, 0.3);
            padding: 4px 8px;
            border-radius: 4px;
            color: #00d4ff;
            font-size: 0.75rem;
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-link">â† è¿”å›æ¦‚è§ˆ</a>
            <h1>ğŸ› FPS æ‘©æ“¦æ‘†åŸç†</h1>
            <p class="subtitle">Friction Pendulum System - æ·±å…¥ç†è§£éš”éœ‡æœºåˆ¶</p>
        </header>

        <div class="main-layout">
            <div class="viz-container">
                <canvas id="canvas"></canvas>
                <div class="view-tabs">
                    <div class="view-tab active" data-view="mechanism">å·¥ä½œåŸç†</div>
                    <div class="view-tab" data-view="forces">åŠ›çš„åˆ†è§£</div>
                    <div class="view-tab" data-view="coupling">è€¦åˆæ•ˆåº”</div>
                </div>
            </div>

            <div class="control-panel">
                <!-- Core Formula -->
                <div class="formula-card">
                    <div class="formula-title">âš¡ æ ¸å¿ƒå…¬å¼</div>
                    <div class="formula-main">
                        F<sub>r</sub> = <span class="var">W</span> Ã— <span class="var">d</span> / <span
                            class="var">R</span> + <span class="var">Î¼</span> Ã— <span class="var">N</span>
                    </div>
                    <div class="formula-desc">
                        æ¢å¤åŠ› = å•æ‘†æ¢å¤åŠ› + æ‘©æ“¦åŠ›<br>
                        R = æ›²é¢åŠå¾„ï¼Œd = æ°´å¹³ä½ç§»ï¼ŒÎ¼ = æ‘©æ“¦ç³»æ•°
                    </div>
                </div>

                <!-- Coupling Diagram -->
                <div class="coupling-diagram">
                    <div class="coupling-title">ğŸ”— å¤šé‡è€¦åˆå…³ç³»</div>
                    <div class="coupling-flow">
                        <div class="coupling-step">
                            <span class="icon">ğŸ“</span>
                            <span class="text">æ°´å¹³ä½ç§» d</span>
                            <span class="formula">d</span>
                        </div>
                        <div class="coupling-arrow">â†“</div>
                        <div class="coupling-step">
                            <span class="icon">â¬†ï¸</span>
                            <span class="text">å‡ ä½•æŠ¬å‡é«˜åº¦</span>
                            <span class="formula">Î”h = dÂ²/(2R)</span>
                        </div>
                        <div class="coupling-arrow">â†“</div>
                        <div class="coupling-step">
                            <span class="icon">âš–ï¸</span>
                            <span class="text">å‚ç›´ååŠ›å˜åŒ–</span>
                            <span class="formula">N = WÃ—cos(Î¸)</span>
                        </div>
                        <div class="coupling-arrow">â†“</div>
                        <div class="coupling-step">
                            <span class="icon">ğŸ›</span>
                            <span class="text">æ‘©æ“¦åŠ›å˜åŒ–</span>
                            <span class="formula">F<sub>f</sub> = Î¼ Ã— N</span>
                        </div>
                    </div>
                </div>

                <!-- Parameters -->
                <div class="section">
                    <h3>æ”¯åº§å‚æ•°</h3>

                    <div class="slider-group">
                        <div class="slider-label">
                            <span>æ›²é¢åŠå¾„ R</span>
                            <span class="slider-value" id="R-value">2.0 m</span>
                        </div>
                        <input type="range" id="R-slider" min="0.5" max="5" value="2" step="0.1">
                    </div>

                    <div class="slider-group">
                        <div class="slider-label">
                            <span>æ‘©æ“¦ç³»æ•° Î¼</span>
                            <span class="slider-value" id="mu-value">0.05</span>
                        </div>
                        <input type="range" id="mu-slider" min="0.01" max="0.15" value="0.05" step="0.01">
                    </div>

                    <div class="slider-group">
                        <div class="slider-label">
                            <span>å‚ç›´è·è½½ W</span>
                            <span class="slider-value" id="W-value">1000 kN</span>
                        </div>
                        <input type="range" id="W-slider" min="100" max="3000" value="1000" step="50">
                    </div>
                </div>

                <!-- Displacement Control -->
                <div class="section">
                    <h3>æ°´å¹³ä½ç§»</h3>
                    <div class="slider-group">
                        <div class="slider-label">
                            <span>ä½ç§» d</span>
                            <span class="slider-value" id="d-value">0 mm</span>
                        </div>
                        <input type="range" id="d-slider" min="-400" max="400" value="0">
                    </div>

                    <div class="btn-group">
                        <button class="btn btn-primary" id="btn-animate">â–¶ å¾€å¤è¿åŠ¨</button>
                        <button class="btn btn-secondary" id="btn-reset">â†º å½’é›¶</button>
                    </div>
                </div>

                <!-- Calculated Values -->
                <div class="section">
                    <h3>è®¡ç®—ç»“æœ</h3>
                    <div class="param-grid">
                        <div class="param-card">
                            <div class="param-label">æŠ¬å‡é«˜åº¦ Î”h</div>
                            <div class="param-value" id="param-h" style="color: #ffa502;">0<span class="param-unit">
                                    mm</span></div>
                        </div>
                        <div class="param-card">
                            <div class="param-label">å‚ç›´ååŠ› N</div>
                            <div class="param-value" id="param-N" style="color: #2ed573;">1000<span class="param-unit">
                                    kN</span></div>
                        </div>
                        <div class="param-card">
                            <div class="param-label">æ‘©æ“¦åŠ› F<sub>f</sub></div>
                            <div class="param-value" id="param-Ff" style="color: #00d4ff;">50<span class="param-unit">
                                    kN</span></div>
                        </div>
                        <div class="param-card">
                            <div class="param-label">æ¢å¤åŠ› F<sub>r</sub></div>
                            <div class="param-value" id="param-Fr" style="color: #f472b6;">50<span class="param-unit">
                                    kN</span></div>
                        </div>
                    </div>
                </div>

                <!-- Insight -->
                <div class="insight-box">
                    <div class="insight-title">âš ï¸ ä½ååŠ›æ—¶çš„é—®é¢˜</div>
                    <div class="insight-text">
                        å½“ W å‡å°æ—¶ï¼š<br>
                        1. æ‘©æ“¦åŠ› F<sub>f</sub> = Î¼W å‡å° â†’ é˜»å°¼ä¸è¶³<br>
                        2. æ¢å¤åŠ› F<sub>r</sub> âˆ W å‡å° â†’ åˆšåº¦é™ä½<br>
                        3. å‘¨æœŸä¸å˜ï¼ˆT = 2Ï€âˆš(R/g)ï¼‰ä½†ä½ç§»å¤±æ§
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts -->
        <div class="charts-row">
            <div class="chart-container">
                <div class="chart-title">æ¢å¤åŠ› vs ä½ç§»ï¼ˆæ»å›æ›²çº¿ï¼‰</div>
                <canvas id="chart-hysteresis" class="chart-canvas"></canvas>
            </div>
            <div class="chart-container">
                <div class="chart-title">æ‘©æ“¦åŠ› vs å‚ç›´ååŠ›</div>
                <canvas id="chart-friction" class="chart-canvas"></canvas>
            </div>
        </div>

        <!-- Info Cards -->
        <div class="info-cards">
            <div class="info-card">
                <h4>ğŸ¯ å•æ‘†åŸç†</h4>
                <p>
                    FPS é€šè¿‡æ›²é¢æ»‘åŠ¨å®ç°éš”éœ‡ï¼Œç±»ä¼¼å•æ‘†ã€‚éš”éœ‡å‘¨æœŸåªä¸æ›²é¢åŠå¾„æœ‰å…³ï¼š
                    <span class="formula-inline">T = 2Ï€âˆš(R/g)</span>
                    ä¸å»ºç­‘é‡é‡æ— å…³ï¼
                </p>
            </div>
            <div class="info-card">
                <h4>ğŸ”„ è‡ªå¤ä½èƒ½åŠ›</h4>
                <p>
                    æ»‘å—æ²¿æ›²é¢ä¸Šå‡äº§ç”Ÿçš„åŠ¿èƒ½æä¾›æ¢å¤åŠ›ï¼š
                    <span class="formula-inline">F = W Ã— d / R</span>
                    åœ°éœ‡åèƒ½è‡ªåŠ¨å›åˆ°ä¸­å¿ƒä½ç½®ã€‚
                </p>
            </div>
            <div class="info-card">
                <h4>ğŸ› æ‘©æ“¦é˜»å°¼</h4>
                <p>
                    æ‘©æ“¦åŠ›æä¾›é˜»å°¼ï¼ˆè€—èƒ½ï¼‰ï¼š
                    <span class="formula-inline">F<sub>f</sub> = Î¼N</span>
                    ä½†Nå‡å°æ—¶é˜»å°¼æ¶ˆå¤±ï¼Œä½ç§»å¤±æ§ï¼
                </p>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const chartHyst = document.getElementById('chart-hysteresis');
        const ctxHyst = chartHyst.getContext('2d');
        const chartFric = document.getElementById('chart-friction');
        const ctxFric = chartFric.getContext('2d');

        function resizeCanvas() {
            canvas.width = canvas.parentElement.clientWidth - 40;
            canvas.height = 450;
            chartHyst.width = chartHyst.parentElement.clientWidth - 30;
            chartHyst.height = 120;
            chartFric.width = chartFric.parentElement.clientWidth - 30;
            chartFric.height = 120;
        }
        resizeCanvas();
        window.addEventListener('resize', () => { resizeCanvas(); draw(); });

        // State
        let state = {
            view: 'mechanism',
            R: 2.0,      // Radius in meters
            mu: 0.05,    // Friction coefficient
            W: 1000,     // Vertical load in kN
            d: 0,        // Displacement in mm
            isAnimating: false,
            animPhase: 0,
            history: []  // For hysteresis
        };

        // Calculate derived values
        function calculate() {
            const d_m = state.d / 1000; // Convert mm to m
            const theta = Math.asin(d_m / state.R);
            const deltaH = state.R * (1 - Math.cos(theta)); // Geometric rise
            const N = state.W * Math.cos(theta); // Vertical reaction (reduced due to tilt)
            const Ff = state.mu * N; // Friction force
            const Fr_pendulum = state.W * d_m / state.R; // Pendulum restoring force
            const Fr_total = Fr_pendulum + (state.d >= 0 ? Ff : -Ff); // Total restoring force

            return {
                theta,
                deltaH: deltaH * 1000, // mm
                N,
                Ff,
                Fr_pendulum,
                Fr_total
            };
        }

        // DOM elements
        const Rslider = document.getElementById('R-slider');
        const muSlider = document.getElementById('mu-slider');
        const Wslider = document.getElementById('W-slider');
        const dSlider = document.getElementById('d-slider');
        const btnAnimate = document.getElementById('btn-animate');
        const btnReset = document.getElementById('btn-reset');

        // View tabs
        document.querySelectorAll('.view-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.view-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                state.view = tab.dataset.view;
                draw();
            });
        });

        // Update display
        function updateDisplay() {
            const calc = calculate();

            document.getElementById('param-h').innerHTML = `${calc.deltaH.toFixed(1)}<span class="param-unit"> mm</span>`;
            document.getElementById('param-N').innerHTML = `${calc.N.toFixed(0)}<span class="param-unit"> kN</span>`;
            document.getElementById('param-Ff').innerHTML = `${calc.Ff.toFixed(1)}<span class="param-unit"> kN</span>`;
            document.getElementById('param-Fr').innerHTML = `${Math.abs(calc.Fr_total).toFixed(1)}<span class="param-unit"> kN</span>`;

            // Color coding
            const NrRatio = calc.N / state.W;
            document.getElementById('param-N').style.color = NrRatio < 0.8 ? '#ff6b6b' : '#2ed573';
            document.getElementById('param-Ff').style.color = NrRatio < 0.8 ? '#ff6b6b' : '#00d4ff';

            // Record history for hysteresis
            state.history.push({ d: state.d, Fr: calc.Fr_total });
            if (state.history.length > 500) state.history.shift();

            return calc;
        }

        // Main draw
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const calc = updateDisplay();

            if (state.view === 'mechanism') {
                drawMechanism(calc);
            } else if (state.view === 'forces') {
                drawForces(calc);
            } else {
                drawCoupling(calc);
            }

            drawCharts(calc);
        }

        // Draw mechanism view
        function drawMechanism(calc) {
            const centerX = canvas.width / 2;
            const centerY = 280;
            const scale = 80; // pixels per meter
            const R_px = state.R * scale;
            const d_px = state.d / 1000 * scale;

            // Draw curved surface
            ctx.beginPath();
            ctx.arc(centerX, centerY + R_px, R_px, Math.PI * 1.2, Math.PI * 1.8);
            ctx.strokeStyle = '#555';
            ctx.lineWidth = 8;
            ctx.stroke();

            // Inner surface (slider path)
            ctx.beginPath();
            ctx.arc(centerX, centerY + R_px, R_px - 4, Math.PI * 1.2, Math.PI * 1.8);
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 4;
            ctx.stroke();

            // Slider position
            const sliderX = centerX + d_px;
            const sliderY = centerY + R_px - Math.sqrt(R_px * R_px - d_px * d_px);

            // Slider
            ctx.beginPath();
            ctx.arc(sliderX, sliderY, 15, 0, Math.PI * 2);
            ctx.fillStyle = '#00d4ff';
            ctx.fill();
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 3;
            ctx.stroke();

            // Upper plate (building)
            const plateW = 160;
            const plateH = 25;
            ctx.fillStyle = '#3d5a80';
            ctx.fillRect(sliderX - plateW / 2, sliderY - plateH - 15, plateW, plateH);
            ctx.strokeStyle = '#5c7a99';
            ctx.lineWidth = 2;
            ctx.strokeRect(sliderX - plateW / 2, sliderY - plateH - 15, plateW, plateH);

            // Building weight arrow
            ctx.beginPath();
            ctx.moveTo(sliderX, sliderY - plateH - 15);
            ctx.lineTo(sliderX, sliderY - plateH - 60);
            ctx.strokeStyle = '#ffa502';
            ctx.lineWidth = 3;
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(sliderX, sliderY - plateH - 15);
            ctx.lineTo(sliderX - 8, sliderY - plateH - 30);
            ctx.lineTo(sliderX + 8, sliderY - plateH - 30);
            ctx.closePath();
            ctx.fillStyle = '#ffa502';
            ctx.fill();
            ctx.font = 'bold 12px Inter';
            ctx.fillText('W', sliderX + 15, sliderY - plateH - 35);

            // Displacement dimension
            if (Math.abs(state.d) > 10) {
                ctx.setLineDash([4, 4]);
                ctx.beginPath();
                ctx.moveTo(centerX, centerY + 50);
                ctx.lineTo(sliderX, centerY + 50);
                ctx.strokeStyle = '#00d4ff';
                ctx.lineWidth = 2;
                ctx.stroke();
                ctx.setLineDash([]);

                ctx.font = 'bold 12px JetBrains Mono';
                ctx.fillStyle = '#00d4ff';
                ctx.fillText(`d = ${state.d} mm`, (centerX + sliderX) / 2 - 30, centerY + 70);
            }

            // Rise dimension
            if (calc.deltaH > 0.5) {
                const riseY = centerY;
                ctx.setLineDash([4, 4]);
                ctx.beginPath();
                ctx.moveTo(sliderX + 80, centerY);
                ctx.lineTo(sliderX + 80, sliderY);
                ctx.strokeStyle = '#ffa502';
                ctx.lineWidth = 2;
                ctx.stroke();
                ctx.setLineDash([]);

                ctx.fillStyle = '#ffa502';
                ctx.fillText(`Î”h = ${calc.deltaH.toFixed(1)} mm`, sliderX + 90, (centerY + sliderY) / 2);
            }

            // Radius indicator
            ctx.beginPath();
            ctx.moveTo(centerX, centerY + R_px);
            ctx.lineTo(sliderX, sliderY);
            ctx.strokeStyle = 'rgba(255,255,255,0.3)';
            ctx.lineWidth = 1;
            ctx.stroke();
            ctx.fillStyle = '#888';
            ctx.font = '11px Inter';
            ctx.fillText(`R = ${state.R.toFixed(1)} m`, centerX + 20, centerY + R_px - 30);

            // Labels
            ctx.font = 'bold 14px Inter';
            ctx.fillStyle = '#888';
            ctx.fillText('FPS å·¥ä½œåŸç†', 20, 30);

            ctx.font = '12px Inter';
            ctx.fillStyle = '#666';
            ctx.fillText('æ»‘å—æ²¿æ›²é¢æ»‘åŠ¨ï¼Œäº§ç”Ÿå•æ‘†æ•ˆåº”', 20, 50);
        }

        // Draw forces view
        function drawForces(calc) {
            const centerX = canvas.width / 2;
            const sliderY = 250;
            const scale = 0.15;

            // Reference point (slider)
            ctx.beginPath();
            ctx.arc(centerX, sliderY, 20, 0, Math.PI * 2);
            ctx.fillStyle = '#00d4ff';
            ctx.fill();
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Weight W (down)
            const WLen = state.W * scale;
            ctx.beginPath();
            ctx.moveTo(centerX, sliderY);
            ctx.lineTo(centerX, sliderY + WLen);
            ctx.strokeStyle = '#ffa502';
            ctx.lineWidth = 4;
            ctx.stroke();
            drawArrow(centerX, sliderY + WLen, 0, 1, '#ffa502');
            ctx.fillStyle = '#ffa502';
            ctx.font = 'bold 14px Inter';
            ctx.fillText(`W = ${state.W} kN`, centerX + 20, sliderY + WLen / 2);

            // Normal force N (perpendicular to surface)
            const theta = calc.theta;
            const NLen = calc.N * scale;
            const Nx = centerX - NLen * Math.sin(theta);
            const Ny = sliderY - NLen * Math.cos(theta);
            ctx.beginPath();
            ctx.moveTo(centerX, sliderY);
            ctx.lineTo(Nx, Ny);
            ctx.strokeStyle = '#2ed573';
            ctx.lineWidth = 4;
            ctx.stroke();
            drawArrow(Nx, Ny, -Math.sin(theta), -Math.cos(theta), '#2ed573');
            ctx.fillStyle = '#2ed573';
            ctx.fillText(`N = ${calc.N.toFixed(0)} kN`, Nx - 70, Ny + 15);

            // Friction force (tangent to surface)
            const FfLen = calc.Ff * scale * 3; // Scale up for visibility
            const dir = state.d >= 0 ? -1 : 1;
            const FfX = centerX + FfLen * dir * Math.cos(theta);
            const FfY = sliderY - FfLen * dir * Math.sin(theta);
            ctx.beginPath();
            ctx.moveTo(centerX, sliderY);
            ctx.lineTo(FfX, FfY);
            ctx.strokeStyle = '#ff6b6b';
            ctx.lineWidth = 4;
            ctx.stroke();
            drawArrow(FfX, FfY, dir * Math.cos(theta), -dir * Math.sin(theta), '#ff6b6b');
            ctx.fillStyle = '#ff6b6b';
            ctx.fillText(`Ff = ${calc.Ff.toFixed(1)} kN`, FfX + (dir > 0 ? 10 : -80), FfY);

            // Pendulum restoring force
            const FpLen = Math.abs(calc.Fr_pendulum) * scale * 3;
            const FpDir = state.d >= 0 ? -1 : 1;
            ctx.beginPath();
            ctx.moveTo(centerX, sliderY - 60);
            ctx.lineTo(centerX + FpLen * FpDir, sliderY - 60);
            ctx.strokeStyle = '#7c3aed';
            ctx.lineWidth = 4;
            ctx.stroke();
            drawArrow(centerX + FpLen * FpDir, sliderY - 60, FpDir, 0, '#7c3aed');
            ctx.fillStyle = '#7c3aed';
            ctx.fillText(`F_pendulum = ${Math.abs(calc.Fr_pendulum).toFixed(1)} kN`,
                centerX + FpLen * FpDir / 2 - 60, sliderY - 75);

            // Labels
            ctx.font = 'bold 14px Inter';
            ctx.fillStyle = '#888';
            ctx.fillText('åŠ›çš„åˆ†è§£', 20, 30);

            ctx.font = '12px Inter';
            ctx.fillStyle = '#666';
            ctx.fillText('N = WÃ—cos(Î¸)  |  Ff = Î¼Ã—N  |  Fr = WÃ—d/R', 20, 50);
        }

        function drawArrow(x, y, dx, dy, color) {
            const len = 12;
            const angle = Math.atan2(dy, dx);
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(x - len * Math.cos(angle - 0.4), y - len * Math.sin(angle - 0.4));
            ctx.moveTo(x, y);
            ctx.lineTo(x - len * Math.cos(angle + 0.4), y - len * Math.sin(angle + 0.4));
            ctx.strokeStyle = color;
            ctx.lineWidth = 3;
            ctx.stroke();
        }

        // Draw coupling view
        function drawCoupling(calc) {
            const margin = 60;
            const chartW = (canvas.width - 3 * margin) / 2;
            const chartH = 150;

            // Chart 1: N vs d
            const x1 = margin;
            const y1 = 100;

            ctx.fillStyle = 'rgba(0,0,0,0.3)';
            ctx.fillRect(x1, y1, chartW, chartH);

            // Axes
            ctx.strokeStyle = '#555';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(x1, y1 + chartH / 2);
            ctx.lineTo(x1 + chartW, y1 + chartH / 2);
            ctx.moveTo(x1 + chartW / 2, y1);
            ctx.lineTo(x1 + chartW / 2, y1 + chartH);
            ctx.stroke();

            // N vs d curve
            ctx.beginPath();
            for (let dd = -400; dd <= 400; dd += 5) {
                const dm = dd / 1000;
                const th = Math.asin(dm / state.R);
                const Nv = state.W * Math.cos(th);
                const px = x1 + chartW / 2 + (dd / 400) * chartW / 2;
                const py = y1 + chartH / 2 - (Nv - state.W * 0.85) / (state.W * 0.2) * chartH / 2;
                if (dd === -400) ctx.moveTo(px, py);
                else ctx.lineTo(px, py);
            }
            ctx.strokeStyle = '#2ed573';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Current point
            const currX1 = x1 + chartW / 2 + (state.d / 400) * chartW / 2;
            const currY1 = y1 + chartH / 2 - (calc.N - state.W * 0.85) / (state.W * 0.2) * chartH / 2;
            ctx.beginPath();
            ctx.arc(currX1, currY1, 6, 0, Math.PI * 2);
            ctx.fillStyle = '#2ed573';
            ctx.fill();

            ctx.font = 'bold 12px Inter';
            ctx.fillStyle = '#2ed573';
            ctx.fillText('N vs d', x1 + 10, y1 + 20);
            ctx.fillStyle = '#888';
            ctx.fillText('ä½ç§»å¤§ â†’ Nå‡å°', x1 + 10, y1 + 40);

            // Chart 2: Ff vs N
            const x2 = x1 + chartW + margin;

            ctx.fillStyle = 'rgba(0,0,0,0.3)';
            ctx.fillRect(x2, y1, chartW, chartH);

            ctx.strokeStyle = '#555';
            ctx.beginPath();
            ctx.moveTo(x2, y1 + chartH);
            ctx.lineTo(x2 + chartW, y1 + chartH);
            ctx.lineTo(x2 + chartW, y1);
            ctx.stroke();

            // Ff = mu * N line
            ctx.beginPath();
            ctx.moveTo(x2, y1 + chartH);
            ctx.lineTo(x2 + chartW, y1);
            ctx.strokeStyle = '#00d4ff';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Current point
            const currX2 = x2 + (calc.N / state.W) * chartW;
            const currY2 = y1 + chartH - (calc.Ff / (state.W * state.mu)) * chartH;
            ctx.beginPath();
            ctx.arc(currX2, currY2, 6, 0, Math.PI * 2);
            ctx.fillStyle = '#00d4ff';
            ctx.fill();

            ctx.fillStyle = '#00d4ff';
            ctx.fillText('Ff vs N', x2 + 10, y1 + 20);
            ctx.fillStyle = '#888';
            ctx.fillText('Ff = Î¼N (çº¿æ€§)', x2 + 10, y1 + 40);

            // Summary text
            ctx.font = 'bold 16px Inter';
            ctx.fillStyle = '#f472b6';
            ctx.fillText('è€¦åˆé“¾æ¡ï¼šd â†‘ â†’ Î”h â†‘ â†’ N â†“ â†’ Ff â†“ â†’ é˜»å°¼ä¸§å¤±!', margin, y1 + chartH + 50);

            ctx.font = '12px Inter';
            ctx.fillStyle = '#888';
            ctx.fillText('å¤§ä½ç§»æ—¶å‚ç›´ååŠ›å‡å°ï¼Œæ‘©æ“¦åŠ›éšä¹‹å‡å°ï¼Œéš”éœ‡ç³»ç»Ÿé˜»å°¼ä¸è¶³', margin, y1 + chartH + 75);
        }

        // Draw charts
        function drawCharts(calc) {
            // Hysteresis chart
            ctxHyst.clearRect(0, 0, chartHyst.width, chartHyst.height);
            const hW = chartHyst.width;
            const hH = chartHyst.height;

            // Axes
            ctxHyst.strokeStyle = '#444';
            ctxHyst.lineWidth = 1;
            ctxHyst.beginPath();
            ctxHyst.moveTo(0, hH / 2);
            ctxHyst.lineTo(hW, hH / 2);
            ctxHyst.moveTo(hW / 2, 0);
            ctxHyst.lineTo(hW / 2, hH);
            ctxHyst.stroke();

            // Draw history
            if (state.history.length > 1) {
                ctxHyst.beginPath();
                const maxD = 400;
                const maxF = state.W * 0.3;
                state.history.forEach((pt, i) => {
                    const x = hW / 2 + (pt.d / maxD) * hW / 2;
                    const y = hH / 2 - (pt.Fr / maxF) * hH / 2;
                    if (i === 0) ctxHyst.moveTo(x, y);
                    else ctxHyst.lineTo(x, y);
                });
                ctxHyst.strokeStyle = '#00d4ff';
                ctxHyst.lineWidth = 2;
                ctxHyst.stroke();
            }

            // Labels
            ctxHyst.font = '10px Inter';
            ctxHyst.fillStyle = '#666';
            ctxHyst.fillText('d', hW - 15, hH / 2 - 5);
            ctxHyst.fillText('F', hW / 2 + 5, 15);

            // Friction chart
            ctxFric.clearRect(0, 0, chartFric.width, chartFric.height);
            const fW = chartFric.width;
            const fH = chartFric.height;

            ctxFric.strokeStyle = '#444';
            ctxFric.beginPath();
            ctxFric.moveTo(20, fH - 20);
            ctxFric.lineTo(fW - 20, fH - 20);
            ctxFric.lineTo(fW - 20, 20);
            ctxFric.stroke();

            // Ff = mu * N line
            ctxFric.beginPath();
            ctxFric.moveTo(20, fH - 20);
            ctxFric.lineTo(fW - 20, 20);
            ctxFric.strokeStyle = '#00d4ff';
            ctxFric.lineWidth = 2;
            ctxFric.stroke();

            // Current point
            const cpX = 20 + (calc.N / state.W) * (fW - 40);
            const cpY = fH - 20 - (calc.Ff / (state.W * state.mu)) * (fH - 40);
            ctxFric.beginPath();
            ctxFric.arc(cpX, cpY, 5, 0, Math.PI * 2);
            ctxFric.fillStyle = '#ff6b6b';
            ctxFric.fill();

            ctxFric.font = '10px Inter';
            ctxFric.fillStyle = '#666';
            ctxFric.fillText('N', fW - 30, fH - 5);
            ctxFric.fillText('Ff', 25, 15);
        }

        // Animation
        function animate() {
            if (!state.isAnimating) return;

            state.animPhase += 0.03;
            state.d = Math.sin(state.animPhase) * 300;
            dSlider.value = state.d;
            document.getElementById('d-value').textContent = `${Math.round(state.d)} mm`;

            draw();
            requestAnimationFrame(animate);
        }

        // Event listeners
        Rslider.addEventListener('input', (e) => {
            state.R = parseFloat(e.target.value);
            document.getElementById('R-value').textContent = `${state.R.toFixed(1)} m`;
            draw();
        });

        muSlider.addEventListener('input', (e) => {
            state.mu = parseFloat(e.target.value);
            document.getElementById('mu-value').textContent = state.mu.toFixed(2);
            draw();
        });

        Wslider.addEventListener('input', (e) => {
            state.W = parseInt(e.target.value);
            document.getElementById('W-value').textContent = `${state.W} kN`;
            draw();
        });

        dSlider.addEventListener('input', (e) => {
            state.d = parseInt(e.target.value);
            document.getElementById('d-value').textContent = `${state.d} mm`;
            draw();
        });

        btnAnimate.addEventListener('click', () => {
            state.isAnimating = !state.isAnimating;
            btnAnimate.textContent = state.isAnimating ? 'â¸ æš‚åœ' : 'â–¶ å¾€å¤è¿åŠ¨';
            if (state.isAnimating) animate();
        });

        btnReset.addEventListener('click', () => {
            state.isAnimating = false;
            state.d = 0;
            state.history = [];
            dSlider.value = 0;
            document.getElementById('d-value').textContent = '0 mm';
            btnAnimate.textContent = 'â–¶ å¾€å¤è¿åŠ¨';
            draw();
        });

        // Init
        draw();
    </script>
</body>

</html>