<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ©¡èƒ¶éš”éœ‡æ”¯åº§ä»¿çœŸ | Rubber Bearing Simulation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0a0a12 0%, #1a1a2e 50%, #0f1928 100%);
            min-height: 100vh;
            color: #e0e0e0;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
        }

        .back-link {
            display: inline-block;
            color: #888;
            text-decoration: none;
            font-size: 0.85rem;
            margin-bottom: 8px;
        }

        .back-link:hover {
            color: #00d4ff;
        }

        h1 {
            font-size: 1.6rem;
            background: linear-gradient(90deg, #2ed573, #00d4ff, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 5px;
        }

        .subtitle {
            color: #888;
            font-size: 0.85rem;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 20px;
        }

        @media (max-width: 1100px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
        }

        /* Canvas Area */
        .viz-container {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            padding: 15px;
        }

        #canvas {
            width: 100%;
            height: 450px;
            background: linear-gradient(180deg, #1a1a2e 0%, #0f0f1a 100%);
            border-radius: 10px;
            display: block;
        }

        .view-tabs {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .view-tab {
            flex: 1;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #888;
            cursor: pointer;
            text-align: center;
            font-size: 0.75rem;
            transition: all 0.2s;
        }

        .view-tab.active {
            background: rgba(46, 213, 115, 0.2);
            border-color: rgba(46, 213, 115, 0.4);
            color: #2ed573;
        }

        /* Control Panel */
        .control-panel {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            padding: 15px;
            max-height: 85vh;
            overflow-y: auto;
        }

        .section {
            margin-bottom: 15px;
        }

        .section h3 {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #888;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .section h3::before {
            content: '';
            width: 3px;
            height: 12px;
            background: linear-gradient(180deg, #2ed573, #00d4ff);
            border-radius: 2px;
        }

        /* Formula Card */
        .formula-card {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 12px;
            border-left: 3px solid #2ed573;
        }

        .formula-title {
            font-size: 0.75rem;
            color: #2ed573;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .formula-main {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.1rem;
            color: #fff;
            margin-bottom: 4px;
        }

        .formula-main .var {
            color: #f472b6;
        }

        .formula-desc {
            font-size: 0.7rem;
            color: #aaa;
            line-height: 1.4;
        }

        /* Support Height Controls */
        .height-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }

        .height-control {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 10px 8px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .height-control-label {
            font-size: 0.7rem;
            color: #888;
            margin-bottom: 4px;
        }

        .height-control-value {
            font-size: 0.85rem;
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
            color: #00d4ff;
            margin-bottom: 4px;
        }

        .height-slider {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            outline: none;
            -webkit-appearance: none;
        }

        .height-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            background: linear-gradient(135deg, #00d4ff, #2ed573);
            border-radius: 50%;
            cursor: pointer;
        }

        /* Support Info Grid */
        .support-info-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
            margin-bottom: 12px;
        }

        .support-info {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 8px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 0.65rem;
        }

        .support-info-label {
            color: #666;
            margin-bottom: 2px;
        }

        .support-info-value {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
        }

        .stat-label {
            font-size: 0.65rem;
            color: #888;
            margin-bottom: 3px;
        }

        .stat-value {
            font-size: 1rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Eccentricity Display */
        .eccentricity-display {
            background: rgba(124, 58, 237, 0.1);
            border: 1px solid rgba(124, 58, 237, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            text-align: center;
        }

        .ecc-title {
            font-size: 0.75rem;
            color: #7c3aed;
            margin-bottom: 6px;
        }

        .ecc-values {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .ecc-item {
            text-align: center;
        }

        .ecc-label {
            font-size: 0.65rem;
            color: #888;
        }

        .ecc-value {
            font-size: 0.95rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            color: #f472b6;
        }

        /* Buttons */
        .btn-group {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #2ed573, #00d4ff);
            color: #000;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #ccc;
        }

        .btn-small {
            padding: 6px 10px;
            font-size: 0.7rem;
        }

        /* Preset Buttons */
        .preset-btns {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .preset-btn {
            padding: 6px 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: #aaa;
            cursor: pointer;
            font-size: 0.7rem;
            transition: all 0.2s;
        }

        .preset-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .preset-btn.active {
            background: rgba(46, 213, 115, 0.2);
            border-color: rgba(46, 213, 115, 0.4);
            color: #2ed573;
        }

        /* Seismic Force Slider */
        .slider-group {
            margin-bottom: 10px;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
            font-size: 0.75rem;
            color: #ccc;
        }

        .slider-value {
            font-family: 'JetBrains Mono', monospace;
            color: #00d4ff;
        }

        input[type="range"] {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            background: linear-gradient(135deg, #2ed573, #00d4ff);
            border-radius: 50%;
            cursor: pointer;
        }

        /* Parameter Grid */
        .param-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .param-item {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            padding: 8px;
        }

        .param-item label {
            display: block;
            font-size: 0.65rem;
            color: #888;
            margin-bottom: 4px;
        }

        .param-item input[type="number"] {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            padding: 6px 8px;
            color: #00d4ff;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            outline: none;
        }

        .param-item input[type="number"]:focus {
            border-color: #2ed573;
        }

        /* Calculated Results */
        .calc-results {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 8px;
        }

        .calc-row {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 0.7rem;
        }

        .calc-row:last-child {
            border-bottom: none;
        }

        .calc-row span:first-child {
            color: #888;
        }

        .calc-row span:last-child {
            color: #2ed573;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Info Text */
        .info-text {
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 8px;
            padding: 10px;
            font-size: 0.7rem;
            color: #aaa;
            line-height: 1.5;
        }

        .info-text strong {
            color: #00d4ff;
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-link">â† è¿”å›æ¦‚è§ˆ</a>
            <h1>ğŸ¢ æ©¡èƒ¶éš”éœ‡æ”¯åº§ä»¿çœŸ</h1>
            <p class="subtitle">æŒ¯åŠ¨å°ç¼©å°ºæ¨¡å‹ - æ”¯åº§é«˜åº¦è°ƒèŠ‚ä¸åˆšåº¦ä¸­å¿ƒåç§»</p>
        </header>

        <div class="main-layout">
            <div class="viz-container">
                <canvas id="canvas"></canvas>
                <div class="view-tabs">
                    <div class="view-tab active" data-view="plan">ä¿¯è§†å›¾</div>
                    <div class="view-tab" data-view="trajectory">è½¨è¿¹å›¾</div>
                    <div class="view-tab" data-view="stiffness">åˆšåº¦åˆ†æ</div>
                </div>
            </div>

            <div class="control-panel">
                <!-- Core Formula -->
                <div class="formula-card">
                    <div class="formula-title">âš¡ æ ¸å¿ƒå…¬å¼</div>
                    <div class="formula-main">
                        K<sub>h</sub> = K<sub>0</sub> Ã— (1 - (Ïƒ/Ïƒ<sub>cr</sub>)Â²)
                    </div>
                    <div class="formula-desc">
                        ä½ç§»: u = F/Î£K<sub>h</sub> | æ‰­è½¬: Ï† = M<sub>T</sub>/J
                    </div>
                </div>

                <!-- Bearing Parameters (Configurable) -->
                <div class="section">
                    <h3>ğŸ”§ æ”¯åº§å‚æ•°é…ç½®</h3>
                    <div class="param-grid">
                        <div class="param-item">
                            <label>ç›´å¾„ D (mm)</label>
                            <input type="number" id="param-diameter" value="44" min="20" max="100" step="1">
                        </div>
                        <div class="param-item">
                            <label>æ©¡èƒ¶å±‚åš t<sub>r</sub> (mm)</label>
                            <input type="number" id="param-rubber-t" value="2" min="1" max="10" step="0.5">
                        </div>
                        <div class="param-item">
                            <label>æ©¡èƒ¶å±‚æ•° n</label>
                            <input type="number" id="param-layers" value="10" min="3" max="30" step="1">
                        </div>
                        <div class="param-item">
                            <label>å‰ªåˆ‡æ¨¡é‡ G (MPa)</label>
                            <input type="number" id="param-shear-g" value="0.4" min="0.2" max="1.0" step="0.05">
                        </div>
                        <div class="param-item">
                            <label>å±ˆæœé¢å‹ Ïƒ<sub>cr</sub> (MPa)</label>
                            <input type="number" id="param-yield-pressure" value="30" min="15" max="50" step="1">
                        </div>
                    </div>
                    <button class="btn btn-small btn-secondary" id="btn-apply-params"
                        style="margin-top: 8px; width: 100%;">åº”ç”¨å‚æ•°</button>
                </div>

                <!-- Calculated Values (Read-only) -->
                <div class="section">
                    <h3>ğŸ“Š è®¡ç®—ç»“æœ</h3>
                    <div class="calc-results">
                        <div class="calc-row">
                            <span>é¢ç§¯ A</span>
                            <span id="calc-area">1520 mmÂ²</span>
                        </div>
                        <div class="calc-row">
                            <span>å½¢çŠ¶ç³»æ•° S</span>
                            <span id="calc-shape">5.5</span>
                        </div>
                        <div class="calc-row">
                            <span>æ€»æ©¡èƒ¶åš T<sub>r</sub></span>
                            <span id="calc-total-rubber">20 mm</span>
                        </div>
                        <div class="calc-row">
                            <span>åŸºå‡†æ°´å¹³åˆšåº¦ K<sub>h0</sub></span>
                            <span id="calc-kh0">30.4 kN/m</span>
                        </div>
                        <div class="calc-row">
                            <span>ç«–å‘åˆšåº¦ K<sub>v</sub></span>
                            <span id="calc-kv">548 kN/m</span>
                        </div>
                    </div>
                </div>

                <!-- Support Heights -->
                <div class="section">
                    <h3>æ”¯åº§é«˜åº¦è°ƒèŠ‚ (mm)</h3>
                    <div class="height-controls">
                        <div class="height-control">
                            <div class="height-control-label">æ”¯åº§ 8</div>
                            <div class="height-control-value" id="h8-value">0</div>
                            <input type="range" class="height-slider" id="h8" min="-10" max="10" value="0" step="0.5">
                        </div>
                        <div class="height-control">
                            <div class="height-control-label">æ”¯åº§ 11</div>
                            <div class="height-control-value" id="h11-value">0</div>
                            <input type="range" class="height-slider" id="h11" min="-10" max="10" value="0" step="0.5">
                        </div>
                        <div class="height-control">
                            <div class="height-control-label">æ”¯åº§ 25</div>
                            <div class="height-control-value" id="h25-value">0</div>
                            <input type="range" class="height-slider" id="h25" min="-10" max="10" value="0" step="0.5">
                        </div>
                        <div class="height-control">
                            <div class="height-control-label">æ”¯åº§ 4</div>
                            <div class="height-control-value" id="h4-value">0</div>
                            <input type="range" class="height-slider" id="h4" min="-10" max="10" value="0" step="0.5">
                        </div>
                        <div class="height-control">
                            <div class="height-control-label">æ”¯åº§ 16</div>
                            <div class="height-control-value" id="h16-value">0</div>
                            <input type="range" class="height-slider" id="h16" min="-10" max="10" value="0" step="0.5">
                        </div>
                        <div class="height-control">
                            <div class="height-control-label">æ”¯åº§ 30</div>
                            <div class="height-control-value" id="h30-value">0</div>
                            <input type="range" class="height-slider" id="h30" min="-10" max="10" value="0" step="0.5">
                        </div>
                    </div>
                </div>

                <!-- Preset Configurations -->
                <div class="section">
                    <h3>é¢„è®¾é…ç½®</h3>
                    <div class="preset-btns">
                        <div class="preset-btn active" data-preset="level">æ°´å¹³</div>
                        <div class="preset-btn" data-preset="tilt-x">Xå‘å€¾æ–œ</div>
                        <div class="preset-btn" data-preset="tilt-y">Yå‘å€¾æ–œ</div>
                        <div class="preset-btn" data-preset="twist">æ‰­è½¬</div>
                    </div>
                </div>

                <!-- Support Info -->
                <div class="section">
                    <h3>æ”¯åº§çŠ¶æ€ (ååŠ›/é¢å‹/åˆšåº¦)</h3>
                    <div class="support-info-grid" id="support-info-grid">
                        <!-- Generated by JS -->
                    </div>
                </div>

                <!-- Summary Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">æ€»é‡ W</div>
                        <div class="stat-value" id="total-weight" style="color: #ffa502;">85.58 kN</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">æ”¯åº§ç›´å¾„ D</div>
                        <div class="stat-value" id="bearing-diameter" style="color: #2ed573;">60 mm</div>
                    </div>
                </div>

                <!-- Eccentricity Display -->
                <div class="eccentricity-display">
                    <div class="ecc-title">åˆšåº¦ä¸­å¿ƒåç§» e = C<sub>S</sub> - C<sub>M</sub></div>
                    <div class="ecc-values">
                        <div class="ecc-item">
                            <div class="ecc-label">e<sub>x</sub></div>
                            <div class="ecc-value" id="ecc-x">0.000 m</div>
                        </div>
                        <div class="ecc-item">
                            <div class="ecc-label">e<sub>y</sub></div>
                            <div class="ecc-value" id="ecc-y">0.000 m</div>
                        </div>
                        <div class="ecc-item">
                            <div class="ecc-label">|e|</div>
                            <div class="ecc-value" id="ecc-mag">0.000 m</div>
                        </div>
                    </div>
                </div>

                <!-- Seismic Force -->
                <div class="section">
                    <h3>åœ°éœ‡åŠ›æ§åˆ¶</h3>
                    <div class="slider-group">
                        <div class="slider-label">
                            <span>åŠ›å¤§å° |F|</span>
                            <span class="slider-value" id="force-value">0 kN</span>
                        </div>
                        <input type="range" id="force-slider" min="0" max="50" value="0">
                    </div>
                    <div class="slider-group">
                        <div class="slider-label">
                            <span>Y/Xå¹…åº¦æ¯”</span>
                            <span class="slider-value" id="ratio-value">1.0</span>
                        </div>
                        <input type="range" id="ratio-slider" min="0" max="2" value="1" step="0.1">
                    </div>
                    <div class="slider-group">
                        <div class="slider-label">
                            <span>Yç›¸ä½å·® Î”Ï†</span>
                            <span class="slider-value" id="phase-value">0Â°</span>
                        </div>
                        <input type="range" id="phase-slider" min="0" max="180" value="0">
                    </div>
                    <div class="preset-btns" style="margin-top: 8px;">
                        <div class="preset-btn" data-wave="line-x">Xå‘ç›´çº¿</div>
                        <div class="preset-btn" data-wave="line-y">Yå‘ç›´çº¿</div>
                        <div class="preset-btn" data-wave="circle">åœ†å½¢</div>
                        <div class="preset-btn" data-wave="ellipse">æ¤­åœ†</div>
                    </div>
                </div>

                <!-- Motion Response -->
                <div class="eccentricity-display"
                    style="background: rgba(0, 212, 255, 0.1); border-color: rgba(0, 212, 255, 0.3);">
                    <div class="ecc-title" style="color: #00d4ff;">ğŸ“ è¿åŠ¨å“åº”</div>
                    <div class="ecc-values">
                        <div class="ecc-item">
                            <div class="ecc-label">u<sub>x</sub></div>
                            <div class="ecc-value" id="disp-x" style="color: #2ed573;">0.0 mm</div>
                        </div>
                        <div class="ecc-item">
                            <div class="ecc-label">u<sub>y</sub></div>
                            <div class="ecc-value" id="disp-y" style="color: #2ed573;">0.0 mm</div>
                        </div>
                        <div class="ecc-item">
                            <div class="ecc-label">Ï†</div>
                            <div class="ecc-value" id="rotation-angle" style="color: #f472b6;">0.00Â°</div>
                        </div>
                    </div>
                </div>

                <!-- Torsion Result -->
                <div class="eccentricity-display"
                    style="background: rgba(255, 107, 107, 0.1); border-color: rgba(255, 107, 107, 0.3);">
                    <div class="ecc-title" style="color: #ff6b6b;">âš ï¸ æ‰­è½¬åŠ›çŸ©</div>
                    <div class="ecc-values">
                        <div class="ecc-item">
                            <div class="ecc-label">M<sub>T</sub></div>
                            <div class="ecc-value" id="torsion-moment" style="color: #ff6b6b;">0.000 kNÂ·m</div>
                        </div>
                        <div class="ecc-item">
                            <div class="ecc-label">F<sub>x</sub></div>
                            <div class="ecc-value" id="force-x" style="color: #00d4ff;">0.0 kN</div>
                        </div>
                        <div class="ecc-item">
                            <div class="ecc-label">F<sub>y</sub></div>
                            <div class="ecc-value" id="force-y" style="color: #00d4ff;">0.0 kN</div>
                        </div>
                    </div>
                </div>

                <!-- Animation -->
                <div class="btn-group">
                    <button class="btn btn-primary" id="btn-animate">â–¶ åœ°éœ‡æ¨¡æ‹Ÿ</button>
                    <button class="btn btn-secondary" id="btn-reset">â†º é‡ç½®</button>
                </div>

                <!-- Info -->
                <div class="info-text">
                    <strong>æ“ä½œè¯´æ˜ï¼š</strong><br>
                    1. è°ƒèŠ‚æ”¯åº§é«˜åº¦ â†’ åˆšåº¦ä¸­å¿ƒC<sub>S</sub>åç§»<br>
                    2. è®¾ç½®åœ°éœ‡åŠ›æ–¹å‘ â†’ è§‚å¯Ÿæ‰­è½¬åŠ›çŸ©<br>
                    3. æ‰­è½¬åŠ›çŸ© M<sub>T</sub> = |F| Ã— |e| Ã— sin(Î¸ - Î¸<sub>e</sub>)
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================================
        // CANVAS SETUP
        // ============================================================
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            canvas.width = canvas.parentElement.clientWidth - 30;
            canvas.height = 450;
        }
        resizeCanvas();
        window.addEventListener('resize', () => { resizeCanvas(); draw(); });

        // ============================================================
        // MODEL PARAMETERS - æŒ¯åŠ¨å°ç¼©å°ºæ¨¡å‹
        // ============================================================

        // å»ºç­‘å¸ƒå±€: 2è¡Œ Ã— 3åˆ—ï¼Œä¸¤è·¨
        //    8 -------- 11 -------- 25
        //    |    è·¨1   |    è·¨2    |
        //    4 -------- 16 -------- 30

        const SPAN_X = 0.6; // m (æ¯è·¨Xæ–¹å‘é•¿åº¦)
        const SPAN_Y = 0.4; // m (Yæ–¹å‘å®½åº¦)
        const TOTAL_LENGTH = SPAN_X * 2; // 1.2m
        const TOTAL_WIDTH = SPAN_Y; // 0.4m

        // æ”¯åº§åˆå§‹ååŠ› (kN) - æ¥è‡ªè¡¨æ ¼æ•°æ®
        const INITIAL_REACTIONS = {
            '8': 10.0075,   // å·¦ä¸Š
            '11': 22.7747,  // ä¸­ä¸Š
            '25': 10.0053,  // å³ä¸Š
            '4': 10.0727,   // å·¦ä¸‹
            '16': 22.6419,  // ä¸­ä¸‹
            '30': 10.0744   // å³ä¸‹
        };

        // æ”¯åº§ä½ç½® (ä»¥è´¨å¿ƒä¸ºåŸç‚¹)
        const SUPPORT_POSITIONS = {
            '8': { x: -SPAN_X, y: SPAN_Y / 2 },
            '11': { x: 0, y: SPAN_Y / 2 },
            '25': { x: SPAN_X, y: SPAN_Y / 2 },
            '4': { x: -SPAN_X, y: -SPAN_Y / 2 },
            '16': { x: 0, y: -SPAN_Y / 2 },
            '30': { x: SPAN_X, y: -SPAN_Y / 2 }
        };

        const SUPPORT_IDS = ['8', '11', '25', '4', '16', '30'];
        const TOTAL_WEIGHT = Object.values(INITIAL_REACTIONS).reduce((a, b) => a + b, 0); // 85.58 kN

        // ============================================================
        // å¯é…ç½®å‚æ•°ç³»ç»Ÿ
        // ============================================================

        // å¯é…ç½®å‚æ•° (ç”¨æˆ·å¯è°ƒ)
        let params = {
            diameter: 44,       // mm - æ”¯åº§ç›´å¾„
            rubberLayerT: 2,    // mm - æ©¡èƒ¶å±‚åšåº¦
            numLayers: 10,      // å±‚æ•°
            shearModulus: 0.4,  // MPa - å‰ªåˆ‡æ¨¡é‡
            yieldPressure: 30   // MPa - å±ˆæœé¢å‹
        };

        // è®¡ç®—ç»“æœ (åŸºäºparamsè®¡ç®—)
        let calc = {
            diameter_m: 0,      // m
            area: 0,            // mÂ²
            area_mm2: 0,        // mmÂ²
            totalRubberT: 0,    // m
            shapeFactor: 0,
            Kh0: 0,             // kN/m - åŸºå‡†æ°´å¹³åˆšåº¦
            Kv: 0,              // kN/m - ç«–å‘åˆšåº¦
            Ec: 0               // MPa - å‹ç¼©æ¨¡é‡
        };

        // æ ¹æ®paramsé‡æ–°è®¡ç®—æ‰€æœ‰æ´¾ç”Ÿå€¼
        function recalculateParams() {
            calc.diameter_m = params.diameter / 1000; // m
            calc.area = Math.PI * Math.pow(calc.diameter_m / 2, 2); // mÂ²
            calc.area_mm2 = calc.area * 1e6; // mmÂ²
            calc.totalRubberT = (params.rubberLayerT * params.numLayers) / 1000; // m
            calc.shapeFactor = calc.diameter_m / (4 * params.rubberLayerT / 1000);

            // åˆšåº¦è®¡ç®—
            calc.Kh0 = params.shearModulus * 1000 * calc.area / calc.totalRubberT; // kN/m
            calc.Ec = 6 * params.shearModulus * calc.shapeFactor * calc.shapeFactor; // MPa
            calc.Kv = calc.Ec * 1000 * calc.area / calc.totalRubberT; // kN/m

            // æ›´æ–°UIæ˜¾ç¤º
            updateCalcDisplay();

            console.log('å‚æ•°æ›´æ–°:');
            console.log('  ç›´å¾„ D =', params.diameter, 'mm');
            console.log('  é¢ç§¯ A =', calc.area_mm2.toFixed(1), 'mmÂ²');
            console.log('  å½¢çŠ¶ç³»æ•° S =', calc.shapeFactor.toFixed(2));
            console.log('  åŸºå‡†æ°´å¹³åˆšåº¦ Kh0 =', calc.Kh0.toFixed(1), 'kN/m');
            console.log('  ç«–å‘åˆšåº¦ Kv =', calc.Kv.toFixed(1), 'kN/m');
        }

        // æ›´æ–°è®¡ç®—ç»“æœæ˜¾ç¤º
        function updateCalcDisplay() {
            document.getElementById('calc-area').textContent = calc.area_mm2.toFixed(0) + ' mmÂ²';
            document.getElementById('calc-shape').textContent = calc.shapeFactor.toFixed(2);
            document.getElementById('calc-total-rubber').textContent = (calc.totalRubberT * 1000).toFixed(0) + ' mm';
            document.getElementById('calc-kh0').textContent = calc.Kh0.toFixed(1) + ' kN/m';
            document.getElementById('calc-kv').textContent = calc.Kv.toFixed(0) + ' kN/m';
        }

        // åˆå§‹åŒ–è®¡ç®—
        recalculateParams();

        // ============================================================
        // STATE
        // ============================================================
        let state = {
            view: 'plan',
            heights: { '8': 0, '11': 0, '25': 0, '4': 0, '16': 0, '30': 0 }, // mm
            supports: {},
            // åŒå‘åœ°éœ‡è¾“å…¥å‚æ•°
            force: 0,           // åŠ›å¤§å° (kN)
            yxRatio: 1.0,       // Y/Xå¹…åº¦æ¯”
            phaseDiff: 0,       // Yç›¸ä½å·® (åº¦)
            // è¿åŠ¨å“åº”
            displacement: 0,
            rotation: 0,
            // åŠ¨ç”»çŠ¶æ€
            buildingDisp: { x: 0, y: 0, rot: 0 },
            isAnimating: false,
            animTime: 0,
            // è½¨è¿¹è®°å½•
            trajectory: [],
            maxTrajectoryPoints: 200
        };

        // ============================================================
        // CALCULATIONS
        // ============================================================

        // è®¡ç®—æœ‰æ•ˆæ°´å¹³åˆšåº¦
        // Kh = Kh0 Ã— (1 - (Ïƒ/Ïƒ_cr)Â²)
        function calcEffectiveKh(pressure) {
            const ratio = pressure / params.yieldPressure;
            return calc.Kh0 * Math.max(0, 1 - ratio * ratio);
        }

        // æ ¹æ®æ”¯åº§é«˜å·®è®¡ç®—ååŠ›é‡åˆ†é…
        function calculateReactions() {
            // æ”¯åº§é«˜å·®å¯¼è‡´ååŠ›å˜åŒ–ï¼šÎ”N = Kv Ã— Î”h
            // ä½†éœ€è¦ä¿æŒæ€»ååŠ›ä¸å˜ï¼ˆé™åŠ›å¹³è¡¡ï¼‰

            let totalDeltaN = 0;
            const deltaN = {};

            SUPPORT_IDS.forEach(id => {
                const h = state.heights[id] / 1000; // mm -> m
                deltaN[id] = calc.Kv * h; // é«˜åº¦å¢åŠ  â†’ ååŠ›å¢åŠ 
                totalDeltaN += deltaN[id];
            });

            // è°ƒæ•´ä½¿æ€»ååŠ›ä¿æŒä¸å˜
            const avgDelta = totalDeltaN / 6;

            SUPPORT_IDS.forEach(id => {
                const baseN = INITIAL_REACTIONS[id];
                const adjustedDelta = deltaN[id] - avgDelta;
                const newN = Math.max(0.1, baseN + adjustedDelta);

                // è®¡ç®—é¢å‹ (MPa)
                const pressure = (newN * 1000) / (calc.area * 1e6);

                // è®¡ç®—æœ‰æ•ˆæ°´å¹³åˆšåº¦
                const Kh = calcEffectiveKh(pressure);
                const stiffnessRatio = Kh / calc.Kh0;
                const pressureRatio = pressure / params.yieldPressure;

                state.supports[id] = {
                    x: SUPPORT_POSITIONS[id].x,
                    y: SUPPORT_POSITIONS[id].y,
                    h: state.heights[id],
                    N: newN,
                    pressure: pressure,
                    Kh: Kh,
                    pressureRatio: pressureRatio,
                    stiffnessRatio: stiffnessRatio
                };
            });
        }

        // è®¡ç®—åˆšåº¦ä¸­å¿ƒ
        function calculateStiffnessCenter() {
            let sumKx = 0, sumKy = 0, sumK = 0;

            SUPPORT_IDS.forEach(id => {
                const s = state.supports[id];
                sumKx += s.Kh * s.x;
                sumKy += s.Kh * s.y;
                sumK += s.Kh;
            });

            const Cs_x = sumK > 0 ? sumKx / sumK : 0;
            const Cs_y = sumK > 0 ? sumKy / sumK : 0;

            return {
                x: Cs_x,
                y: Cs_y,
                ex: Cs_x, // è´¨å¿ƒåœ¨åŸç‚¹
                ey: Cs_y,
                e_mag: Math.sqrt(Cs_x * Cs_x + Cs_y * Cs_y),
                totalK: sumK
            };
        }

        // ============================================================
        // UI UPDATES
        // ============================================================

        function updateUI() {
            calculateReactions();
            const cs = calculateStiffnessCenter();

            // Update support info grid
            const grid = document.getElementById('support-info-grid');
            grid.innerHTML = '';

            SUPPORT_IDS.forEach(id => {
                const s = state.supports[id];
                const statusColor = s.stiffnessRatio > 0.9 ? '#2ed573' :
                    s.stiffnessRatio > 0.7 ? '#ffa502' : '#ff6b6b';

                const div = document.createElement('div');
                div.className = 'support-info';
                div.innerHTML = `
                    <div class="support-info-label">æ”¯åº§ ${id}</div>
                    <div class="support-info-value" style="color: ${statusColor}">
                        ${s.N.toFixed(1)}kN / ${s.pressure.toFixed(1)}MPa
                    </div>
                    <div class="support-info-value" style="color: #00d4ff; font-size: 0.6rem;">
                        Kh=${(s.stiffnessRatio * 100).toFixed(0)}%
                    </div>
                `;
                grid.appendChild(div);
            });

            // Update eccentricity display
            document.getElementById('ecc-x').textContent = cs.ex.toFixed(4) + ' m';
            document.getElementById('ecc-y').textContent = cs.ey.toFixed(4) + ' m';
            document.getElementById('ecc-mag').textContent = cs.e_mag.toFixed(4) + ' m';

            // Calculate force components (for static display, use max values)
            const Fx = state.force;
            const Fy = state.force * state.yxRatio;

            // Calculate torsion moment: MT = Fx * ey - Fy * ex (cross product)
            const torsionMoment = Fx * cs.ey - Fy * cs.ex;

            // Calculate displacement: u = F / Î£Kh
            const totalForce = Math.sqrt(Fx * Fx + Fy * Fy);
            const ux = cs.totalK > 0 ? Fx / cs.totalK : 0;
            const uy = cs.totalK > 0 ? Fy / cs.totalK : 0;

            // Calculate torsional stiffness: J = Î£(Kh Ã— rÂ²)
            let J = 0;
            SUPPORT_IDS.forEach(id => {
                const s = state.supports[id];
                const r2 = s.x * s.x + s.y * s.y;
                J += s.Kh * r2;
            });

            // Calculate rotation: Ï† = MT / J
            const rotation = J > 0 ? torsionMoment / J : 0;

            // Update force and torsion display
            document.getElementById('force-x').textContent = Fx.toFixed(1) + ' kN';
            document.getElementById('force-y').textContent = Fy.toFixed(1) + ' kN';
            document.getElementById('torsion-moment').textContent = torsionMoment.toFixed(3) + ' kNÂ·m';

            // Update displacement display
            document.getElementById('disp-x').textContent = (ux * 1000).toFixed(1) + ' mm';
            document.getElementById('disp-y').textContent = (uy * 1000).toFixed(1) + ' mm';
            document.getElementById('rotation-angle').textContent = (rotation * 180 / Math.PI).toFixed(2) + 'Â°';

            // Update stats
            document.getElementById('total-weight').textContent = TOTAL_WEIGHT.toFixed(2) + ' kN';
            document.getElementById('bearing-diameter').textContent = params.diameter.toFixed(0) + ' mm';

            // Store for animation
            state.displacement = Math.sqrt(ux * ux + uy * uy);
            state.rotation = rotation;
            state.J = J;
            state.cs = cs;

            draw();
        }

        // ============================================================
        // HEIGHT SLIDER HANDLERS
        // ============================================================

        SUPPORT_IDS.forEach(id => {
            const slider = document.getElementById('h' + id);
            const valueEl = document.getElementById('h' + id + '-value');

            slider.addEventListener('input', (e) => {
                const val = parseFloat(e.target.value);
                state.heights[id] = val;
                valueEl.textContent = val.toFixed(1);
                updateUI();
            });
        });

        // Preset configurations
        document.querySelectorAll('.preset-btn[data-preset]').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.preset-btn[data-preset]').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                const preset = btn.dataset.preset;

                switch (preset) {
                    case 'level':
                        state.heights = { '8': 0, '11': 0, '25': 0, '4': 0, '16': 0, '30': 0 };
                        break;
                    case 'tilt-x':
                        // Xå‘å€¾æ–œï¼šå³ä¾§é«˜
                        state.heights = { '8': -3, '11': 0, '25': 3, '4': -3, '16': 0, '30': 3 };
                        break;
                    case 'tilt-y':
                        // Yå‘å€¾æ–œï¼šä¸Šä¾§é«˜
                        state.heights = { '8': 3, '11': 3, '25': 3, '4': -3, '16': -3, '30': -3 };
                        break;
                    case 'twist':
                        // æ‰­è½¬ï¼šå¯¹è§’é«˜
                        state.heights = { '8': 5, '11': 0, '25': -5, '4': -5, '16': 0, '30': 5 };
                        break;
                }

                // Update sliders
                SUPPORT_IDS.forEach(id => {
                    document.getElementById('h' + id).value = state.heights[id];
                    document.getElementById('h' + id + '-value').textContent = state.heights[id].toFixed(1);
                });

                updateUI();
            });
        });

        // Parameter apply button
        document.getElementById('btn-apply-params').addEventListener('click', () => {
            // Read values from inputs
            params.diameter = parseFloat(document.getElementById('param-diameter').value);
            params.rubberLayerT = parseFloat(document.getElementById('param-rubber-t').value);
            params.numLayers = parseInt(document.getElementById('param-layers').value);
            params.shearModulus = parseFloat(document.getElementById('param-shear-g').value);
            params.yieldPressure = parseFloat(document.getElementById('param-yield-pressure').value);

            // Recalculate derived values
            recalculateParams();

            // Update all displays
            updateUI();

            console.log('å‚æ•°å·²åº”ç”¨ï¼');
        });

        // View tabs
        document.querySelectorAll('.view-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.view-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                state.view = tab.dataset.view;
                draw();
            });
        });

        // Force slider
        const forceSlider = document.getElementById('force-slider');
        const forceValue = document.getElementById('force-value');
        forceSlider.addEventListener('input', (e) => {
            state.force = parseFloat(e.target.value);
            forceValue.textContent = state.force.toFixed(0) + ' kN';
            updateUI();
        });

        // Y/X Ratio slider
        const ratioSlider = document.getElementById('ratio-slider');
        const ratioValue = document.getElementById('ratio-value');
        ratioSlider.addEventListener('input', (e) => {
            state.yxRatio = parseFloat(e.target.value);
            ratioValue.textContent = state.yxRatio.toFixed(1);
            updateUI();
        });

        // Phase difference slider
        const phaseSlider = document.getElementById('phase-slider');
        const phaseValue = document.getElementById('phase-value');
        phaseSlider.addEventListener('input', (e) => {
            state.phaseDiff = parseFloat(e.target.value);
            phaseValue.textContent = state.phaseDiff.toFixed(0) + 'Â°';
            updateUI();
        });

        // Wave preset buttons
        document.querySelectorAll('.preset-btn[data-wave]').forEach(btn => {
            btn.addEventListener('click', () => {
                const wave = btn.dataset.wave;
                switch (wave) {
                    case 'line-x':
                        state.yxRatio = 0;
                        state.phaseDiff = 0;
                        break;
                    case 'line-y':
                        state.yxRatio = 1000; // Very large = Y only
                        state.phaseDiff = 0;
                        break;
                    case 'circle':
                        state.yxRatio = 1;
                        state.phaseDiff = 90;
                        break;
                    case 'ellipse':
                        state.yxRatio = 0.5;
                        state.phaseDiff = 90;
                        break;
                }
                ratioSlider.value = Math.min(2, state.yxRatio);
                ratioValue.textContent = state.yxRatio.toFixed(1);
                phaseSlider.value = state.phaseDiff;
                phaseValue.textContent = state.phaseDiff.toFixed(0) + 'Â°';
                updateUI();
            });
        });

        // Animation
        let animationId = null;
        const btnAnimate = document.getElementById('btn-animate');
        const btnReset = document.getElementById('btn-reset');

        btnAnimate.addEventListener('click', () => {
            if (!state.isAnimating) {
                state.isAnimating = true;
                btnAnimate.textContent = 'â¸ æš‚åœ';
                animate();
            } else {
                state.isAnimating = false;
                btnAnimate.textContent = 'â–¶ ç»§ç»­';
                cancelAnimationFrame(animationId);
            }
        });

        btnReset.addEventListener('click', () => {
            state.isAnimating = false;
            cancelAnimationFrame(animationId);
            state.buildingDisp = { x: 0, y: 0, rot: 0 };
            state.animTime = 0;
            state.trajectory = [];
            state.force = 0;
            forceSlider.value = 0;
            forceValue.textContent = '0 kN';
            btnAnimate.textContent = 'â–¶ åœ°éœ‡æ¨¡æ‹Ÿ';
            updateUI();
        });

        function animate() {
            if (!state.isAnimating) return;

            // Time-based animation (2Hz frequency)
            state.animTime += 0.04;
            const omega = 2 * Math.PI * 2; // 2Hz
            const t = state.animTime;

            // X force: sin(Ï‰t)
            const Fx_t = Math.sin(omega * t) * 40;
            // Y force: sin(Ï‰t + Ï†) Ã— ratio
            const phaseRad = state.phaseDiff * Math.PI / 180;
            const Fy_t = Math.sin(omega * t + phaseRad) * 40 * state.yxRatio;

            // Update force slider display with X component amplitude
            state.force = 40;
            forceSlider.value = 40;
            forceValue.textContent = '40 kN';

            const cs = state.cs || calculateStiffnessCenter();
            const J = state.J || 0.1;

            // Calculate displacement: u = F / Î£K
            const ux = cs.totalK > 0 ? Fx_t / cs.totalK : 0;
            const uy = cs.totalK > 0 ? Fy_t / cs.totalK : 0;

            // Calculate torsion moment and rotation
            const torsionMoment = Fx_t * cs.ey - Fy_t * cs.ex;
            const rotation = J > 0 ? torsionMoment / J : 0;

            // Smooth building response
            state.buildingDisp.x = state.buildingDisp.x * 0.8 + ux * 0.2;
            state.buildingDisp.y = state.buildingDisp.y * 0.8 + uy * 0.2;
            state.buildingDisp.rot = state.buildingDisp.rot * 0.8 + rotation * 0.2;

            // Record trajectory
            state.trajectory.push({
                x: state.buildingDisp.x * 1000, // mm
                y: state.buildingDisp.y * 1000, // mm
                rot: state.buildingDisp.rot
            });

            // Limit trajectory length
            if (state.trajectory.length > state.maxTrajectoryPoints) {
                state.trajectory.shift();
            }

            // Update displacement display
            document.getElementById('disp-x').textContent = (state.buildingDisp.x * 1000).toFixed(1) + ' mm';
            document.getElementById('disp-y').textContent = (state.buildingDisp.y * 1000).toFixed(1) + ' mm';
            document.getElementById('rotation-angle').textContent = (state.buildingDisp.rot * 180 / Math.PI).toFixed(2) + 'Â°';

            draw();
            animationId = requestAnimationFrame(animate);
        }

        // ============================================================
        // DRAWING
        // ============================================================

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (state.view === 'plan') {
                drawPlanView();
            } else if (state.view === 'trajectory') {
                drawTrajectoryView();
            } else {
                drawStiffnessView();
            }
        }

        function drawPlanView() {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const scale = 280; // pixels per meter

            ctx.save();
            ctx.translate(centerX + state.buildingDisp.x * scale * 5, centerY);
            ctx.rotate(state.buildingDisp.rot * 0.3);

            // Building outline
            const w = TOTAL_LENGTH * scale;
            const d = TOTAL_WIDTH * scale;

            ctx.fillStyle = 'rgba(61, 90, 128, 0.3)';
            ctx.fillRect(-w / 2, -d / 2, w, d);
            ctx.strokeStyle = '#5c7a99';
            ctx.lineWidth = 2;
            ctx.strokeRect(-w / 2, -d / 2, w, d);

            // Span divider
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(0, -d / 2);
            ctx.lineTo(0, d / 2);
            ctx.stroke();
            ctx.setLineDash([]);

            // Labels
            ctx.font = '11px Inter';
            ctx.fillStyle = '#666';
            ctx.textAlign = 'center';
            ctx.fillText('è·¨1', -w / 4, 0);
            ctx.fillText('è·¨2', w / 4, 0);

            // Draw supports
            SUPPORT_IDS.forEach(id => {
                const s = state.supports[id];
                const px = s.x * scale;
                const py = -s.y * scale;

                const size = 18;

                // Color based on stiffness ratio
                let color;
                if (s.stiffnessRatio > 0.9) {
                    color = '#2ed573';
                } else if (s.stiffnessRatio > 0.7) {
                    color = '#ffa502';
                } else {
                    color = '#ff6b6b';
                }

                // Draw bearing
                ctx.beginPath();
                ctx.arc(px, py, size, 0, Math.PI * 2);
                ctx.fillStyle = color;
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();

                // Height indicator
                if (s.h !== 0) {
                    ctx.font = '9px JetBrains Mono';
                    ctx.fillStyle = s.h > 0 ? '#00d4ff' : '#f472b6';
                    ctx.textAlign = 'center';
                    ctx.fillText((s.h > 0 ? '+' : '') + s.h.toFixed(1), px, py + size + 12);
                }

                // Label
                ctx.font = 'bold 11px Inter';
                ctx.fillStyle = '#fff';
                ctx.textAlign = 'center';
                ctx.fillText(id, px, py + 4);
            });

            // Center of Mass (CM)
            ctx.beginPath();
            ctx.arc(0, 0, 6, 0, Math.PI * 2);
            ctx.fillStyle = '#ffa502';
            ctx.fill();
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 1.5;
            ctx.stroke();

            // Center of Stiffness (CS)
            const cs = calculateStiffnessCenter();
            const csX = cs.x * scale;
            const csY = -cs.y * scale;

            ctx.beginPath();
            ctx.arc(csX, csY, 6, 0, Math.PI * 2);
            ctx.fillStyle = '#f472b6';
            ctx.fill();
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 1.5;
            ctx.stroke();

            // Eccentricity line
            if (cs.e_mag > 0.001) {
                ctx.beginPath();
                ctx.setLineDash([4, 4]);
                ctx.moveTo(0, 0);
                ctx.lineTo(csX, csY);
                ctx.strokeStyle = '#f472b6';
                ctx.lineWidth = 2;
                ctx.stroke();
                ctx.setLineDash([]);

                ctx.font = '10px JetBrains Mono';
                ctx.fillStyle = '#f472b6';
                ctx.fillText(`e=${(cs.e_mag * 1000).toFixed(1)}mm`, csX / 2 + 20, csY / 2);
            }

            // Legend
            ctx.restore();
            ctx.font = '10px Inter';
            ctx.textAlign = 'left';

            ctx.fillStyle = '#ffa502';
            ctx.fillRect(20, canvas.height - 50, 10, 10);
            ctx.fillStyle = '#888';
            ctx.fillText('CM (è´¨å¿ƒ)', 35, canvas.height - 41);

            ctx.fillStyle = '#f472b6';
            ctx.fillRect(20, canvas.height - 35, 10, 10);
            ctx.fillStyle = '#888';
            ctx.fillText('CS (åˆšåº¦ä¸­å¿ƒ)', 35, canvas.height - 26);

            // Force arrow with direction
            if (state.force > 0.5) {
                ctx.save();
                ctx.translate(centerX, centerY);

                const angleRad = state.forceAngle * Math.PI / 180;
                const arrowLen = state.force * 1.5;

                // Arrow start position (outside building)
                const startDist = TOTAL_LENGTH * scale / 2 + 50;
                const startX = -startDist * Math.cos(angleRad);
                const startY = startDist * Math.sin(angleRad); // Note: Y is flipped

                // Arrow end position
                const endX = startX + arrowLen * Math.cos(angleRad);
                const endY = startY - arrowLen * Math.sin(angleRad); // Note: Y is flipped

                // Draw arrow line
                ctx.beginPath();
                ctx.moveTo(startX, startY);
                ctx.lineTo(endX, endY);
                ctx.strokeStyle = '#00d4ff';
                ctx.lineWidth = 4;
                ctx.stroke();

                // Arrow head
                ctx.save();
                ctx.translate(endX, endY);
                ctx.rotate(-angleRad);
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.lineTo(-12, -6);
                ctx.lineTo(-12, 6);
                ctx.closePath();
                ctx.fillStyle = '#00d4ff';
                ctx.fill();
                ctx.restore();

                // Force label
                ctx.font = 'bold 11px Inter';
                ctx.fillStyle = '#00d4ff';
                ctx.textAlign = 'center';
                ctx.fillText(`F=${state.force.toFixed(0)}kN @${state.forceAngle}Â°`, startX, startY + 20);

                ctx.restore();
            }
        }

        function drawTrajectoryView() {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const scale = 8; // pixels per mm of displacement

            ctx.font = '12px Inter';
            ctx.fillStyle = '#888';
            ctx.textAlign = 'left';
            ctx.fillText('è½¨è¿¹å›¾ - è´¨å¿ƒè¿åŠ¨è½¨è¿¹ (mm)', 20, 30);

            // Draw grid
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.lineWidth = 1;
            for (let i = -5; i <= 5; i++) {
                // Vertical lines
                ctx.beginPath();
                ctx.moveTo(centerX + i * 30, centerY - 150);
                ctx.lineTo(centerX + i * 30, centerY + 150);
                ctx.stroke();
                // Horizontal lines
                ctx.beginPath();
                ctx.moveTo(centerX - 150, centerY + i * 30);
                ctx.lineTo(centerX + 150, centerY + i * 30);
                ctx.stroke();
            }

            // Draw axes
            ctx.strokeStyle = '#555';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(centerX - 160, centerY);
            ctx.lineTo(centerX + 160, centerY);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(centerX, centerY - 160);
            ctx.lineTo(centerX, centerY + 160);
            ctx.stroke();

            // Axis labels
            ctx.font = 'bold 12px Inter';
            ctx.fillStyle = '#00d4ff';
            ctx.textAlign = 'center';
            ctx.fillText('X (mm)', centerX + 140, centerY + 20);
            ctx.fillText('Y (mm)', centerX + 20, centerY - 145);

            // Draw trajectory if we have points
            if (state.trajectory.length > 1) {
                // Gradient from old (fade) to new (bright)
                for (let i = 1; i < state.trajectory.length; i++) {
                    const p0 = state.trajectory[i - 1];
                    const p1 = state.trajectory[i];
                    const alpha = i / state.trajectory.length;

                    ctx.beginPath();
                    ctx.moveTo(centerX + p0.x * scale, centerY - p0.y * scale);
                    ctx.lineTo(centerX + p1.x * scale, centerY - p1.y * scale);
                    ctx.strokeStyle = `rgba(46, 213, 115, ${alpha})`;
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }

                // Current position
                const current = state.trajectory[state.trajectory.length - 1];
                ctx.beginPath();
                ctx.arc(centerX + current.x * scale, centerY - current.y * scale, 8, 0, Math.PI * 2);
                ctx.fillStyle = '#2ed573';
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();

                // Show rotation with a line from center
                const rotLen = 25;
                const rot = current.rot;
                ctx.beginPath();
                ctx.moveTo(centerX + current.x * scale, centerY - current.y * scale);
                ctx.lineTo(
                    centerX + current.x * scale + rotLen * Math.cos(-rot),
                    centerY - current.y * scale + rotLen * Math.sin(-rot)
                );
                ctx.strokeStyle = '#f472b6';
                ctx.lineWidth = 3;
                ctx.stroke();
            }

            // Origin marker
            ctx.beginPath();
            ctx.arc(centerX, centerY, 4, 0, Math.PI * 2);
            ctx.fillStyle = '#ffa502';
            ctx.fill();

            // Legend
            ctx.font = '10px Inter';
            ctx.textAlign = 'left';
            ctx.fillStyle = '#2ed573';
            ctx.fillRect(20, canvas.height - 50, 10, 10);
            ctx.fillStyle = '#888';
            ctx.fillText('è´¨å¿ƒè½¨è¿¹', 35, canvas.height - 41);

            ctx.fillStyle = '#f472b6';
            ctx.fillRect(20, canvas.height - 35, 10, 10);
            ctx.fillStyle = '#888';
            ctx.fillText('æ‰­è½¬æ–¹å‘', 35, canvas.height - 26);

            // Info text
            ctx.font = '10px JetBrains Mono';
            ctx.fillStyle = '#00d4ff';
            ctx.textAlign = 'right';
            if (state.trajectory.length > 0) {
                const latest = state.trajectory[state.trajectory.length - 1];
                ctx.fillText(`ux: ${latest.x.toFixed(1)}mm`, canvas.width - 20, canvas.height - 50);
                ctx.fillText(`uy: ${latest.y.toFixed(1)}mm`, canvas.width - 20, canvas.height - 35);
                ctx.fillStyle = '#f472b6';
                ctx.fillText(`Ï†: ${(latest.rot * 180 / Math.PI).toFixed(2)}Â°`, canvas.width - 20, canvas.height - 20);
            }
        }

        function drawStiffnessView() {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2 + 30;

            ctx.font = '12px Inter';
            ctx.fillStyle = '#888';
            ctx.textAlign = 'left';
            ctx.fillText('åˆšåº¦åˆ†æ - Kh = K0 Ã— (1 - (P/Pcr)Â²)', 20, 30);

            // Bar chart
            const barWidth = 50;
            const maxHeight = 180;
            const startX = centerX - (SUPPORT_IDS.length * (barWidth + 20)) / 2;

            SUPPORT_IDS.forEach((id, i) => {
                const s = state.supports[id];
                const x = startX + i * (barWidth + 20);
                const barHeight = s.stiffnessRatio * maxHeight;

                // Reference bar (100%)
                ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
                ctx.fillRect(x, centerY - maxHeight, barWidth, maxHeight);

                // Actual stiffness bar
                const color = s.stiffnessRatio > 0.9 ? '#2ed573' :
                    s.stiffnessRatio > 0.7 ? '#ffa502' : '#ff6b6b';
                ctx.fillStyle = color;
                ctx.fillRect(x, centerY - barHeight, barWidth, barHeight);
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 1;
                ctx.strokeRect(x, centerY - barHeight, barWidth, barHeight);

                // Value
                ctx.font = 'bold 11px JetBrains Mono';
                ctx.fillStyle = '#fff';
                ctx.textAlign = 'center';
                ctx.fillText(`${(s.stiffnessRatio * 100).toFixed(0)}%`, x + barWidth / 2, centerY - barHeight - 8);

                // Label
                ctx.font = '11px Inter';
                ctx.fillStyle = '#888';
                ctx.fillText(id, x + barWidth / 2, centerY + 20);

                // Reaction force
                ctx.font = '9px JetBrains Mono';
                ctx.fillStyle = '#666';
                ctx.fillText(`${s.N.toFixed(1)}kN`, x + barWidth / 2, centerY + 35);
            });

            // Baseline
            ctx.beginPath();
            ctx.moveTo(startX - 20, centerY);
            ctx.lineTo(startX + SUPPORT_IDS.length * (barWidth + 20), centerY);
            ctx.strokeStyle = '#555';
            ctx.lineWidth = 2;
            ctx.stroke();
        }

        // ============================================================
        // INITIALIZATION
        // ============================================================

        calculateReactions();
        updateUI();
    </script>
</body>

</html>