<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ©¡èƒ¶éš”éœ‡æ”¯åº§ä»¿çœŸ | Rubber Bearing Simulation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0a0a12 0%, #1a1a2e 50%, #0f1928 100%);
            min-height: 100vh;
            color: #e0e0e0;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
        }

        .back-link {
            display: inline-block;
            color: #888;
            text-decoration: none;
            font-size: 0.85rem;
            margin-bottom: 8px;
        }

        .back-link:hover {
            color: #00d4ff;
        }

        h1 {
            font-size: 1.6rem;
            background: linear-gradient(90deg, #2ed573, #00d4ff, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 5px;
        }

        .subtitle {
            color: #888;
            font-size: 0.85rem;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 20px;
        }

        @media (max-width: 1100px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
        }

        /* Canvas Area */
        .viz-container {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            padding: 15px;
        }

        #canvas {
            width: 100%;
            height: 450px;
            background: linear-gradient(180deg, #1a1a2e 0%, #0f0f1a 100%);
            border-radius: 10px;
            display: block;
        }

        .view-tabs {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .view-tab {
            flex: 1;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #888;
            cursor: pointer;
            text-align: center;
            font-size: 0.75rem;
            transition: all 0.2s;
        }

        .view-tab.active {
            background: rgba(46, 213, 115, 0.2);
            border-color: rgba(46, 213, 115, 0.4);
            color: #2ed573;
        }

        /* Control Panel */
        .control-panel {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            padding: 15px;
            max-height: 85vh;
            overflow-y: auto;
        }

        .section {
            margin-bottom: 15px;
        }

        .section h3 {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #888;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .section h3::before {
            content: '';
            width: 3px;
            height: 12px;
            background: linear-gradient(180deg, #2ed573, #00d4ff);
            border-radius: 2px;
        }

        /* Formula Card */
        .formula-card {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 12px;
            border-left: 3px solid #2ed573;
        }

        .formula-title {
            font-size: 0.75rem;
            color: #2ed573;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .formula-main {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.1rem;
            color: #fff;
            margin-bottom: 4px;
        }

        .formula-main .var {
            color: #f472b6;
        }

        .formula-desc {
            font-size: 0.7rem;
            color: #aaa;
            line-height: 1.4;
        }

        /* Support Height Controls */
        .height-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }

        .height-control {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 10px 8px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .height-control-label {
            font-size: 0.7rem;
            color: #888;
            margin-bottom: 4px;
        }

        .height-control-value {
            font-size: 0.85rem;
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
            color: #00d4ff;
            margin-bottom: 4px;
        }

        .height-slider {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            outline: none;
            -webkit-appearance: none;
        }

        .height-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            background: linear-gradient(135deg, #00d4ff, #2ed573);
            border-radius: 50%;
            cursor: pointer;
        }

        /* Support Info Grid */
        .support-info-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
            margin-bottom: 12px;
        }

        .support-info {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 8px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 0.65rem;
        }

        .support-info-label {
            color: #666;
            margin-bottom: 2px;
        }

        .support-info-value {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
        }

        .stat-label {
            font-size: 0.65rem;
            color: #888;
            margin-bottom: 3px;
        }

        .stat-value {
            font-size: 1rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Eccentricity Display */
        .eccentricity-display {
            background: rgba(124, 58, 237, 0.1);
            border: 1px solid rgba(124, 58, 237, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            text-align: center;
        }

        .ecc-title {
            font-size: 0.75rem;
            color: #7c3aed;
            margin-bottom: 6px;
        }

        .ecc-values {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .ecc-item {
            text-align: center;
        }

        .ecc-label {
            font-size: 0.65rem;
            color: #888;
        }

        .ecc-value {
            font-size: 0.95rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            color: #f472b6;
        }

        /* Buttons */
        .btn-group {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #2ed573, #00d4ff);
            color: #000;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #ccc;
        }

        .btn-small {
            padding: 6px 10px;
            font-size: 0.7rem;
        }

        /* Preset Buttons */
        .preset-btns {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .preset-btn {
            padding: 6px 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: #aaa;
            cursor: pointer;
            font-size: 0.7rem;
            transition: all 0.2s;
        }

        .preset-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .preset-btn.active {
            background: rgba(46, 213, 115, 0.2);
            border-color: rgba(46, 213, 115, 0.4);
            color: #2ed573;
        }

        /* Seismic Force Slider */
        .slider-group {
            margin-bottom: 10px;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
            font-size: 0.75rem;
            color: #ccc;
        }

        .slider-value {
            font-family: 'JetBrains Mono', monospace;
            color: #00d4ff;
        }

        input[type="range"] {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            background: linear-gradient(135deg, #2ed573, #00d4ff);
            border-radius: 50%;
            cursor: pointer;
        }

        /* Parameter Grid */
        .param-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .param-item {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            padding: 8px;
        }

        .param-item label {
            display: block;
            font-size: 0.65rem;
            color: #888;
            margin-bottom: 4px;
        }

        .param-item input[type="number"] {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            padding: 6px 8px;
            color: #00d4ff;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            outline: none;
        }

        .param-item input[type="number"]:focus {
            border-color: #2ed573;
        }

        /* Calculated Results */
        .calc-results {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 8px;
        }

        .calc-row {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 0.7rem;
        }

        .calc-row:last-child {
            border-bottom: none;
        }

        .calc-row span:first-child {
            color: #888;
        }

        .calc-row span:last-child {
            color: #2ed573;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Info Text */
        .info-text {
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 8px;
            padding: 10px;
            font-size: 0.7rem;
            color: #aaa;
            line-height: 1.5;
        }

        .info-text strong {
            color: #00d4ff;
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-link">â† è¿”å›æ¦‚è§ˆ</a>
            <h1>ğŸ¢ æ©¡èƒ¶éš”éœ‡æ”¯åº§ä»¿çœŸ</h1>
            <p class="subtitle">æŒ¯åŠ¨å°ç¼©å°ºæ¨¡å‹ - æ”¯åº§é«˜åº¦è°ƒèŠ‚ä¸åˆšåº¦ä¸­å¿ƒåç§»</p>
        </header>

        <div class="main-layout">
            <div class="viz-container">
                <canvas id="canvas"></canvas>
                <div class="view-tabs">
                    <div class="view-tab active" data-view="plan">ä¿¯è§†å›¾</div>
                    <div class="view-tab" data-view="trajectory">è½¨è¿¹å›¾</div>
                    <div class="view-tab" data-view="spectrum">ååº”è°±</div>
                    <div class="view-tab" data-view="stiffness">åˆšåº¦</div>
                </div>
            </div>

            <div class="control-panel">
                <!-- Core Formula -->
                <div class="formula-card">
                    <div class="formula-title">âš¡ æ ¸å¿ƒå…¬å¼</div>
                    <div class="formula-main">
                        K<sub>h</sub> = K<sub>0</sub> Ã— (1 - (Ïƒ/Ïƒ<sub>cr</sub>)Â²)
                    </div>
                    <div class="formula-desc">
                        ä½ç§»: u = F/Î£K<sub>h</sub> | æ‰­è½¬: Ï† = M<sub>T</sub>/J
                    </div>
                </div>

                <!-- Bearing Parameters (Configurable) -->
                <div class="section">
                    <h3>ğŸ”§ è¾¹ç¼˜æ”¯åº§ (4,8,25,30)</h3>
                    <div class="param-grid">
                        <div class="param-item">
                            <label>ç›´å¾„ D (mm)</label>
                            <input type="number" id="param-edge-diameter" value="44" min="20" max="100" step="1">
                        </div>
                        <div class="param-item">
                            <label>æ©¡èƒ¶å±‚æ•° n</label>
                            <input type="number" id="param-edge-layers" value="10" min="3" max="30" step="1">
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3>ğŸ”§ ä¸­é—´æ”¯åº§ (11,16)</h3>
                    <div class="param-grid">
                        <div class="param-item">
                            <label>ç›´å¾„ D (mm)</label>
                            <input type="number" id="param-mid-diameter" value="55" min="20" max="100" step="1">
                        </div>
                        <div class="param-item">
                            <label>æ©¡èƒ¶å±‚æ•° n</label>
                            <input type="number" id="param-mid-layers" value="10" min="3" max="30" step="1">
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3>âš™ï¸ ææ–™ä¸ç»“æ„å‚æ•°</h3>
                    <div class="param-grid">
                        <div class="param-item">
                            <label>æ©¡èƒ¶å±‚åš t<sub>r</sub> (mm)</label>
                            <input type="number" id="param-rubber-t" value="2" min="1" max="10" step="0.5">
                        </div>
                        <div class="param-item">
                            <label>å‰ªåˆ‡æ¨¡é‡ G (MPa)</label>
                            <input type="number" id="param-shear-g" value="0.4" min="0.2" max="1.0" step="0.05">
                        </div>
                        <div class="param-item">
                            <label>å±ˆæœé¢å‹ Ïƒ<sub>cr</sub> (MPa)</label>
                            <input type="number" id="param-yield-pressure" value="30" min="15" max="50" step="1">
                        </div>
                        <div class="param-item">
                            <label>ä¸Šéƒ¨ç»“æ„EI (kNÂ·mÂ²)</label>
                            <input type="number" id="param-ei" value="5000" min="100" max="100000" step="100">
                        </div>
                    </div>
                    <button class="btn btn-small btn-secondary" id="btn-apply-params"
                        style="margin-top: 8px; width: 100%;">åº”ç”¨å‚æ•°</button>
                </div>

                <!-- Calculated Values (Read-only) -->
                <div class="section">
                    <h3>ğŸ“Š è®¡ç®—ç»“æœ</h3>
                    <div class="calc-results">
                        <div class="calc-row">
                            <span>è¾¹ç¼˜æ”¯åº§ Kh0</span>
                            <span id="calc-kh0-edge">30 kN/m</span>
                        </div>
                        <div class="calc-row">
                            <span>ä¸­é—´æ”¯åº§ Kh0</span>
                            <span id="calc-kh0-mid">45 kN/m</span>
                        </div>
                        <div class="calc-row">
                            <span>è¾¹ç¼˜æ”¯åº§ Kv</span>
                            <span id="calc-kv-edge">500 kN/m</span>
                        </div>
                        <div class="calc-row">
                            <span>ä¸­é—´æ”¯åº§ Kv</span>
                            <span id="calc-kv-mid">800 kN/m</span>
                        </div>
                        <div class="calc-row">
                            <span>ååŠ›é‡åˆ†é…ç³»æ•° Î±</span>
                            <span id="calc-alpha">0.85</span>
                        </div>
                    </div>
                    <div class="info-text" style="margin-top: 8px; font-size: 0.6rem;">
                        Î”N = Kv Ã— Î”h Ã— Î±<br>
                        Î± = 1 / (1 + KvÃ—LÂ³/(3Ã—EI))
                    </div>
                </div>

                <!-- Support Heights -->
                <div class="section">
                    <h3>æ”¯åº§é«˜åº¦è°ƒèŠ‚ (mm)</h3>
                    <div class="height-controls">
                        <div class="height-control">
                            <div class="height-control-label">æ”¯åº§ 8</div>
                            <div class="height-control-value" id="h8-value">0</div>
                            <input type="range" class="height-slider" id="h8" min="-10" max="10" value="0" step="0.5">
                        </div>
                        <div class="height-control">
                            <div class="height-control-label">æ”¯åº§ 11</div>
                            <div class="height-control-value" id="h11-value">0</div>
                            <input type="range" class="height-slider" id="h11" min="-10" max="10" value="0" step="0.5">
                        </div>
                        <div class="height-control">
                            <div class="height-control-label">æ”¯åº§ 25</div>
                            <div class="height-control-value" id="h25-value">0</div>
                            <input type="range" class="height-slider" id="h25" min="-10" max="10" value="0" step="0.5">
                        </div>
                        <div class="height-control">
                            <div class="height-control-label">æ”¯åº§ 4</div>
                            <div class="height-control-value" id="h4-value">0</div>
                            <input type="range" class="height-slider" id="h4" min="-10" max="10" value="0" step="0.5">
                        </div>
                        <div class="height-control">
                            <div class="height-control-label">æ”¯åº§ 16</div>
                            <div class="height-control-value" id="h16-value">0</div>
                            <input type="range" class="height-slider" id="h16" min="-10" max="10" value="0" step="0.5">
                        </div>
                        <div class="height-control">
                            <div class="height-control-label">æ”¯åº§ 30</div>
                            <div class="height-control-value" id="h30-value">0</div>
                            <input type="range" class="height-slider" id="h30" min="-10" max="10" value="0" step="0.5">
                        </div>
                    </div>
                </div>

                <!-- Preset Configurations -->
                <div class="section">
                    <h3>é¢„è®¾é…ç½®</h3>
                    <div class="preset-btns">
                        <div class="preset-btn active" data-preset="level">æ°´å¹³</div>
                        <div class="preset-btn" data-preset="tilt-x">Xå‘å€¾æ–œ</div>
                        <div class="preset-btn" data-preset="tilt-y">Yå‘å€¾æ–œ</div>
                        <div class="preset-btn" data-preset="twist">æ‰­è½¬</div>
                    </div>
                </div>

                <!-- Support Info -->
                <div class="section">
                    <h3>æ”¯åº§çŠ¶æ€ (ååŠ›/é¢å‹/åˆšåº¦)</h3>
                    <div class="support-info-grid" id="support-info-grid">
                        <!-- Generated by JS -->
                    </div>
                </div>

                <!-- Summary Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">æ€»é‡ W</div>
                        <div class="stat-value" id="total-weight" style="color: #ffa502;">85.58 kN</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">è¾¹ç¼˜/ä¸­é—´ç›´å¾„</div>
                        <div class="stat-value" id="bearing-diameter" style="color: #2ed573;">44/55 mm</div>
                    </div>
                </div>

                <!-- Eccentricity Display -->
                <div class="eccentricity-display">
                    <div class="ecc-title">åˆšåº¦ä¸­å¿ƒåç§» e = C<sub>S</sub> - C<sub>M</sub></div>
                    <div class="ecc-values">
                        <div class="ecc-item">
                            <div class="ecc-label">e<sub>x</sub></div>
                            <div class="ecc-value" id="ecc-x">0.000 m</div>
                        </div>
                        <div class="ecc-item">
                            <div class="ecc-label">e<sub>y</sub></div>
                            <div class="ecc-value" id="ecc-y">0.000 m</div>
                        </div>
                        <div class="ecc-item">
                            <div class="ecc-label">|e|</div>
                            <div class="ecc-value" id="ecc-mag">0.000 m</div>
                        </div>
                    </div>
                </div>

                <!-- Seismic Input -->
                <div class="section">
                    <h3>ğŸŒŠ åœ°éœ‡æ³¢è¾“å…¥</h3>
                    <div class="param-item" style="margin-bottom: 8px;">
                        <label>é€‰æ‹©åœ°éœ‡æ³¢</label>
                        <select id="wave-select"
                            style="width: 100%; padding: 6px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 4px; color: #fff;">
                            <option value="sine">ç®€è°æ³¢ (æ­£å¼¦)</option>
                            <option value="cape-mendocino">SCB1: Cape Mendocino</option>
                            <option value="northridge">SCB2: Northridge</option>
                            <option value="th3tg045">SCB3: TH3TG045 (äººå·¥æ³¢)</option>
                            <option value="coalinga">SCB4: Coalinga</option>
                            <option value="chi-chi">SCB5: Chi-Chi å°æ¹¾</option>
                        </select>
                    </div>
                    <div class="slider-group">
                        <div class="slider-label">
                            <span>PGA (g)</span>
                            <span class="slider-value" id="pga-value">0.4</span>
                        </div>
                        <input type="range" id="pga-slider" min="0.1" max="1.0" value="0.4" step="0.05">
                    </div>
                    <div class="slider-group">
                        <div class="slider-label">
                            <span>é˜»å°¼æ¯” Î¾</span>
                            <span class="slider-value" id="damping-value">0.10</span>
                        </div>
                        <input type="range" id="damping-slider" min="0.05" max="0.20" value="0.10" step="0.01">
                    </div>
                </div>

                <!-- Relative Displacement -->
                <div class="eccentricity-display"
                    style="background: rgba(0, 212, 255, 0.1); border-color: rgba(0, 212, 255, 0.3);">
                    <div class="ecc-title" style="color: #00d4ff;">ğŸ“ ç›¸å¯¹ä½ç§» (æ”¯åº§å˜å½¢)</div>
                    <div class="ecc-values">
                        <div class="ecc-item">
                            <div class="ecc-label">u<sub>x</sub></div>
                            <div class="ecc-value" id="disp-x" style="color: #2ed573;">0.0 mm</div>
                        </div>
                        <div class="ecc-item">
                            <div class="ecc-label">u<sub>y</sub></div>
                            <div class="ecc-value" id="disp-y" style="color: #2ed573;">0.0 mm</div>
                        </div>
                        <div class="ecc-item">
                            <div class="ecc-label">Î³</div>
                            <div class="ecc-value" id="shear-strain" style="color: #ffa502;">0%</div>
                        </div>
                    </div>
                </div>

                <!-- Absolute Acceleration -->
                <div class="eccentricity-display"
                    style="background: rgba(255, 165, 2, 0.1); border-color: rgba(255, 165, 2, 0.3);">
                    <div class="ecc-title" style="color: #ffa502;">âš¡ ç»å¯¹åŠ é€Ÿåº¦ (ç»“æ„å—åŠ›)</div>
                    <div class="ecc-values">
                        <div class="ecc-item">
                            <div class="ecc-label">a<sub>g</sub></div>
                            <div class="ecc-value" id="input-acc" style="color: #ff6b6b;">0.00 g</div>
                        </div>
                        <div class="ecc-item">
                            <div class="ecc-label">a<sub>abs</sub></div>
                            <div class="ecc-value" id="abs-acc" style="color: #2ed573;">0.00 g</div>
                        </div>
                        <div class="ecc-item">
                            <div class="ecc-label">éš”éœ‡ç‡</div>
                            <div class="ecc-value" id="isolation-rate" style="color: #00d4ff;">--%</div>
                        </div>
                    </div>
                    <div class="info-text" style="margin-top: 6px; font-size: 0.55rem;">
                        éš”éœ‡ç‡ = 1 - a<sub>abs</sub>/a<sub>g</sub>
                    </div>
                </div>

                <!-- System Properties -->
                <div class="eccentricity-display"
                    style="background: rgba(46, 213, 115, 0.1); border-color: rgba(46, 213, 115, 0.3);">
                    <div class="ecc-title" style="color: #2ed573;">ğŸ“Š ç³»ç»Ÿå‚æ•°</div>
                    <div class="ecc-values">
                        <div class="ecc-item">
                            <div class="ecc-label">å‘¨æœŸ T</div>
                            <div class="ecc-value" id="period" style="color: #2ed573;">1.0 s</div>
                        </div>
                        <div class="ecc-item">
                            <div class="ecc-label">max u</div>
                            <div class="ecc-value" id="max-disp" style="color: #ff6b6b;">0 mm</div>
                        </div>
                        <div class="ecc-item">
                            <div class="ecc-label">max a</div>
                            <div class="ecc-value" id="max-acc" style="color: #ff6b6b;">0.00 g</div>
                        </div>
                    </div>
                </div>

                <!-- Torsion Result -->
                <div class="eccentricity-display"
                    style="background: rgba(255, 107, 107, 0.1); border-color: rgba(255, 107, 107, 0.3);">
                    <div class="ecc-title" style="color: #ff6b6b;">âš ï¸ æ‰­è½¬æ•ˆåº”</div>
                    <div class="ecc-values">
                        <div class="ecc-item">
                            <div class="ecc-label">Ï†</div>
                            <div class="ecc-value" id="rotation-angle" style="color: #f472b6;">0.00Â°</div>
                        </div>
                        <div class="ecc-item">
                            <div class="ecc-label">M<sub>T</sub></div>
                            <div class="ecc-value" id="torsion-moment" style="color: #ff6b6b;">0 kNÂ·m</div>
                        </div>
                        <div class="ecc-item">
                            <div class="ecc-label">|e|</div>
                            <div class="ecc-value" id="ecc-disp" style="color: #ffa502;">0 mm</div>
                        </div>
                    </div>
                </div>

                <!-- Animation -->
                <div class="btn-group">
                    <button class="btn btn-primary" id="btn-animate">â–¶ åœ°éœ‡æ¨¡æ‹Ÿ</button>
                    <button class="btn btn-secondary" id="btn-reset">â†º é‡ç½®</button>
                </div>

                <!-- Info -->
                <div class="info-text">
                    <strong>æ“ä½œè¯´æ˜ï¼š</strong><br>
                    1. è°ƒèŠ‚æ”¯åº§é«˜åº¦ â†’ åˆšåº¦ä¸­å¿ƒC<sub>S</sub>åç§»<br>
                    2. è®¾ç½®åœ°éœ‡åŠ›æ–¹å‘ â†’ è§‚å¯Ÿæ‰­è½¬åŠ›çŸ©<br>
                    3. æ‰­è½¬åŠ›çŸ© M<sub>T</sub> = |F| Ã— |e| Ã— sin(Î¸ - Î¸<sub>e</sub>)
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================================
        // CANVAS SETUP
        // ============================================================
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            canvas.width = canvas.parentElement.clientWidth - 30;
            canvas.height = 450;
        }
        resizeCanvas();
        window.addEventListener('resize', () => { resizeCanvas(); draw(); });

        // ============================================================
        // MODEL PARAMETERS - æŒ¯åŠ¨å°ç¼©å°ºæ¨¡å‹
        // ============================================================

        // å»ºç­‘å¸ƒå±€: 2è¡Œ Ã— 3åˆ—ï¼Œä¸¤è·¨
        //    8 -------- 11 -------- 25
        //    |    è·¨1   |    è·¨2    |
        //    4 -------- 16 -------- 30

        const SPAN_X = 0.6; // m (æ¯è·¨Xæ–¹å‘é•¿åº¦)
        const SPAN_Y = 0.4; // m (Yæ–¹å‘å®½åº¦)
        const TOTAL_LENGTH = SPAN_X * 2; // 1.2m
        const TOTAL_WIDTH = SPAN_Y; // 0.4m

        // æ”¯åº§åˆå§‹ååŠ› (kN) - æ¥è‡ªè¡¨æ ¼æ•°æ®
        const INITIAL_REACTIONS = {
            '8': 10.0075,   // å·¦ä¸Š
            '11': 22.7747,  // ä¸­ä¸Š
            '25': 10.0053,  // å³ä¸Š
            '4': 10.0727,   // å·¦ä¸‹
            '16': 22.6419,  // ä¸­ä¸‹
            '30': 10.0744   // å³ä¸‹
        };

        // æ”¯åº§ä½ç½® (ä»¥è´¨å¿ƒä¸ºåŸç‚¹)
        const SUPPORT_POSITIONS = {
            '8': { x: -SPAN_X, y: SPAN_Y / 2 },
            '11': { x: 0, y: SPAN_Y / 2 },
            '25': { x: SPAN_X, y: SPAN_Y / 2 },
            '4': { x: -SPAN_X, y: -SPAN_Y / 2 },
            '16': { x: 0, y: -SPAN_Y / 2 },
            '30': { x: SPAN_X, y: -SPAN_Y / 2 }
        };

        const SUPPORT_IDS = ['8', '11', '25', '4', '16', '30'];
        const TOTAL_WEIGHT = Object.values(INITIAL_REACTIONS).reduce((a, b) => a + b, 0); // 85.58 kN

        // ============================================================
        // å¯é…ç½®å‚æ•°ç³»ç»Ÿ - æ”¯æŒè¾¹ç¼˜æ”¯åº§å’Œä¸­é—´æ”¯åº§åˆ†åˆ«é…ç½®
        // ============================================================

        // å¯é…ç½®å‚æ•° (ç”¨æˆ·å¯è°ƒ)
        let params = {
            // è¾¹ç¼˜æ”¯åº§ (4, 8, 25, 30)
            edgeDiameter: 44,       // mm
            edgeLayers: 10,         // å±‚æ•°
            // ä¸­é—´æ”¯åº§ (11, 16)
            midDiameter: 55,        // mm
            midLayers: 10,          // å±‚æ•°
            // å…±ç”¨ææ–™å‚æ•°
            rubberLayerT: 2,        // mm - æ©¡èƒ¶å±‚åšåº¦
            shearModulus: 0.4,      // MPa - å‰ªåˆ‡æ¨¡é‡
            yieldPressure: 30,      // MPa - å±ˆæœé¢å‹
            // ä¸Šéƒ¨ç»“æ„å‚æ•°
            EI: 5000                // kNÂ·mÂ² - å¼¯æ›²åˆšåº¦
        };

        // è¾¹ç¼˜æ”¯åº§ IDs
        const EDGE_IDS = ['4', '8', '25', '30'];
        // ä¸­é—´æ”¯åº§ IDs
        const MID_IDS = ['11', '16'];

        // è®¡ç®—ç»“æœ (åŸºäºparamsè®¡ç®—)
        let calc = {
            // è¾¹ç¼˜æ”¯åº§å‚æ•°
            edge: {
                diameter_m: 0,
                area: 0,
                area_mm2: 0,
                totalRubberT: 0,
                shapeFactor: 0,
                Kh0: 0,
                Kv: 0
            },
            // ä¸­é—´æ”¯åº§å‚æ•°
            mid: {
                diameter_m: 0,
                area: 0,
                area_mm2: 0,
                totalRubberT: 0,
                shapeFactor: 0,
                Kh0: 0,
                Kv: 0
            },
            // ååŠ›é‡åˆ†é…ç³»æ•°
            alpha: 0
        };

        // è®¡ç®—å•ä¸ªæ”¯åº§ç»„çš„å‚æ•°
        function calcBearingParams(diameter_mm, numLayers) {
            const diameter_m = diameter_mm / 1000;
            const area = Math.PI * Math.pow(diameter_m / 2, 2);
            const totalRubberT = (params.rubberLayerT * numLayers) / 1000;
            const shapeFactor = diameter_m / (4 * params.rubberLayerT / 1000);

            const Kh0 = params.shearModulus * 1000 * area / totalRubberT;
            const Ec = 6 * params.shearModulus * shapeFactor * shapeFactor;
            const Kv = Ec * 1000 * area / totalRubberT;

            return {
                diameter_m,
                area,
                area_mm2: area * 1e6,
                totalRubberT,
                shapeFactor,
                Kh0,
                Kv
            };
        }

        // æ ¹æ®paramsé‡æ–°è®¡ç®—æ‰€æœ‰æ´¾ç”Ÿå€¼
        function recalculateParams() {
            // è®¡ç®—è¾¹ç¼˜æ”¯åº§å‚æ•°
            calc.edge = calcBearingParams(params.edgeDiameter, params.edgeLayers);
            // è®¡ç®—ä¸­é—´æ”¯åº§å‚æ•°
            calc.mid = calcBearingParams(params.midDiameter, params.midLayers);

            // è®¡ç®—ååŠ›é‡åˆ†é…ç³»æ•° Î± = 1 / (1 + Kv Ã— LÂ³ / (3 Ã— EI))
            // ä½¿ç”¨å¹³å‡Kvå’Œè·¨åº¦L = 0.6m
            const avgKv = (calc.edge.Kv * 4 + calc.mid.Kv * 2) / 6;
            const L = SPAN_X; // 0.6m
            calc.alpha = 1 / (1 + avgKv * Math.pow(L, 3) / (3 * params.EI));

            // æ›´æ–°UIæ˜¾ç¤º
            updateCalcDisplay();

            console.log('å‚æ•°æ›´æ–°:');
            console.log('  è¾¹ç¼˜æ”¯åº§: D=' + params.edgeDiameter + 'mm, Kh0=' + calc.edge.Kh0.toFixed(1) + ' kN/m, Kv=' + calc.edge.Kv.toFixed(0) + ' kN/m');
            console.log('  ä¸­é—´æ”¯åº§: D=' + params.midDiameter + 'mm, Kh0=' + calc.mid.Kh0.toFixed(1) + ' kN/m, Kv=' + calc.mid.Kv.toFixed(0) + ' kN/m');
            console.log('  ä¸Šéƒ¨ç»“æ„ EI=' + params.EI + ' kNÂ·mÂ², Î±=' + calc.alpha.toFixed(3));
        }

        // æ›´æ–°è®¡ç®—ç»“æœæ˜¾ç¤º
        function updateCalcDisplay() {
            document.getElementById('calc-kh0-edge').textContent = calc.edge.Kh0.toFixed(1) + ' kN/m';
            document.getElementById('calc-kh0-mid').textContent = calc.mid.Kh0.toFixed(1) + ' kN/m';
            document.getElementById('calc-kv-edge').textContent = calc.edge.Kv.toFixed(0) + ' kN/m';
            document.getElementById('calc-kv-mid').textContent = calc.mid.Kv.toFixed(0) + ' kN/m';
            document.getElementById('calc-alpha').textContent = calc.alpha.toFixed(3);
        }

        // åˆå§‹åŒ–è®¡ç®—
        recalculateParams();

        // ============================================================
        // STATE
        // ============================================================
        let state = {
            view: 'plan',
            heights: { '8': 0, '11': 0, '25': 0, '4': 0, '16': 0, '30': 0 }, // mm
            supports: {},
            // åœ°éœ‡æ³¢è¾“å…¥å‚æ•°
            selectedWave: 'sine',   // é€‰æ‹©çš„åœ°éœ‡æ³¢
            pga: 0.4,               // å³°å€¼åŠ é€Ÿåº¦ (g)
            damping: 0.10,          // é˜»å°¼æ¯”
            // ç³»ç»Ÿå‚æ•°ï¼ˆè®¡ç®—å¾—åˆ°ï¼‰
            totalKh: 0,             // æ€»æ°´å¹³åˆšåº¦ (kN/m)
            mass: TOTAL_WEIGHT / 9.81,  // è´¨é‡ (t)
            period: 0,              // å‘¨æœŸ (s)
            omega: 0,               // åœ†é¢‘ç‡ (rad/s)
            // è¿åŠ¨å“åº” - ç›¸å¯¹é‡
            displacement: 0,        // ç›¸å¯¹ä½ç§»
            velocity: 0,            // ç›¸å¯¹é€Ÿåº¦
            acceleration: 0,        // ç›¸å¯¹åŠ é€Ÿåº¦
            rotation: 0,
            // è¿åŠ¨å“åº” - ç»å¯¹é‡
            absAcceleration: 0,     // ç»å¯¹åŠ é€Ÿåº¦ (m/sÂ²)
            inputAcceleration: 0,   // è¾“å…¥åŠ é€Ÿåº¦ (m/sÂ²)
            isolationRate: 0,       // éš”éœ‡ç‡
            // æœ€å¤§å€¼è®°å½•
            maxDisp: 0,
            maxAbsAcc: 0,
            // åŠ¨ç”»çŠ¶æ€
            buildingDisp: { x: 0, y: 0, rot: 0 },
            buildingVel: { x: 0, y: 0 },
            buildingAcc: { x: 0, y: 0 },
            isAnimating: false,
            animTime: 0,
            // è½¨è¿¹è®°å½•
            trajectory: [],
            maxTrajectoryPoints: 300
        };

        // ============================================================
        // CALCULATIONS
        // ============================================================

        // è·å–æ”¯åº§å±äºå“ªä¸€ç»„
        function isEdgeSupport(id) {
            return EDGE_IDS.includes(id);
        }

        // è®¡ç®—æœ‰æ•ˆæ°´å¹³åˆšåº¦
        // Kh = Kh0 Ã— (1 - (Ïƒ/Ïƒ_cr)Â²)
        function calcEffectiveKh(pressure, bearingParams) {
            const ratio = pressure / params.yieldPressure;
            return bearingParams.Kh0 * Math.max(0, 1 - ratio * ratio);
        }

        // æ ¹æ®æ”¯åº§é«˜å·®è®¡ç®—ååŠ›é‡åˆ†é…
        function calculateReactions() {
            // æ”¯åº§é«˜å·®å¯¼è‡´ååŠ›å˜åŒ–ï¼šÎ”N = Kv Ã— Î”h Ã— Î±
            // Î± æ˜¯ååŠ›é‡åˆ†é…ç³»æ•°ï¼Œè€ƒè™‘ä¸Šéƒ¨ç»“æ„EI
            // éœ€è¦ä¿æŒæ€»ååŠ›ä¸å˜ï¼ˆé™åŠ›å¹³è¡¡ï¼‰

            let totalDeltaN = 0;
            const deltaN = {};

            SUPPORT_IDS.forEach(id => {
                const h = state.heights[id] / 1000; // mm -> m
                const bearingParams = isEdgeSupport(id) ? calc.edge : calc.mid;
                // ä½¿ç”¨Î±ä¿®æ­£ååŠ›å˜åŒ–
                deltaN[id] = bearingParams.Kv * h * calc.alpha;
                totalDeltaN += deltaN[id];
            });

            // è°ƒæ•´ä½¿æ€»ååŠ›ä¿æŒä¸å˜
            const avgDelta = totalDeltaN / 6;

            SUPPORT_IDS.forEach(id => {
                const baseN = INITIAL_REACTIONS[id];
                const adjustedDelta = deltaN[id] - avgDelta;
                const newN = Math.max(0.1, baseN + adjustedDelta);

                // è·å–å¯¹åº”æ”¯åº§ç»„çš„å‚æ•°
                const bearingParams = isEdgeSupport(id) ? calc.edge : calc.mid;

                // è®¡ç®—é¢å‹ (MPa)
                const pressure = (newN * 1000) / (bearingParams.area * 1e6);

                // è®¡ç®—æœ‰æ•ˆæ°´å¹³åˆšåº¦
                const Kh = calcEffectiveKh(pressure, bearingParams);
                const stiffnessRatio = Kh / bearingParams.Kh0;
                const pressureRatio = pressure / params.yieldPressure;

                state.supports[id] = {
                    x: SUPPORT_POSITIONS[id].x,
                    y: SUPPORT_POSITIONS[id].y,
                    h: state.heights[id],
                    N: newN,
                    pressure: pressure,
                    Kh: Kh,
                    Kh0: bearingParams.Kh0,
                    Kv: bearingParams.Kv,
                    diameter: isEdgeSupport(id) ? params.edgeDiameter : params.midDiameter,
                    pressureRatio: pressureRatio,
                    stiffnessRatio: stiffnessRatio
                };
            });
        }

        // è®¡ç®—åˆšåº¦ä¸­å¿ƒ
        function calculateStiffnessCenter() {
            let sumKx = 0, sumKy = 0, sumK = 0;

            SUPPORT_IDS.forEach(id => {
                const s = state.supports[id];
                sumKx += s.Kh * s.x;
                sumKy += s.Kh * s.y;
                sumK += s.Kh;
            });

            const Cs_x = sumK > 0 ? sumKx / sumK : 0;
            const Cs_y = sumK > 0 ? sumKy / sumK : 0;

            return {
                x: Cs_x,
                y: Cs_y,
                ex: Cs_x, // è´¨å¿ƒåœ¨åŸç‚¹
                ey: Cs_y,
                e_mag: Math.sqrt(Cs_x * Cs_x + Cs_y * Cs_y),
                totalK: sumK
            };
        }

        // ============================================================
        // UI UPDATES
        // ============================================================

        function updateUI() {
            calculateReactions();
            const cs = calculateStiffnessCenter();

            // Update support info grid
            const grid = document.getElementById('support-info-grid');
            grid.innerHTML = '';

            SUPPORT_IDS.forEach(id => {
                const s = state.supports[id];
                const statusColor = s.stiffnessRatio > 0.9 ? '#2ed573' :
                    s.stiffnessRatio > 0.7 ? '#ffa502' : '#ff6b6b';

                const div = document.createElement('div');
                div.className = 'support-info';
                div.innerHTML = `
                    <div class="support-info-label">æ”¯åº§ ${id}</div>
                    <div class="support-info-value" style="color: ${statusColor}">
                        ${s.N.toFixed(1)}kN / ${s.pressure.toFixed(1)}MPa
                    </div>
                    <div class="support-info-value" style="color: #00d4ff; font-size: 0.6rem;">
                        Kh=${(s.stiffnessRatio * 100).toFixed(0)}%
                    </div>
                `;
                grid.appendChild(div);
            });

            // Update eccentricity display
            document.getElementById('ecc-x').textContent = cs.ex.toFixed(4) + ' m';
            document.getElementById('ecc-y').textContent = cs.ey.toFixed(4) + ' m';
            document.getElementById('ecc-mag').textContent = cs.e_mag.toFixed(4) + ' m';

            // Calculate system parameters
            state.totalKh = cs.totalK;
            state.omega = Math.sqrt(state.totalKh / state.mass); // rad/s
            state.period = 2 * Math.PI / state.omega; // s

            // Calculate torsional stiffness: J = Î£(Kh Ã— rÂ²)
            let J = 0;
            SUPPORT_IDS.forEach(id => {
                const s = state.supports[id];
                const r2 = s.x * s.x + s.y * s.y;
                J += s.Kh * r2;
            });
            state.J = J;
            state.cs = cs;

            // Calculate average rubber thickness for shear strain
            const avgTr = (calc.edge.totalRubberT + calc.mid.totalRubberT) / 2;

            // Update system parameters display
            document.getElementById('period').textContent = state.period.toFixed(2) + ' s';
            document.getElementById('total-kh').textContent = state.totalKh.toFixed(0) + ' kN/m';
            document.getElementById('ecc-disp').textContent = (cs.e_mag * 1000).toFixed(1) + ' mm';

            // Update shear strain display (based on current displacement)
            const currentDisp = Math.sqrt(state.buildingDisp.x * state.buildingDisp.x + state.buildingDisp.y * state.buildingDisp.y);
            const shearStrain = (currentDisp / avgTr) * 100;
            document.getElementById('shear-strain').textContent = shearStrain.toFixed(0) + '%';

            // Color code shear strain
            const strainEl = document.getElementById('shear-strain');
            if (shearStrain > 200) {
                strainEl.style.color = '#ff6b6b';
            } else if (shearStrain > 150) {
                strainEl.style.color = '#ffa502';
            } else {
                strainEl.style.color = '#2ed573';
            }

            // Update displacement display
            document.getElementById('disp-x').textContent = (state.buildingDisp.x * 1000).toFixed(1) + ' mm';
            document.getElementById('disp-y').textContent = (state.buildingDisp.y * 1000).toFixed(1) + ' mm';
            document.getElementById('rotation-angle').textContent = (state.buildingDisp.rot * 180 / Math.PI).toFixed(2) + 'Â°';
            document.getElementById('max-disp').textContent = (state.maxDisp * 1000).toFixed(1) + ' mm';
            document.getElementById('torsion-moment').textContent = '0 kNÂ·m';

            // Update stats
            document.getElementById('total-weight').textContent = TOTAL_WEIGHT.toFixed(2) + ' kN';
            document.getElementById('bearing-diameter').textContent = params.edgeDiameter + '/' + params.midDiameter + ' mm';

            draw();
        }

        // ============================================================
        // HEIGHT SLIDER HANDLERS
        // ============================================================

        SUPPORT_IDS.forEach(id => {
            const slider = document.getElementById('h' + id);
            const valueEl = document.getElementById('h' + id + '-value');

            slider.addEventListener('input', (e) => {
                const val = parseFloat(e.target.value);
                state.heights[id] = val;
                valueEl.textContent = val.toFixed(1);
                updateUI();
            });
        });

        // Preset configurations
        document.querySelectorAll('.preset-btn[data-preset]').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.preset-btn[data-preset]').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                const preset = btn.dataset.preset;

                switch (preset) {
                    case 'level':
                        state.heights = { '8': 0, '11': 0, '25': 0, '4': 0, '16': 0, '30': 0 };
                        break;
                    case 'tilt-x':
                        // Xå‘å€¾æ–œï¼šå³ä¾§é«˜
                        state.heights = { '8': -3, '11': 0, '25': 3, '4': -3, '16': 0, '30': 3 };
                        break;
                    case 'tilt-y':
                        // Yå‘å€¾æ–œï¼šä¸Šä¾§é«˜
                        state.heights = { '8': 3, '11': 3, '25': 3, '4': -3, '16': -3, '30': -3 };
                        break;
                    case 'twist':
                        // æ‰­è½¬ï¼šå¯¹è§’é«˜
                        state.heights = { '8': 5, '11': 0, '25': -5, '4': -5, '16': 0, '30': 5 };
                        break;
                }

                // Update sliders
                SUPPORT_IDS.forEach(id => {
                    document.getElementById('h' + id).value = state.heights[id];
                    document.getElementById('h' + id + '-value').textContent = state.heights[id].toFixed(1);
                });

                updateUI();
            });
        });

        // Parameter apply button
        document.getElementById('btn-apply-params').addEventListener('click', () => {
            // Read values from inputs - è¾¹ç¼˜æ”¯åº§
            params.edgeDiameter = parseFloat(document.getElementById('param-edge-diameter').value);
            params.edgeLayers = parseInt(document.getElementById('param-edge-layers').value);
            // ä¸­é—´æ”¯åº§
            params.midDiameter = parseFloat(document.getElementById('param-mid-diameter').value);
            params.midLayers = parseInt(document.getElementById('param-mid-layers').value);
            // å…±ç”¨ææ–™å‚æ•°
            params.rubberLayerT = parseFloat(document.getElementById('param-rubber-t').value);
            params.shearModulus = parseFloat(document.getElementById('param-shear-g').value);
            params.yieldPressure = parseFloat(document.getElementById('param-yield-pressure').value);
            // ä¸Šéƒ¨ç»“æ„å‚æ•°
            params.EI = parseFloat(document.getElementById('param-ei').value);

            // Recalculate derived values
            recalculateParams();

            // Update all displays
            updateUI();

            console.log('å‚æ•°å·²åº”ç”¨ï¼');
        });

        // View tabs
        document.querySelectorAll('.view-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.view-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                state.view = tab.dataset.view;
                draw();
            });
        });

        // PGA slider
        const pgaSlider = document.getElementById('pga-slider');
        const pgaValue = document.getElementById('pga-value');
        pgaSlider.addEventListener('input', (e) => {
            state.pga = parseFloat(e.target.value);
            pgaValue.textContent = state.pga.toFixed(2);
            updateUI();
        });

        // Damping slider
        const dampingSlider = document.getElementById('damping-slider');
        const dampingValue = document.getElementById('damping-value');
        dampingSlider.addEventListener('input', (e) => {
            state.damping = parseFloat(e.target.value);
            dampingValue.textContent = state.damping.toFixed(2);
            updateUI();
        });

        // Wave select
        const waveSelect = document.getElementById('wave-select');
        waveSelect.addEventListener('change', (e) => {
            state.selectedWave = e.target.value;
            console.log('Selected wave:', state.selectedWave);
        });

        // Animation
        let animationId = null;
        const btnAnimate = document.getElementById('btn-animate');
        const btnReset = document.getElementById('btn-reset');

        btnAnimate.addEventListener('click', () => {
            if (!state.isAnimating) {
                state.isAnimating = true;
                btnAnimate.textContent = 'â¸ æš‚åœ';
                animate();
            } else {
                state.isAnimating = false;
                btnAnimate.textContent = 'â–¶ ç»§ç»­';
                cancelAnimationFrame(animationId);
            }
        });

        btnReset.addEventListener('click', () => {
            state.isAnimating = false;
            cancelAnimationFrame(animationId);
            state.buildingDisp = { x: 0, y: 0, rot: 0 };
            state.buildingVel = { x: 0, y: 0 };
            state.buildingAcc = { x: 0, y: 0 };
            state.animTime = 0;
            state.trajectory = [];
            state.maxDisp = 0;
            state.maxAbsAcc = 0;
            btnAnimate.textContent = 'â–¶ åœ°éœ‡æ¨¡æ‹Ÿ';
            updateUI();
        });

        function animate() {
            if (!state.isAnimating) return;

            const dt = 0.02; // æ—¶é—´æ­¥é•¿ (s)
            state.animTime += dt;
            const t = state.animTime;

            // åœ°éœ‡åŠ é€Ÿåº¦è¾“å…¥ (ç®€è°æ³¢æˆ–æ¨¡æ‹ŸçœŸå®åœ°éœ‡æ³¢)
            let ag_x, ag_y;
            const g = 9.81; // m/sÂ²

            if (state.selectedWave === 'sine') {
                // ç®€è°æ³¢: é¢‘ç‡çº¦ç­‰äºç³»ç»Ÿå›ºæœ‰é¢‘ç‡ä»¥äº§ç”Ÿå…±æŒ¯
                const exciteFreq = 1 / state.period * 0.8; // ç•¥ä½äºå…±æŒ¯é¢‘ç‡
                const omega_e = 2 * Math.PI * exciteFreq;
                ag_x = state.pga * g * Math.sin(omega_e * t);
                ag_y = state.pga * g * Math.sin(omega_e * t + Math.PI / 4); // 45åº¦ç›¸ä½å·®
            } else {
                // æ¨¡æ‹ŸçœŸå®åœ°éœ‡æ³¢çš„éšæœºç‰¹æ€§
                const envelope = Math.exp(-0.1 * Math.abs(t - 2)) * (t < 10 ? 1 : 0);
                const highFreq = Math.sin(2 * Math.PI * 5 * t) + 0.5 * Math.sin(2 * Math.PI * 8 * t);
                const lowFreq = Math.sin(2 * Math.PI * 1.5 * t);
                ag_x = state.pga * g * envelope * (0.7 * lowFreq + 0.3 * highFreq);
                ag_y = state.pga * g * envelope * (0.7 * Math.sin(2 * Math.PI * 1.3 * t) + 0.3 * Math.sin(2 * Math.PI * 6 * t + 1));
            }

            // Newmark-Î² ç§¯åˆ† (Î²=1/4, Î³=1/2 ä¸ºå¸¸åŠ é€Ÿåº¦æ³•)
            const beta = 0.25;
            const gamma = 0.5;
            const omega = state.omega;
            const xi = state.damping;
            const K = state.totalKh;
            const M = state.mass;
            const C = 2 * xi * omega * M; // é˜»å°¼ç³»æ•°

            // Xæ–¹å‘ SDOF
            const ax_old = -omega * omega * state.buildingDisp.x - 2 * xi * omega * state.buildingVel.x - ag_x / M * M;
            const Keff_x = M / (beta * dt * dt) + gamma / (beta * dt) * C + K;
            const Reff_x = -M * ag_x + M * (state.buildingDisp.x / (beta * dt * dt) + state.buildingVel.x / (beta * dt) + (1 / (2 * beta) - 1) * ax_old);
            const du_x = Reff_x / Keff_x;

            // ç®€åŒ–ä¸ºæ¬§æ‹‰æ³•æ›´ç›´è§‚
            // Ã¼ + 2Î¾Ï‰uÌ‡ + Ï‰Â²u = -a_g
            const acc_x = -2 * xi * omega * state.buildingVel.x - omega * omega * state.buildingDisp.x - ag_x;
            const acc_y = -2 * xi * omega * state.buildingVel.y - omega * omega * state.buildingDisp.y - ag_y;

            state.buildingVel.x += acc_x * dt;
            state.buildingVel.y += acc_y * dt;
            state.buildingDisp.x += state.buildingVel.x * dt;
            state.buildingDisp.y += state.buildingVel.y * dt;

            // æ‰­è½¬å“åº” (ç®€åŒ–)
            const cs = state.cs || calculateStiffnessCenter();
            const J = state.J || 0.1;
            // æ‰­è½¬åŠ›çŸ©ç”±åå¿ƒå¼•èµ·
            const Fx = K * state.buildingDisp.x;
            const Fy = K * state.buildingDisp.y;
            const torsionMoment = Fx * cs.ey - Fy * cs.ex;
            const torsionOmega = Math.sqrt(J / state.mass);
            state.buildingDisp.rot = state.buildingDisp.rot * 0.95 + (torsionMoment / J) * 0.05;

            // æ›´æ–°æœ€å¤§ä½ç§»
            const currentDisp = Math.sqrt(state.buildingDisp.x * state.buildingDisp.x + state.buildingDisp.y * state.buildingDisp.y);
            if (currentDisp > state.maxDisp) {
                state.maxDisp = currentDisp;
            }

            // è®°å½•è½¨è¿¹
            state.trajectory.push({
                x: state.buildingDisp.x * 1000, // mm
                y: state.buildingDisp.y * 1000, // mm
                rot: state.buildingDisp.rot
            });

            // é™åˆ¶è½¨è¿¹é•¿åº¦
            if (state.trajectory.length > state.maxTrajectoryPoints) {
                state.trajectory.shift();
            }

            // è®¡ç®—ç»å¯¹åŠ é€Ÿåº¦
            // a_abs = Ã¼ + a_g (ç›¸å¯¹åŠ é€Ÿåº¦ + è¾“å…¥åŠ é€Ÿåº¦)
            const abs_acc_x = acc_x + ag_x;
            const abs_acc_y = acc_y + ag_y;
            const abs_acc = Math.sqrt(abs_acc_x * abs_acc_x + abs_acc_y * abs_acc_y);
            const input_acc = Math.sqrt(ag_x * ag_x + ag_y * ag_y);

            // è®¡ç®—éš”éœ‡ç‡
            const isolationRate = input_acc > 0.01 ? (1 - abs_acc / input_acc) * 100 : 0;

            // æ›´æ–°æœ€å¤§å€¼è®°å½•
            if (abs_acc > state.maxAbsAcc) {
                state.maxAbsAcc = abs_acc;
            }

            // æ›´æ–°æ˜¾ç¤º - ç›¸å¯¹ä½ç§»
            document.getElementById('disp-x').textContent = (state.buildingDisp.x * 1000).toFixed(1) + ' mm';
            document.getElementById('disp-y').textContent = (state.buildingDisp.y * 1000).toFixed(1) + ' mm';
            document.getElementById('max-disp').textContent = (state.maxDisp * 1000).toFixed(1) + ' mm';

            // æ›´æ–°æ˜¾ç¤º - ç»å¯¹åŠ é€Ÿåº¦
            document.getElementById('input-acc').textContent = (input_acc / g).toFixed(2) + ' g';
            document.getElementById('abs-acc').textContent = (abs_acc / g).toFixed(2) + ' g';
            document.getElementById('isolation-rate').textContent = isolationRate.toFixed(0) + '%';
            document.getElementById('max-acc').textContent = (state.maxAbsAcc / g).toFixed(2) + ' g';

            // éš”éœ‡ç‡é¢œè‰²
            const isoEl = document.getElementById('isolation-rate');
            if (isolationRate > 50) {
                isoEl.style.color = '#2ed573';
            } else if (isolationRate > 20) {
                isoEl.style.color = '#ffa502';
            } else {
                isoEl.style.color = '#ff6b6b';
            }

            // æ›´æ–°æ˜¾ç¤º - æ‰­è½¬
            document.getElementById('rotation-angle').textContent = (state.buildingDisp.rot * 180 / Math.PI).toFixed(2) + 'Â°';
            document.getElementById('torsion-moment').textContent = torsionMoment.toFixed(2) + ' kNÂ·m';

            // æ›´æ–°å‰ªåº”å˜
            const avgTr = (calc.edge.totalRubberT + calc.mid.totalRubberT) / 2;
            const shearStrain = (currentDisp / avgTr) * 100;
            document.getElementById('shear-strain').textContent = shearStrain.toFixed(0) + '%';
            const strainEl = document.getElementById('shear-strain');
            if (shearStrain > 200) {
                strainEl.style.color = '#ff6b6b';
            } else if (shearStrain > 150) {
                strainEl.style.color = '#ffa502';
            } else {
                strainEl.style.color = '#2ed573';
            }

            draw();
            animationId = requestAnimationFrame(animate);
        }

        // ============================================================
        // DRAWING
        // ============================================================

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (state.view === 'plan') {
                drawPlanView();
            } else if (state.view === 'trajectory') {
                drawTrajectoryView();
            } else if (state.view === 'spectrum') {
                drawSpectrumView();
            } else {
                drawStiffnessView();
            }
        }

        function drawPlanView() {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const scale = 280; // pixels per meter

            ctx.save();
            ctx.translate(centerX + state.buildingDisp.x * scale * 5, centerY);
            ctx.rotate(state.buildingDisp.rot * 0.3);

            // Building outline
            const w = TOTAL_LENGTH * scale;
            const d = TOTAL_WIDTH * scale;

            ctx.fillStyle = 'rgba(61, 90, 128, 0.3)';
            ctx.fillRect(-w / 2, -d / 2, w, d);
            ctx.strokeStyle = '#5c7a99';
            ctx.lineWidth = 2;
            ctx.strokeRect(-w / 2, -d / 2, w, d);

            // Span divider
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(0, -d / 2);
            ctx.lineTo(0, d / 2);
            ctx.stroke();
            ctx.setLineDash([]);

            // Labels
            ctx.font = '11px Inter';
            ctx.fillStyle = '#666';
            ctx.textAlign = 'center';
            ctx.fillText('è·¨1', -w / 4, 0);
            ctx.fillText('è·¨2', w / 4, 0);

            // Draw supports
            SUPPORT_IDS.forEach(id => {
                const s = state.supports[id];
                const px = s.x * scale;
                const py = -s.y * scale;

                const size = 18;

                // Color based on stiffness ratio
                let color;
                if (s.stiffnessRatio > 0.9) {
                    color = '#2ed573';
                } else if (s.stiffnessRatio > 0.7) {
                    color = '#ffa502';
                } else {
                    color = '#ff6b6b';
                }

                // Draw bearing
                ctx.beginPath();
                ctx.arc(px, py, size, 0, Math.PI * 2);
                ctx.fillStyle = color;
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();

                // Height indicator
                if (s.h !== 0) {
                    ctx.font = '9px JetBrains Mono';
                    ctx.fillStyle = s.h > 0 ? '#00d4ff' : '#f472b6';
                    ctx.textAlign = 'center';
                    ctx.fillText((s.h > 0 ? '+' : '') + s.h.toFixed(1), px, py + size + 12);
                }

                // Label
                ctx.font = 'bold 11px Inter';
                ctx.fillStyle = '#fff';
                ctx.textAlign = 'center';
                ctx.fillText(id, px, py + 4);
            });

            // Center of Mass (CM)
            ctx.beginPath();
            ctx.arc(0, 0, 6, 0, Math.PI * 2);
            ctx.fillStyle = '#ffa502';
            ctx.fill();
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 1.5;
            ctx.stroke();

            // Center of Stiffness (CS)
            const cs = calculateStiffnessCenter();
            const csX = cs.x * scale;
            const csY = -cs.y * scale;

            ctx.beginPath();
            ctx.arc(csX, csY, 6, 0, Math.PI * 2);
            ctx.fillStyle = '#f472b6';
            ctx.fill();
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 1.5;
            ctx.stroke();

            // Eccentricity line
            if (cs.e_mag > 0.001) {
                ctx.beginPath();
                ctx.setLineDash([4, 4]);
                ctx.moveTo(0, 0);
                ctx.lineTo(csX, csY);
                ctx.strokeStyle = '#f472b6';
                ctx.lineWidth = 2;
                ctx.stroke();
                ctx.setLineDash([]);

                ctx.font = '10px JetBrains Mono';
                ctx.fillStyle = '#f472b6';
                ctx.fillText(`e=${(cs.e_mag * 1000).toFixed(1)}mm`, csX / 2 + 20, csY / 2);
            }

            // Legend
            ctx.restore();
            ctx.font = '10px Inter';
            ctx.textAlign = 'left';

            ctx.fillStyle = '#ffa502';
            ctx.fillRect(20, canvas.height - 50, 10, 10);
            ctx.fillStyle = '#888';
            ctx.fillText('CM (è´¨å¿ƒ)', 35, canvas.height - 41);

            ctx.fillStyle = '#f472b6';
            ctx.fillRect(20, canvas.height - 35, 10, 10);
            ctx.fillStyle = '#888';
            ctx.fillText('CS (åˆšåº¦ä¸­å¿ƒ)', 35, canvas.height - 26);

            // æ˜¾ç¤ºåœ°éœ‡æ³¢æ–¹å‘å’Œå½“å‰ä½ç§»
            if (state.isAnimating) {
                // åœ°éœ‡æ³¢æ–¹å‘æŒ‡ç¤º (Xå’ŒYéƒ½æœ‰)
                const arrowLen = 40;
                const baseX = canvas.width - 80;
                const baseY = 60;

                // åæ ‡è½´
                ctx.strokeStyle = '#555';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(baseX - 30, baseY);
                ctx.lineTo(baseX + 30, baseY);
                ctx.moveTo(baseX, baseY + 30);
                ctx.lineTo(baseX, baseY - 30);
                ctx.stroke();

                ctx.font = '9px Inter';
                ctx.fillStyle = '#666';
                ctx.textAlign = 'center';
                ctx.fillText('X', baseX + 35, baseY + 4);
                ctx.fillText('Y', baseX, baseY - 35);

                // å½“å‰åŠ é€Ÿåº¦æ–¹å‘
                const dispScale = 1;
                const ax = state.buildingDisp.x * 1000 * dispScale;
                const ay = -state.buildingDisp.y * 1000 * dispScale;

                ctx.beginPath();
                ctx.moveTo(baseX, baseY);
                ctx.lineTo(baseX + ax, baseY + ay);
                ctx.strokeStyle = '#00d4ff';
                ctx.lineWidth = 3;
                ctx.stroke();

                // ç®­å¤´
                ctx.beginPath();
                ctx.arc(baseX + ax, baseY + ay, 4, 0, Math.PI * 2);
                ctx.fillStyle = '#00d4ff';
                ctx.fill();

                ctx.font = 'bold 10px Inter';
                ctx.fillStyle = '#00d4ff';
                ctx.textAlign = 'left';
                ctx.fillText('ä½ç§»æ–¹å‘', baseX - 30, baseY + 50);
            }

            // åœ¨ä¸­å¿ƒç»˜åˆ¶è½¨è¿¹é¢„è§ˆ
            if (state.trajectory.length > 1) {
                ctx.save();
                ctx.translate(centerX, centerY);

                // ç»˜åˆ¶æœ€è¿‘çš„è½¨è¿¹ç‚¹
                const trajScale = scale * 5;
                ctx.beginPath();
                for (let i = Math.max(0, state.trajectory.length - 50); i < state.trajectory.length; i++) {
                    const p = state.trajectory[i];
                    const x = p.x / 1000 * trajScale; // mm -> m -> pixels
                    const y = -p.y / 1000 * trajScale;
                    const alpha = (i - state.trajectory.length + 50) / 50;

                    if (i === Math.max(0, state.trajectory.length - 50)) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.strokeStyle = 'rgba(46, 213, 115, 0.5)';
                ctx.lineWidth = 2;
                ctx.stroke();

                ctx.restore();
            }
        }

        function drawTrajectoryView() {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const scale = 8; // pixels per mm of displacement

            ctx.font = '12px Inter';
            ctx.fillStyle = '#888';
            ctx.textAlign = 'left';
            ctx.fillText('è½¨è¿¹å›¾ - è´¨å¿ƒè¿åŠ¨è½¨è¿¹ (mm)', 20, 30);

            // Draw grid
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.lineWidth = 1;
            for (let i = -5; i <= 5; i++) {
                // Vertical lines
                ctx.beginPath();
                ctx.moveTo(centerX + i * 30, centerY - 150);
                ctx.lineTo(centerX + i * 30, centerY + 150);
                ctx.stroke();
                // Horizontal lines
                ctx.beginPath();
                ctx.moveTo(centerX - 150, centerY + i * 30);
                ctx.lineTo(centerX + 150, centerY + i * 30);
                ctx.stroke();
            }

            // Draw axes
            ctx.strokeStyle = '#555';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(centerX - 160, centerY);
            ctx.lineTo(centerX + 160, centerY);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(centerX, centerY - 160);
            ctx.lineTo(centerX, centerY + 160);
            ctx.stroke();

            // Axis labels
            ctx.font = 'bold 12px Inter';
            ctx.fillStyle = '#00d4ff';
            ctx.textAlign = 'center';
            ctx.fillText('X (mm)', centerX + 140, centerY + 20);
            ctx.fillText('Y (mm)', centerX + 20, centerY - 145);

            // Draw trajectory if we have points
            if (state.trajectory.length > 1) {
                // Gradient from old (fade) to new (bright)
                for (let i = 1; i < state.trajectory.length; i++) {
                    const p0 = state.trajectory[i - 1];
                    const p1 = state.trajectory[i];
                    const alpha = i / state.trajectory.length;

                    ctx.beginPath();
                    ctx.moveTo(centerX + p0.x * scale, centerY - p0.y * scale);
                    ctx.lineTo(centerX + p1.x * scale, centerY - p1.y * scale);
                    ctx.strokeStyle = `rgba(46, 213, 115, ${alpha})`;
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }

                // Current position
                const current = state.trajectory[state.trajectory.length - 1];
                ctx.beginPath();
                ctx.arc(centerX + current.x * scale, centerY - current.y * scale, 8, 0, Math.PI * 2);
                ctx.fillStyle = '#2ed573';
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();

                // Show rotation with a line from center
                const rotLen = 25;
                const rot = current.rot;
                ctx.beginPath();
                ctx.moveTo(centerX + current.x * scale, centerY - current.y * scale);
                ctx.lineTo(
                    centerX + current.x * scale + rotLen * Math.cos(-rot),
                    centerY - current.y * scale + rotLen * Math.sin(-rot)
                );
                ctx.strokeStyle = '#f472b6';
                ctx.lineWidth = 3;
                ctx.stroke();
            }

            // Origin marker
            ctx.beginPath();
            ctx.arc(centerX, centerY, 4, 0, Math.PI * 2);
            ctx.fillStyle = '#ffa502';
            ctx.fill();

            // Legend
            ctx.font = '10px Inter';
            ctx.textAlign = 'left';
            ctx.fillStyle = '#2ed573';
            ctx.fillRect(20, canvas.height - 50, 10, 10);
            ctx.fillStyle = '#888';
            ctx.fillText('è´¨å¿ƒè½¨è¿¹', 35, canvas.height - 41);

            ctx.fillStyle = '#f472b6';
            ctx.fillRect(20, canvas.height - 35, 10, 10);
            ctx.fillStyle = '#888';
            ctx.fillText('æ‰­è½¬æ–¹å‘', 35, canvas.height - 26);

            // Info text
            ctx.font = '10px JetBrains Mono';
            ctx.fillStyle = '#00d4ff';
            ctx.textAlign = 'right';
            if (state.trajectory.length > 0) {
                const latest = state.trajectory[state.trajectory.length - 1];
                ctx.fillText(`ux: ${latest.x.toFixed(1)}mm`, canvas.width - 20, canvas.height - 50);
                ctx.fillText(`uy: ${latest.y.toFixed(1)}mm`, canvas.width - 20, canvas.height - 35);
                ctx.fillStyle = '#f472b6';
                ctx.fillText(`Ï†: ${(latest.rot * 180 / Math.PI).toFixed(2)}Â°`, canvas.width - 20, canvas.height - 20);
            }
        }

        // ååº”è°±è§†å›¾ - æ˜¾ç¤ºå‘¨æœŸä¸å“åº”çš„å…³ç³»
        function drawSpectrumView() {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const marginLeft = 60;
            const marginBottom = 50;
            const marginTop = 40;
            const marginRight = 30;
            const plotW = canvas.width - marginLeft - marginRight;
            const plotH = canvas.height - marginTop - marginBottom;

            ctx.font = '12px Inter';
            ctx.fillStyle = '#888';
            ctx.textAlign = 'left';
            ctx.fillText('ååº”è°± - å‘¨æœŸä¸å“åº”å…³ç³»', 20, 25);

            // ç»˜åˆ¶åæ ‡è½´
            ctx.strokeStyle = '#555';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(marginLeft, marginTop);
            ctx.lineTo(marginLeft, canvas.height - marginBottom);
            ctx.lineTo(canvas.width - marginRight, canvas.height - marginBottom);
            ctx.stroke();

            // è½´æ ‡ç­¾
            ctx.font = 'bold 11px Inter';
            ctx.fillStyle = '#00d4ff';
            ctx.textAlign = 'center';
            ctx.fillText('å‘¨æœŸ T (s)', centerX, canvas.height - 10);

            ctx.save();
            ctx.translate(15, centerY);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('åŠ é€Ÿåº¦å“åº” Sa (g)', 0, 0);
            ctx.restore();

            // è®¡ç®—å¹³åŠ¨å‘¨æœŸå’Œæ‰­è½¬å‘¨æœŸ
            const Tx = state.period;
            const Jm = state.mass * (TOTAL_LENGTH * TOTAL_LENGTH + TOTAL_WIDTH * TOTAL_WIDTH) / 12; // è´¨é‡æƒ¯æ€§çŸ©
            const Jk = state.J || 0.1; // æ‰­è½¬åˆšåº¦
            const Tr = 2 * Math.PI * Math.sqrt(Jm / Jk); // æ‰­è½¬å‘¨æœŸ

            // ç»˜åˆ¶è®¾è®¡ååº”è°± (ç®€åŒ–çš„æŠ—éœ‡è§„èŒƒè°±)
            const periods = [];
            const accels = [];
            const Tg = 0.4; // ç‰¹å¾å‘¨æœŸ
            const maxSa = state.pga * 2.5; // å¹³å°æ®µæ”¾å¤§ç³»æ•°çº¦2.5

            for (let T = 0.05; T <= 4; T += 0.05) {
                periods.push(T);
                let Sa;
                if (T < 0.1) {
                    Sa = state.pga + (maxSa - state.pga) * (T / 0.1);
                } else if (T < Tg) {
                    Sa = maxSa;
                } else {
                    Sa = maxSa * Math.pow(Tg / T, 0.9);
                }
                accels.push(Sa);
            }

            // ç»˜åˆ¶è°±æ›²çº¿
            const maxT = 4;
            const maxA = maxSa * 1.2;

            ctx.beginPath();
            ctx.strokeStyle = '#2ed573';
            ctx.lineWidth = 2;
            for (let i = 0; i < periods.length; i++) {
                const x = marginLeft + (periods[i] / maxT) * plotW;
                const y = canvas.height - marginBottom - (accels[i] / maxA) * plotH;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();

            // ç»˜åˆ¶å¹³åŠ¨å‘¨æœŸæ ‡è®°
            const Tx_x = marginLeft + (Tx / maxT) * plotW;
            const Tx_Sa = Tx < 0.1 ? state.pga + (maxSa - state.pga) * (Tx / 0.1) :
                Tx < Tg ? maxSa : maxSa * Math.pow(Tg / Tx, 0.9);
            const Tx_y = canvas.height - marginBottom - (Tx_Sa / maxA) * plotH;

            ctx.beginPath();
            ctx.setLineDash([5, 5]);
            ctx.strokeStyle = '#00d4ff';
            ctx.moveTo(Tx_x, canvas.height - marginBottom);
            ctx.lineTo(Tx_x, Tx_y);
            ctx.lineTo(marginLeft, Tx_y);
            ctx.stroke();
            ctx.setLineDash([]);

            ctx.beginPath();
            ctx.arc(Tx_x, Tx_y, 8, 0, Math.PI * 2);
            ctx.fillStyle = '#00d4ff';
            ctx.fill();

            // ç»˜åˆ¶æ‰­è½¬å‘¨æœŸæ ‡è®°
            if (Tr > 0 && Tr < maxT) {
                const Tr_x = marginLeft + (Tr / maxT) * plotW;
                const Tr_Sa = Tr < 0.1 ? state.pga + (maxSa - state.pga) * (Tr / 0.1) :
                    Tr < Tg ? maxSa : maxSa * Math.pow(Tg / Tr, 0.9);
                const Tr_y = canvas.height - marginBottom - (Tr_Sa / maxA) * plotH;

                ctx.beginPath();
                ctx.setLineDash([5, 5]);
                ctx.strokeStyle = '#f472b6';
                ctx.moveTo(Tr_x, canvas.height - marginBottom);
                ctx.lineTo(Tr_x, Tr_y);
                ctx.stroke();
                ctx.setLineDash([]);

                ctx.beginPath();
                ctx.arc(Tr_x, Tr_y, 6, 0, Math.PI * 2);
                ctx.fillStyle = '#f472b6';
                ctx.fill();
            }

            // å›¾ä¾‹
            ctx.font = '10px Inter';
            ctx.textAlign = 'left';

            ctx.fillStyle = '#2ed573';
            ctx.fillRect(marginLeft + 10, marginTop + 10, 20, 3);
            ctx.fillStyle = '#888';
            ctx.fillText('è®¾è®¡ååº”è°±', marginLeft + 35, marginTop + 15);

            ctx.beginPath();
            ctx.arc(marginLeft + 20, marginTop + 35, 5, 0, Math.PI * 2);
            ctx.fillStyle = '#00d4ff';
            ctx.fill();
            ctx.fillStyle = '#888';
            ctx.fillText(`å¹³åŠ¨å‘¨æœŸ Tx = ${Tx.toFixed(2)} s`, marginLeft + 35, marginTop + 38);

            ctx.beginPath();
            ctx.arc(marginLeft + 20, marginTop + 55, 4, 0, Math.PI * 2);
            ctx.fillStyle = '#f472b6';
            ctx.fill();
            ctx.fillStyle = '#888';
            ctx.fillText(`æ‰­è½¬å‘¨æœŸ TÎ¸ = ${Tr.toFixed(2)} s`, marginLeft + 35, marginTop + 58);

            // Xè½´åˆ»åº¦
            ctx.font = '9px JetBrains Mono';
            ctx.fillStyle = '#666';
            ctx.textAlign = 'center';
            for (let t = 0; t <= 4; t += 0.5) {
                const x = marginLeft + (t / maxT) * plotW;
                ctx.fillText(t.toFixed(1), x, canvas.height - marginBottom + 15);
            }

            // Yè½´åˆ»åº¦
            ctx.textAlign = 'right';
            for (let a = 0; a <= maxA; a += 0.2) {
                const y = canvas.height - marginBottom - (a / maxA) * plotH;
                ctx.fillText(a.toFixed(1), marginLeft - 5, y + 3);
            }

            // æ˜¾ç¤ºå‘¨æœŸæ¯”
            ctx.font = 'bold 11px Inter';
            ctx.textAlign = 'right';
            ctx.fillStyle = '#ffa502';
            ctx.fillText(`TÎ¸/Tx = ${(Tr / Tx).toFixed(2)}`, canvas.width - 20, marginTop + 20);

            if (Tr / Tx < 0.9) {
                ctx.fillStyle = '#ff6b6b';
                ctx.fillText('âš ï¸ æ‰­è½¬æ•ˆåº”æ˜¾è‘—', canvas.width - 20, marginTop + 40);
            }
        }

        function drawStiffnessView() {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2 + 30;

            ctx.font = '12px Inter';
            ctx.fillStyle = '#888';
            ctx.textAlign = 'left';
            ctx.fillText('åˆšåº¦åˆ†æ - Kh = K0 Ã— (1 - (P/Pcr)Â²)', 20, 30);

            // Bar chart
            const barWidth = 50;
            const maxHeight = 180;
            const startX = centerX - (SUPPORT_IDS.length * (barWidth + 20)) / 2;

            SUPPORT_IDS.forEach((id, i) => {
                const s = state.supports[id];
                const x = startX + i * (barWidth + 20);
                const barHeight = s.stiffnessRatio * maxHeight;

                // Reference bar (100%)
                ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
                ctx.fillRect(x, centerY - maxHeight, barWidth, maxHeight);

                // Actual stiffness bar
                const color = s.stiffnessRatio > 0.9 ? '#2ed573' :
                    s.stiffnessRatio > 0.7 ? '#ffa502' : '#ff6b6b';
                ctx.fillStyle = color;
                ctx.fillRect(x, centerY - barHeight, barWidth, barHeight);
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 1;
                ctx.strokeRect(x, centerY - barHeight, barWidth, barHeight);

                // Value
                ctx.font = 'bold 11px JetBrains Mono';
                ctx.fillStyle = '#fff';
                ctx.textAlign = 'center';
                ctx.fillText(`${(s.stiffnessRatio * 100).toFixed(0)}%`, x + barWidth / 2, centerY - barHeight - 8);

                // Label
                ctx.font = '11px Inter';
                ctx.fillStyle = '#888';
                ctx.fillText(id, x + barWidth / 2, centerY + 20);

                // Reaction force
                ctx.font = '9px JetBrains Mono';
                ctx.fillStyle = '#666';
                ctx.fillText(`${s.N.toFixed(1)}kN`, x + barWidth / 2, centerY + 35);
            });

            // Baseline
            ctx.beginPath();
            ctx.moveTo(startX - 20, centerY);
            ctx.lineTo(startX + SUPPORT_IDS.length * (barWidth + 20), centerY);
            ctx.strokeStyle = '#555';
            ctx.lineWidth = 2;
            ctx.stroke();
        }

        // ============================================================
        // INITIALIZATION
        // ============================================================

        calculateReactions();
        updateUI();
    </script>
</body>

</html>