<div class="chapter-header fade-in">
    <span class="chapter-badge">第 4 章</span>
    <h1 class="chapter-title">连续技！矩阵连招 <br><small style="font-size: 0.6em; color: var(--text-muted);">Matrix
            Multiplication</small></h1>
    <p class="chapter-description">
        在格斗游戏里，高手会打出"连招"——一连串组合技。
        矩阵乘法就是把两个变换"连起来"，变成一个超级大招！
    </p>
</div>

<!-- ==================== SECTION 1: 连续变换 ==================== -->
<div class="section fade-in">
    <h2 class="section-title">🎮 4.1 两个变换连起来</h2>

    <div class="content-block">
        <h3>👊 格斗游戏类比</h3>
        <p>
            假设你学会了两招：
        </p>
        <ul>
            <li><strong>招式 A</strong>：旋转踢（把对手转 90°）</li>
            <li><strong>招式 B</strong>：横推拳（把对手推向一边）</li>
        </ul>
        <p>
            如果你先 A 后 B 连起来，就是一个"连招"！
        </p>
        <p>
            在数学里，矩阵乘法 $B \times A$ 就是"先做 A，再做 B"的连招。
        </p>

        <div class="theorem-card">
            <div class="theorem-title">⚠️ 顺序很重要！</div>
            <p>
                先踢后推 ≠ 先推后踢！
                <br><br>
                数学表达：$AB \neq BA$（大多数情况）
            </p>
        </div>
    </div>

    <!-- 顺序对比图 -->
    <div style="display: flex; gap: 2rem; justify-content: center; margin: 2rem 0; flex-wrap: wrap;">
        <div style="text-align: center; max-width: 200px;">
            <p style="font-size: 1.2rem;">🔄 → 📐</p>
            <p>先旋转，后剪切</p>
            <div style="background: var(--bg-tertiary); padding: 1rem; border-radius: 8px;">
                结果 A
            </div>
        </div>
        <div style="font-size: 2rem; align-self: center;">≠</div>
        <div style="text-align: center; max-width: 200px;">
            <p style="font-size: 1.2rem;">📐 → 🔄</p>
            <p>先剪切，后旋转</p>
            <div style="background: var(--bg-tertiary); padding: 1rem; border-radius: 8px;">
                结果 B（不同！）
            </div>
        </div>
    </div>
</div>

<!-- ==================== SECTION 2: 计算方法 ==================== -->
<div class="section fade-in">
    <h2 class="section-title">🧮 4.2 怎么计算连招？</h2>

    <div class="content-block">
        <h3>🎯 追踪基向量法</h3>
        <p>
            还记得吗？矩阵的列就是 î 和 ĵ 去了哪里。
        </p>
        <p>
            要计算 $B \times A$（先 A 后 B），只需要：
        </p>
        <ol>
            <li>看 A 把 î 变到哪里（A 的第一列）</li>
            <li>再用 B 把这个结果再变一次</li>
            <li>对 ĵ 重复同样的过程</li>
        </ol>

        <div class="example-card">
            <p><strong>🎮 例子</strong></p>
            <p>
                招式 A（旋转 90°）：$\begin{bmatrix} 0 & -1 \\ 1 & 0 \end{bmatrix}$
            </p>
            <p>
                招式 B（横向拉伸）：$\begin{bmatrix} 2 & 0 \\ 0 & 1 \end{bmatrix}$
            </p>
            <p>
                连招 $B \times A$ = ?
            </p>
            <p style="margin-top: 1rem;">
                A 把 î$\begin{bmatrix}1\\0\end{bmatrix}$ 变成 $\begin{bmatrix}0\\1\end{bmatrix}$，
                然后 B 把它变成 $\begin{bmatrix}0\\1\end{bmatrix}$（不变）
            </p>
            <p>
                A 把 ĵ$\begin{bmatrix}0\\1\end{bmatrix}$ 变成 $\begin{bmatrix}-1\\0\end{bmatrix}$，
                然后 B 把它变成 $\begin{bmatrix}-2\\0\end{bmatrix}$
            </p>
            <div class="math-block">
                $$ B \times A = \begin{bmatrix} 0 & -2 \\ 1 & 0 \end{bmatrix} $$
            </div>
        </div>
    </div>
</div>

<!-- ==================== SECTION 3: 交互 ==================== -->
<div class="section fade-in">
    <h2 class="section-title">🕹️ 4.3 亲自试试连招</h2>

    <div class="viz-container">
        <div class="viz-header">
            <span class="viz-title">连招训练场</span>
            <span class="viz-badge" style="background: var(--accent-orange);">动手实验</span>
        </div>
        <div class="viz-canvas-wrapper" style="height: 450px;">
            <canvas id="viz-composition" style="width: 100%; height: 100%;"></canvas>
        </div>
        <div class="viz-controls">
            <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                <button class="btn btn-primary" id="btn-step-by-step">分两步看 (A → B)</button>
                <button class="btn btn-secondary" id="btn-composite">直接放大招 (B×A)</button>
                <button class="btn btn-secondary" id="btn-reset-comp">重置</button>
            </div>
            <p style="text-align: center; margin-top: 1rem; font-size: 0.9em; color: var(--text-muted);">
                对比一下：分两步和放大招，最终结果完全一样！
            </p>
        </div>
    </div>
</div>

<!-- ==================== SECTION 4: 应用 ==================== -->
<div class="section fade-in">
    <h2 class="section-title">🌍 4.4 游戏和动画是怎么做的？</h2>

    <div class="content-block">
        <p>
            每次你玩 3D 游戏，角色的每一帧动画都在做矩阵乘法！
        </p>

        <div
            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin: 1.5rem 0;">
            <div class="definition-card" style="border-left-color: var(--accent-blue);">
                <div class="definition-title">🎮 角色移动</div>
                <p>位移 + 旋转 + 缩放 = 连续矩阵乘法</p>
            </div>

            <div class="definition-card" style="border-left-color: var(--accent-green);">
                <div class="definition-title">🤖 机器人手臂</div>
                <p>每个关节都是一个旋转矩阵，连乘得到手的位置</p>
            </div>

            <div class="definition-card" style="border-left-color: var(--accent-purple);">
                <div class="definition-title">📷 相机视角</div>
                <p>把世界"旋转"到相机看到的角度</p>
            </div>
        </div>

        <p style="text-align: center; font-size: 1.1rem; margin-top: 2rem;">
            💡 GPU（显卡）的主要工作就是<strong>飞速计算矩阵乘法</strong>！
        </p>
    </div>
</div>

<!-- ==================== SECTION 5: 总结 ==================== -->
<div class="section fade-in">
    <h2 class="section-title">🎯 本章收获</h2>

    <div class="content-block">
        <div class="theorem-card">
            <div class="theorem-title">今天你学会了</div>
            <ol style="margin: 0; padding-left: 1.5rem; line-height: 2.2;">
                <li><strong>矩阵乘法</strong> = 两个变换"连招"</li>
                <li><strong>$B \times A$</strong> 意思是"先 A 后 B"</li>
                <li><strong>顺序很重要</strong>：$AB \neq BA$</li>
                <li>游戏、动画、机器人都在用矩阵乘法！</li>
            </ol>
        </div>

        <div
            style="text-align: center; margin-top: 2rem; padding: 2rem; background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(239, 68, 68, 0.1)); border-radius: 12px;">
            <p style="font-size: 1.2rem; margin: 0;">
                🎮 <strong>下次玩游戏时想一想</strong>
            </p>
            <p style="margin-top: 0.5rem;">
                你控制角色转圈的每一帧，GPU 都在帮你算几百万次矩阵乘法！
            </p>
        </div>
    </div>
</div>