<div class="chapter-header fade-in">
    <span class="chapter-badge">Chapter 4</span>
    <h1 class="chapter-title">矩阵乘法与复合变换 <br><small style="font-size: 0.6em; color: var(--text-muted);">Matrix
            Multiplication as Composition</small></h1>
    <p class="chapter-description">
        矩阵乘法通常被教导为一堆枯燥的"行乘以列"的算术规则。但这就好比见树木而不见森林。
        在几何上，矩阵乘法不仅简单，而且直观：它就是<strong>变换的叠加（复合）</strong>。
    </p>
</div>

<div class="section fade-in">
    <h2 class="section-title">4.1 复合变换 (Composition of Transformations)</h2>
    <div class="content-block">
        <p>
            想象我们想对一个向量进行两次操作：
        </p>
        <ol>
            <li>首先，进行<strong>旋转 (Rotate)</strong>。</li>
            <li>然后，进行<strong>剪切 (Shear)</strong>。</li>
        </ol>
        <p>
            如果旋转是函数 $f(\vec{v})$，剪切是函数 $g(\vec{v})$，那么整个过程就是 $g(f(\vec{v}))$。
            我们把这个整体称为<strong>复合变换</strong>。
        </p>

        <div class="viz-container">
            <div class="viz-header">
                <span class="viz-title">交互演示：分步 vs 复合</span>
                <span class="viz-badge">Key Insight</span>
            </div>
            <!-- Split canvas concept: Left shows linear animation, Right shows result? Or just one big one -->
            <div class="viz-canvas-wrapper" style="height: 500px;">
                <canvas id="viz-composition" style="width: 100%; height: 100%;"></canvas>
            </div>
            <div class="viz-controls">
                <div style="display: flex; gap: 1rem; justify-content: center; margin-bottom: 1rem;">
                    <button class="btn btn-primary" id="btn-step-by-step">分步执行 (Rotate then Shear)</button>
                    <button class="btn btn-secondary" id="btn-composite">一次性复合 (Composite Matrix)</button>
                    <button class="btn btn-secondary" id="btn-reset-comp">重置 (Reset)</button>
                </div>
                <p style="text-align: center; color: var(--text-secondary);">
                    <strong>观察：</strong> 无论是分两步走，还是用一个"复合矩阵"一步到位，最终 $\hat{i}$ 和 $\hat{j}$ 落脚的地方是<strong>完全一样</strong>的。
                </p>
            </div>
        </div>
    </div>
</div>

<div class="section fade-in">
    <h2 class="section-title">4.2 为什么是 "行乘以列"？ (Why Row times Column?)</h2>
    <div class="content-block">
        <p>
            这并不是随意的约定，而是追踪基向量的必然结果。
        </p>
        <p>
            假设我们有两个矩阵（变换）：
            $$ M_1 = \begin{bmatrix} 1 & 1 \\ 0 & 1 \end{bmatrix} \text{(Shear)}, \quad M_2 = \begin{bmatrix} 0 & -1 \\
            1 & 0 \end{bmatrix} \text{(Rotation)} $$
        </p>
        <p>
            想要计算 $M_2 M_1$（注意顺序！先应用右边的 $M_1$），我们需要问：
            <strong>$M_1$ 的基向量 $\hat{i}_{new}$ 在经过 $M_2$ 变换后去了哪里？</strong>
        </p>

        <div class="math-block">
            $$
            \begin{bmatrix} 0 & -1 \\ 1 & 0 \end{bmatrix}
            \begin{bmatrix} 1 & 1 \\ 0 & 1 \end{bmatrix}
            =
            \begin{bmatrix}
            (0)(1) + (-1)(0) & (0)(1) + (-1)(1) \\
            (1)(1) + (0)(0) & (1)(1) + (0)(1)
            \end{bmatrix}
            =
            \begin{bmatrix} 0 & -1 \\ 1 & 1 \end{bmatrix}
            $$
        </div>

        <div class="theorem-card">
            <div class="theorem-title">几何解释</div>
            <p>
                当你计算乘积矩阵的<strong>第一列</strong>时，你实际上是在计算：
                <br>
                <em>"变换 $M_2$ 是如何作用于 $M_1$ 的第一个基向量 $\hat{i}$ 的？"</em>
            </p>
        </div>
    </div>
</div>

<div class="section fade-in">
    <h2 class="section-title">4.3 顺序很重要 (Order Matters)</h2>
    <div class="content-block">
        <p>
            在实数乘法中，$a \times b = b \times a$。但在矩阵乘法中，这通常<strong>不成立</strong>。
        </p>
        <p>
            <strong>几何直觉：</strong>
            <br>
            "先脱袜子，再穿鞋" $\neq$ "先穿鞋，再脱袜子"。
            <br>
            同理，"先旋转后剪切"通常不同于"先剪切后旋转"。
        </p>

        <div class="example-card">
            <div class="example-title">思考实验</div>
            <p>
                想象 $\hat{i}$ 指向右边。
                <br>1. 先<strong>右移</strong> (Shear right)，它变长并斜向上了。再<strong>旋转90度</strong>，它指向左上方了。
                <br>2. 先<strong>旋转90度</strong>，它指向上面了。再<strong>右移</strong> (Shear right)，它向右倒了。
                <br>结果位置显然不同。
            </p>
        </div>
    </div>
</div>