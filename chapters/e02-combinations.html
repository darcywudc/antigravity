<div class="chapter-header fade-in">
    <span class="chapter-badge">Chapter 2</span>
    <h1 class="chapter-title">线性组合与张成空间 <br><small style="font-size: 0.6em; color: var(--text-muted);">Linear
            Combinations, Span, and Basis</small></h1>
    <p class="chapter-description">
        如果你理解了"线性组合"，你就掌握了线性代数的一半。
        我们将看到，整个二维平面——那个我们习以为常的网格——其实只是两个特殊基向量的线性组合。
    </p>
</div>

<!-- SECTION 1: Basis Vectors -->
<div class="section fade-in">
    <h2 class="section-title">2.1 基向量 (Basis Vectors)</h2>
    <div class="content-block">
        <div style="display: flex; gap: 2rem; align-items: center; flex-wrap: wrap-reverse;">
            <div style="flex: 1; min-width: 300px;">
                <p>
                    当我们写下坐标 $\begin{bmatrix} 3 \\ -2 \end{bmatrix}$ 时，我们实际上是在描述一个隐含的公式。
                </p>
                <p>
                    这里的 3 和 -2 是标量。它们在缩放两个<strong>单位向量</strong>：
                    向右的 $\hat{i}$ (i-hat) 和向上的 $\hat{j}$ (j-hat)。
                </p>
                <div class="math-block">
                    $$ \vec{v} = 3\hat{i} + (-2)\hat{j} $$
                </div>
            </div>

            <div style="flex: 1; min-width: 250px; text-align: center;">
                <!-- SVG: i and j decomposition -->
                <svg width="250" height="200" viewBox="0 0 250 200">
                    <defs>
                        <marker id="arrow-i" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#f97316" />
                        </marker>
                        <marker id="arrow-j" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#10b981" />
                        </marker>
                    </defs>
                    <!-- Grid -->
                    <pattern id="smallGrid" width="20" height="20" patternUnits="userSpaceOnUse">
                        <path d="M 20 0 L 0 0 0 20" fill="none" stroke="#333" stroke-width="0.5" />
                    </pattern>
                    <rect width="100%" height="100%" fill="url(#smallGrid)" />

                    <!-- Axes -->
                    <line x1="20" y1="180" x2="230" y2="180" stroke="#666" stroke-width="1" />
                    <line x1="20" y1="20" x2="20" y2="180" stroke="#666" stroke-width="1" />

                    <!-- i-hat * 3 -->
                    <line x1="20" y1="180" x2="140" y2="180" stroke="#f97316" stroke-width="3" />
                    <line x1="20" y1="185" x2="60" y2="185" stroke="#f97316" stroke-width="5"
                        marker-end="url(#arrow-i)" /> <!-- The unit i -->
                    <text x="40" y="170" fill="#f97316" font-weight="bold" font-size="14">i</text>
                    <text x="100" y="170" fill="#f97316">3i</text>

                    <!-- j-hat * -2 (Down) -->
                    <!-- Actually let's just show vector v -->
                    <line x1="140" y1="180" x2="140" y2="100" stroke="#10b981" stroke-width="3"
                        stroke-dasharray="4,2" />
                    <line x1="20" y1="180" x2="20" y2="140" stroke="#10b981" stroke-width="5"
                        marker-end="url(#arrow-j)" /> <!-- unit j -->
                    <text x="30" y="160" fill="#10b981" font-weight="bold" font-size="14">j</text>

                    <!-- Result v -->
                    <line x1="20" y1="180" x2="140" y2="100" stroke="#fbbf24" stroke-width="3" />
                    <circle cx="140" cy="100" r="4" fill="#fbbf24" />
                    <text x="150" y="100" fill="#fbbf24" font-weight="bold">v = 3i + 2j</text>
                    <!-- Diagram uses +2j for clearer visual layout than -2 -->
                </svg>
                <p style="font-size: 0.8em; color: var(--text-muted); margin-top:0.5rem;">
                    示意图：向量如何分解为 $\hat{i}$ 和 $\hat{j}$ 的组合
                </p>
            </div>
        </div>
    </div>
</div>

<!-- SECTION 2: Grid Interactive -->
<div class="section fade-in">
    <h2 class="section-title">2.2 变换基向量 = 变换坐标系 (Changing Basis)</h2>
    <div class="content-block">
        <p>
            现在的关键问题来了：<strong>如果我们改变 $\hat{i}$ 和 $\hat{j}$ 呢？</strong>
        </p>
        <p>
            如果 $\hat{i}$ 变长了，或者 $\hat{j}$ 歪了，坐标 $\begin{bmatrix} 2 \\ 1 \end{bmatrix}$ 代表的位置也会随之改变。
            这就是"线性变换"的本质——通过改变基向量来扭曲空间。
        </p>
    </div>

    <div class="viz-container">
        <div class="viz-header">
            <span class="viz-title">交互演示：坐标系的本质</span>
            <span class="viz-badge">Core Concept</span>
        </div>
        <div class="viz-canvas-wrapper" style="height: 500px;">
            <canvas id="viz-basis-change" style="width: 100%; height: 100%;"></canvas>
        </div>
        <div class="viz-controls">
            <div style="display: flex; gap: 1rem; align-items: center; justify-content: space-between;">
                <div>
                    <p style="margin: 0; color: var(--text-primary);">
                        <strong>任务：</strong> 拖拽 <span style="color:#f97316">橙色 i</span> 和 <span style="color:#10b981">绿色
                            j</span>。
                    </p>
                    <p style="margin-top: 5px; font-size: 0.9em; color: var(--text-muted);">
                        观察那个黄色的点 $v = 2\hat{i} + 1\hat{j}$ 是如何随着网格的变形而移动的。
                    </p>
                </div>
                <button class="btn btn-secondary" id="reset-basis">重置 (Reset)</button>
            </div>
        </div>
    </div>
</div>

<!-- SECTION 3: Span -->
<div class="section fade-in">
    <h2 class="section-title">2.3 张成空间 (Span)</h2>
    <div class="content-block">
        <div style="display: flex; gap: 1.5rem; flex-wrap: wrap;">
            <div style="flex: 1; min-width: 300px;">
                <div class="definition-card">
                    <div class="definition-title">定义：张成空间 (Span)</div>
                    <p>
                        一组向量的 <strong>Span</strong>，就是通过<strong>线性组合</strong>这组向量所能到达的所有点的集合。
                    </p>
                </div>
                <p>
                    对于两个 2D 向量 $\vec{v}$ 和 $\vec{w}$：
                </p>
                <ul style="color: var(--text-secondary);">
                    <li style="margin-bottom: 0.5rem;"><strong style="color:var(--text-primary)">通常情况：</strong> 它们张成整个
                        2D 平面（也就是你可以去任何地方）。</li>
                    <li style="margin-bottom: 0.5rem;"><strong style="color:var(--text-primary)">共线情况：</strong>
                        如果它们在一条线上，它们被困在一条直线上 (Line)。</li>
                </ul>
            </div>

            <!-- Span Visuals -->
            <div style="flex: 1; display: flex; flex-direction: column; gap: 1rem; min-width: 200px;">
                <div style="background: var(--bg-tertiary); padding: 10px; border-radius: 8px; text-align: center;">
                    <svg width="200" height="100" viewBox="0 0 200 100">
                        <rect x="0" y="0" width="200" height="100" fill="rgba(74, 158, 255, 0.2)" />
                        <text x="100" y="50" text-anchor="middle" fill="#4a9eff" opacity="0.8" font-size="14">Whole
                            Plane (2D)</text>
                        <line x1="100" y1="50" x2="130" y2="20" stroke="#fff" stroke-width="2" />
                        <line x1="100" y1="50" x2="80" y2="80" stroke="#fff" stroke-width="2" />
                    </svg>
                    <p style="font-size: 0.8em; margin: 5px 0 0 0;">独立向量 -> 面</p>
                </div>
                <div style="background: var(--bg-tertiary); padding: 10px; border-radius: 8px; text-align: center;">
                    <svg width="200" height="100" viewBox="0 0 200 100">
                        <line x1="0" y1="100" x2="200" y2="0" stroke="rgba(249, 115, 22, 0.5)" stroke-width="4" />
                        <text x="140" y="30" text-anchor="middle" fill="#f97316" font-size="14">Just a Line (1D)</text>
                        <line x1="100" y1="50" x2="120" y2="40" stroke="#fff" stroke-width="2" />
                        <line x1="100" y1="50" x2="60" y2="70" stroke="#fff" stroke-width="2" />
                    </svg>
                    <p style="font-size: 0.8em; margin: 5px 0 0 0;">共线向量 -> 线</p>
                </div>
            </div>
        </div>
    </div>
</div>