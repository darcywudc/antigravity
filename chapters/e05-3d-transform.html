<div class="chapter-header fade-in">
    <span class="chapter-badge">第 5 章</span>
    <h1 class="chapter-title">欢迎来到 3D 世界 <br><small
            style="font-size: 0.6em; color: var(--text-muted);">Three-Dimensional Linear Transformations</small></h1>
    <p class="chapter-description">
        2D 很有趣，但真正的魔法发生在 3D 世界！
        游戏里的 3D 角色、VR 眼镜里的虚拟世界、电影特效——都是 3D 矩阵在幕后工作。
    </p>
</div>

<!-- 核心词汇 -->
<div class="section fade-in">
    <div class="vocab-summary">
        <div class="vocab-title">本章核心词汇</div>
        <div class="vocab-list">
            <div class="vocab-item"><span class="vocab-zh">三维空间</span><span class="vocab-en">3D Space</span></div>
            <div class="vocab-item"><span class="vocab-zh">3×3 矩阵</span><span class="vocab-en">3×3 Matrix</span></div>
            <div class="vocab-item"><span class="vocab-zh">绕轴旋转</span><span class="vocab-en">Rotation about Axis</span>
            </div>
            <div class="vocab-item"><span class="vocab-zh">投影</span><span class="vocab-en">Projection</span></div>
        </div>
    </div>
</div>

<!-- SECTION 1 -->
<div class="section fade-in">
    <h2 class="section-title">🧊 5.1 多了一个方向</h2>

    <div class="content-block">
        <p>在 2D 中，我们有两个基向量：</p>
        <ul>
            <li><span style="color:#f97316; font-weight:bold;">î</span>：向右</li>
            <li><span style="color:#10b981; font-weight:bold;">ĵ</span>：向上</li>
        </ul>

        <p>在 3D 中，我们多了一个：</p>
        <ul>
            <li><span style="color:#4a9eff; font-weight:bold;">k̂</span>：向前（出屏幕/朝向你）</li>
        </ul>

        <div style="display: flex; gap: 1.5rem; justify-content: center; margin: 2rem 0; flex-wrap: wrap;">
            <div style="text-align: center; padding: 1.5rem; background: rgba(249, 115, 22, 0.1); border-radius: 12px;">
                <p style="font-size: 2rem; margin: 0; color: #f97316;">î</p>
                <p style="margin: 0.5rem 0;">$\begin{bmatrix} 1 \\ 0 \\ 0 \end{bmatrix}$</p>
                <p style="font-size: 0.9em;">向右 (X轴)</p>
            </div>
            <div style="text-align: center; padding: 1.5rem; background: rgba(16, 185, 129, 0.1); border-radius: 12px;">
                <p style="font-size: 2rem; margin: 0; color: #10b981;">ĵ</p>
                <p style="margin: 0.5rem 0;">$\begin{bmatrix} 0 \\ 1 \\ 0 \end{bmatrix}$</p>
                <p style="font-size: 0.9em;">向上 (Y轴)</p>
            </div>
            <div style="text-align: center; padding: 1.5rem; background: rgba(74, 158, 255, 0.1); border-radius: 12px;">
                <p style="font-size: 2rem; margin: 0; color: #4a9eff;">k̂</p>
                <p style="margin: 0.5rem 0;">$\begin{bmatrix} 0 \\ 0 \\ 1 \end{bmatrix}$</p>
                <p style="font-size: 0.9em;">向前 (Z轴)</p>
            </div>
        </div>

        <div class="connection-box">
            <div class="connection-title">《我的世界》坐标系</div>
            <p>在《我的世界》中：X = 东西，Y = 上下，Z = 南北</p>
            <p>当你看到坐标 (100, 64, -200)，意思是：向东 100 格，高度 64，向南 200 格</p>
        </div>
    </div>
</div>

<!-- SECTION 2 -->
<div class="section fade-in">
    <h2 class="section-title">📦 5.2 3×3 矩阵</h2>

    <div class="content-block">
        <p>2D 变换用 2×2 矩阵，3D 变换用 <span class="term" data-en="3×3 Matrix">3×3 矩阵</span>：</p>

        <div style="text-align: center; margin: 2rem 0;">
            <div style="font-size: 1.4rem;">
                $\begin{bmatrix}
                \color{#f97316}{a} & \color{#10b981}{d} & \color{#4a9eff}{g} \\
                \color{#f97316}{b} & \color{#10b981}{e} & \color{#4a9eff}{h} \\
                \color{#f97316}{c} & \color{#10b981}{f} & \color{#4a9eff}{i}
                \end{bmatrix}$
            </div>
            <p style="margin-top: 1rem;">
                <span style="color:#f97316">第1列</span> = î 去哪了 &nbsp;|&nbsp;
                <span style="color:#10b981">第2列</span> = ĵ 去哪了 &nbsp;|&nbsp;
                <span style="color:#4a9eff">第3列</span> = k̂ 去哪了
            </p>
        </div>

        <div class="aha-box">
            <div class="aha-title">规则完全相同！</div>
            <p>
                3D 矩阵和 2D 矩阵的本质完全一样——<strong>列就是变换后的基向量</strong>。
                只是多了一维，从 4 个数变成了 9 个数。
            </p>
        </div>
    </div>
</div>

<!-- SECTION 3 -->
<div class="section fade-in">
    <h2 class="section-title">🎢 5.3 3D 变换图鉴</h2>

    <div class="content-block">
        <div class="example-ladder">
            <div class="example-step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <div class="step-label">🔄 绕 Z 轴旋转</div>
                    <p>就像旋转一个飞盘——物体在 XY 平面内转圈，高度 (Z) 不变</p>
                    <p style="font-size: 0.9em; color: var(--text-muted);">
                        矩阵形式：Z 列不变，X 和 Y 列按照 2D 旋转规则变化
                    </p>
                </div>
            </div>
            <div class="example-step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <div class="step-label">🔄 绕 X 轴旋转</div>
                    <p>就像翻跟斗——前后翻转，左右位置不变</p>
                    <p style="font-size: 0.9em; color: var(--text-muted);">
                        想象健身房的翻转运动
                    </p>
                </div>
            </div>
            <div class="example-step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <div class="step-label">🔄 绕 Y 轴旋转</div>
                    <p>就像转头——左右看，高度不变</p>
                    <p style="font-size: 0.9em; color: var(--text-muted);">
                        这是游戏中最常见的相机旋转
                    </p>
                </div>
            </div>
            <div class="example-step">
                <div class="step-number">4</div>
                <div class="step-content">
                    <div class="step-label">📸 投影</div>
                    <p>把 3D 物体"拍扁"成 2D 照片</p>
                    <p style="font-size: 0.9em; color: var(--text-muted);">
                        这就是相机和你的眼睛在做的事情！
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Interactive 3D Demo -->
    <div class="viz-container">
        <div class="viz-header">
            <span class="viz-title">🕹️ 动手体验：3D 坐标系</span>
            <span class="viz-badge" style="background: var(--accent-purple);">拖拽旋转</span>
        </div>
        <div class="viz-canvas-wrapper" style="height: 400px;">
            <canvas id="viz-3d-transform" style="width: 100%; height: 100%;"></canvas>
        </div>
        <div class="viz-controls">
            <p style="text-align: center; color: var(--text-muted);">
                🖱️ 拖拽画布旋转 3D 视角，观察三个基向量 î, ĵ, k̂ 和紫色立方体
            </p>
        </div>
    </div>
</div>

<!-- SECTION 4: 应用 -->
<div class="section fade-in">
    <h2 class="section-title">🌍 5.4 无处不在的 3D 矩阵</h2>

    <div class="why-matters">
        <div class="why-title">为什么 3D 矩阵如此重要？</div>
        <p>因为我们生活在 3D 世界，而所有数字 3D 内容都需要矩阵来计算！</p>
    </div>

    <div class="real-world">
        <div class="real-world-item">
            <div class="rw-icon">🎮</div>
            <div class="rw-title">所有 3D 游戏</div>
            <div class="rw-desc">角色移动、相机旋转、爆炸效果</div>
        </div>
        <div class="real-world-item">
            <div class="rw-icon">🥽</div>
            <div class="rw-title">VR/AR 应用</div>
            <div class="rw-desc">实时追踪头部运动</div>
        </div>
        <div class="real-world-item">
            <div class="rw-icon">✈️</div>
            <div class="rw-title">飞行模拟</div>
            <div class="rw-desc">俯仰、偏航、滚转</div>
        </div>
        <div class="real-world-item">
            <div class="rw-icon">🤖</div>
            <div class="rw-title">机器人</div>
            <div class="rw-desc">机械臂的每个关节</div>
        </div>
        <div class="real-world-item">
            <div class="rw-icon">🎬</div>
            <div class="rw-title">电影特效</div>
            <div class="rw-desc">CGI 角色动画</div>
        </div>
        <div class="real-world-item">
            <div class="rw-icon">🏗️</div>
            <div class="rw-title">建筑设计</div>
            <div class="rw-desc">3D 建模软件</div>
        </div>
    </div>

    <div class="deep-dive">
        <div class="deep-title">有趣的事实</div>
        <p>
            你的显卡每秒钟要做<strong>数十亿次</strong> 3D 矩阵运算来渲染游戏画面。
            一个 60 帧的游戏，意味着每秒要完整计算 60 次整个 3D 场景！
        </p>
    </div>

    <!-- 新增：练习题 -->
    <div class="challenge-box" style="margin-top: 2rem;">
        <div class="challenge-title">✍️ 动手练习</div>
        <p><strong>下列 3D 变换对应什么样的 3×3 矩阵？</strong></p>
        <ol>
            <li>把所有东西放大 2 倍</li>
            <li>沿 z 轴（高度）压缩到原来的一半</li>
        </ol>
        <details style="margin-top: 1rem;">
            <summary style="cursor: pointer; color: var(--accent-blue); font-weight: bold;">👆 点击查看答案</summary>
            <div style="margin-top: 0.5rem; padding: 1rem; background: rgba(16, 185, 129, 0.1); border-radius: 8px;">
                <ol>
                    <li>$\begin{bmatrix} 2 & 0 & 0 \\ 0 & 2 & 0 \\ 0 & 0 & 2 \end{bmatrix}$ — 三个基向量都变成 2 倍长</li>
                    <li>$\begin{bmatrix} 1 & 0 & 0 \\ 0 & 1 & 0 \\ 0 & 0 & 0.5 \end{bmatrix}$ — î 和 ĵ 不变，k̂ 变成一半</li>
                </ol>
            </div>
        </details>
    </div>

    <!-- 新增：常见误区 -->
    <div class="definition-card" style="border-left-color: var(--accent-orange); margin-top: 2rem;">
        <div class="definition-title" style="color: var(--accent-orange);">⚠️ 常见误区</div>
        <p><strong>误区</strong>："3D 变换比 2D 难很多"</p>
        <p><strong>纠正</strong>：其实规则完全一样！只是从 2×2 变成 3×3，多了一个基向量 k̂ 而已。</p>
        <p style="margin-top: 0.5rem; font-size: 0.9em; color: var(--text-muted);">
            每一列仍然代表一个基向量变换后的位置——这个核心思想不变。
        </p>
    </div>

    <!-- 新增：趣味知识 -->
    <div class="deep-dive" style="margin-top: 2rem; border-left: 4px solid var(--accent-purple);">
        <div class="deep-title">🕹️ 趣味应用：飞行模拟中的欧拉角</div>
        <p>
            飞行员描述飞机姿态用三个角度：俯仰（Pitch）、偏航（Yaw）、滚转（Roll）。
        </p>
        <p style="margin-top: 0.5rem;">
            每个角度对应绕一个坐标轴旋转的 3D 矩阵。把三个矩阵相乘，就得到飞机的完整姿态变换！
        </p>
    </div>
</div>

<!-- ==================== 实战应用 ==================== -->
<div class="section fade-in">
    <h2 class="section-title">🎯 实战应用：用3D矩阵解决真实问题</h2>

    <div class="content-block">
        <p style="font-size: 1.1rem; margin-bottom: 2rem;">
            3D矩阵变换是游戏引擎、VR、机器人和电影特效的核心。每一帧画面背后都是数百万次3D矩阵运算。
        </p>

        <!-- 问题 1：相机旋转 -->
        <div class="deep-dive" style="border-left: 4px solid var(--accent-blue); margin-bottom: 2rem;">
            <div class="deep-title">🎥 问题 1：第一人称相机旋转</div>

            <div style="background: rgba(74, 158, 255, 0.05); padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                <p><strong>场景</strong>：在FPS游戏中，玩家向右转头 90°（绕 y 轴）。相机原本朝向 $\vec{f} = (0, 0, -1)$（看向屏幕里）。</p>
                <p><strong>问题</strong>：旋转后，相机朝向哪个方向？</p>
            </div>

            <div class="example-ladder">
                <div class="example-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <div class="step-label">构造绕 y 轴旋转 90° 的矩阵</div>
                        <div class="math-block">
                            $R_y = \begin{bmatrix}\cos 90° & 0 & \sin 90°\\0 & 1 & 0\\-\sin 90° & 0 & \cos
                            90°\end{bmatrix} = \begin{bmatrix}0 & 0 & 1\\0 & 1 & 0\\-1 & 0 & 0\end{bmatrix}$
                        </div>
                    </div>
                </div>
                <div class="example-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <div class="step-label">应用旋转</div>
                        <div class="math-block">
                            $R_y \cdot \vec{f} = \begin{bmatrix}0 & 0 & 1\\0 & 1 & 0\\-1 & 0 & 0\end{bmatrix}
                            \begin{bmatrix}0\\0\\-1\end{bmatrix} = \begin{bmatrix}-1\\0\\0\end{bmatrix}$
                        </div>
                    </div>
                </div>
                <div class="example-step">
                    <div class="step-number">✓</div>
                    <div class="step-content" style="background: rgba(16, 185, 129, 0.1);">
                        <div class="step-label" style="color: var(--accent-green);">答案</div>
                        <p>相机现在朝向 <strong>$(-1, 0, 0)$</strong>，即左边！（向右转头，看向左边）</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 问题 2：物体缩放 -->
        <div class="deep-dive" style="border-left: 4px solid var(--accent-orange); margin-bottom: 2rem;">
            <div class="deep-title">📦 问题 2：非均匀缩放（挤压物体）</div>

            <div style="background: rgba(249, 115, 22, 0.05); padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                <p><strong>场景</strong>：一个立方体模型需要变成"扁盒子"：X 方向缩放 2 倍，Y 方向缩放 0.5 倍，Z 不变。</p>
                <p>立方体顶点 $(1, 1, 1)$ 变换后在哪？</p>
            </div>

            <div class="example-ladder">
                <div class="example-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <div class="step-label">构造缩放矩阵</div>
                        <div class="math-block">
                            $S = \begin{bmatrix}2 & 0 & 0\\0 & 0.5 & 0\\0 & 0 & 1\end{bmatrix}$
                        </div>
                    </div>
                </div>
                <div class="example-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <div class="step-label">应用变换</div>
                        <div class="math-block">
                            $S \cdot \begin{bmatrix}1\\1\\1\end{bmatrix} = \begin{bmatrix}2\\0.5\\1\end{bmatrix}$
                        </div>
                    </div>
                </div>
                <div class="example-step">
                    <div class="step-number">✓</div>
                    <div class="step-content" style="background: rgba(16, 185, 129, 0.1);">
                        <div class="step-label" style="color: var(--accent-green);">答案</div>
                        <p>顶点移动到 <strong>$(2, 0.5, 1)$</strong>。立方体变成了扁盒子！</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 问题 3：VR 头显姿态 -->
        <div class="deep-dive" style="border-left: 4px solid var(--accent-purple);">
            <div class="deep-title">🥽 问题 3：VR 头显姿态组合</div>

            <div style="background: rgba(139, 92, 246, 0.05); padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                <p><strong>场景</strong>：VR头显传感器检测到：先低头30°（绕x轴），再左转45°（绕y轴）。</p>
                <p><strong>问题</strong>：如何用一个矩阵表示最终姿态？</p>
            </div>

            <div class="example-ladder">
                <div class="example-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <div class="step-label">分别构造两个旋转矩阵</div>
                        <p>$R_x(30°)$ = 绕x轴低头，$R_y(45°)$ = 绕y轴左转</p>
                    </div>
                </div>
                <div class="example-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <div class="step-label">矩阵乘法：$M = R_y \cdot R_x$</div>
                        <p>先执行的变换（低头）放右边，后执行的（左转）放左边。</p>
                    </div>
                </div>
                <div class="example-step">
                    <div class="step-number">✓</div>
                    <div class="step-content" style="background: rgba(16, 185, 129, 0.1);">
                        <div class="step-label" style="color: var(--accent-green);">答案</div>
                        <p>最终姿态矩阵 $M = R_y(45°) \cdot R_x(30°)$。用这个矩阵可以把虚拟世界"反向旋转"到用户视角！</p>
                    </div>
                </div>
            </div>

            <div class="aha-box" style="margin-top: 1rem;">
                <div class="aha-title">💡 这就是"欧拉角到旋转矩阵"</div>
                <p>Unity/Unreal 里的 <code>Quaternion.Euler(x, y, z)</code> 本质上就是把三个角度转换成一个旋转矩阵（或四元数）！</p>
            </div>
        </div>

        <!-- 挑战题 -->
        <div class="challenge-box" style="margin-top: 2rem;">
            <div class="challenge-title">🚀 挑战：镜像世界</div>
            <p><strong>问题</strong>：如何用一个 3×3 矩阵实现"左右镜像"（沿 yz 平面翻转）？</p>
            <details style="margin-top: 1rem;">
                <summary style="cursor: pointer; color: var(--accent-blue); font-weight: bold;">👆 点击查看答案</summary>
                <div
                    style="margin-top: 0.5rem; padding: 1rem; background: rgba(16, 185, 129, 0.1); border-radius: 8px;">
                    <p>沿 yz 平面翻转 = X 坐标取反</p>
                    <div class="math-block">
                        $M = \begin{bmatrix}-1 & 0 & 0\\0 & 1 & 0\\0 & 0 & 1\end{bmatrix}$
                    </div>
                    <p>点 $(3, 2, 1)$ 变成 $(-3, 2, 1)$。</p>
                </div>
            </details>
        </div>

    </div>
</div>

<!-- 总结 -->
<div class="section fade-in">
    <h2 class="section-title">🎯 本章收获</h2>

    <div class="content-block">
        <div class="theorem-card">
            <div class="theorem-title">核心要点</div>
            <ol style="margin: 0; padding-left: 1.5rem; line-height: 2.2;">
                <li>3D 有三个基向量：<span style="color:#f97316">î</span>, <span style="color:#10b981">ĵ</span>, <span
                        style="color:#4a9eff">k̂</span></li>
                <li>3D 变换用 <span class="term" data-en="3×3 Matrix">3×3 矩阵</span></li>
                <li>规则和 2D 完全一样：<strong>列 = 变换后的基向量</strong></li>
                <li>游戏、VR、机器人、电影特效都在用 3D 矩阵！</li>
            </ol>
        </div>

        <div class="concept-map">
            <div class="concept-node">2D 矩阵</div>
            <div class="concept-arrow">+1维</div>
            <div class="concept-node">3D 矩阵</div>
            <div class="concept-arrow">→</div>
            <div class="concept-node" style="background: linear-gradient(135deg, #10b981, #059669);">下一章：行列式</div>
        </div>
    </div>
</div>