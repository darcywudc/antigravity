<div class="chapter-header fade-in">
    <span class="chapter-badge">第 3 章</span>
    <h1 class="chapter-title">矩阵：空间的变形术 <br><small style="font-size: 0.6em; color: var(--text-muted);">Linear
            Transformations & Matrices</small></h1>
    <p class="chapter-description">
        如果你能把整个空间像橡皮泥一样拉伸、旋转、翻转，世界会变成什么样？
        矩阵就是控制这种"变形"的遥控器！
    </p>
</div>

<!-- 核心词汇 -->
<div class="section fade-in">
    <div class="vocab-summary">
        <div class="vocab-title">本章核心词汇</div>
        <div class="vocab-list">
            <div class="vocab-item"><span class="vocab-zh">线性变换</span><span class="vocab-en">Linear
                    Transformation</span></div>
            <div class="vocab-item"><span class="vocab-zh">矩阵</span><span class="vocab-en">Matrix</span></div>
            <div class="vocab-item"><span class="vocab-zh">旋转</span><span class="vocab-en">Rotation</span></div>
            <div class="vocab-item"><span class="vocab-zh">剪切</span><span class="vocab-en">Shear</span></div>
            <div class="vocab-item"><span class="vocab-zh">缩放</span><span class="vocab-en">Scaling</span></div>
        </div>
    </div>
</div>

<!-- SECTION 1 -->
<div class="section fade-in">
    <h2 class="section-title">🔄 3.1 什么是线性变换？</h2>

    <div class="content-block">
        <h3>📷 类比：照片滤镜</h3>
        <p>你用手机拍完照后可以加滤镜：</p>
        <ul>
            <li>放大照片 → <span class="term" data-en="Scaling">缩放</span></li>
            <li>旋转照片 → <span class="term" data-en="Rotation">旋转</span></li>
            <li>镜像翻转 → <span class="term" data-en="Reflection">反射</span></li>
            <li>倾斜照片 → <span class="term" data-en="Shear">剪切</span></li>
        </ul>
        <p>这些都是<span class="term" data-en="Linear Transformation">线性变换</span>的例子！</p>

        <div class="theorem-card">
            <div class="theorem-title">🔑 线性变换的两条规则</div>
            <ol>
                <li><strong>原点不动</strong>：中心永远是中心</li>
                <li><strong>直线保持为直线</strong>：不能把直线弯成曲线，网格线保持平行</li>
            </ol>
        </div>

        <div style="display: flex; gap: 2rem; justify-content: center; margin: 2rem 0; flex-wrap: wrap;">
            <div style="text-align: center;">
                <svg width="120" height="100" viewBox="0 0 120 100">
                    <g stroke="#4a9eff" stroke-width="1" fill="none">
                        <line x1="20" y1="20" x2="20" y2="80" />
                        <line x1="50" y1="20" x2="50" y2="80" />
                        <line x1="80" y1="20" x2="80" y2="80" />
                        <line x1="20" y1="20" x2="80" y2="20" />
                        <line x1="20" y1="50" x2="80" y2="50" />
                        <line x1="20" y1="80" x2="80" y2="80" />
                    </g>
                </svg>
                <p style="color: var(--accent-green);">✅ 线性变换</p>
            </div>
            <div style="text-align: center;">
                <svg width="120" height="100" viewBox="0 0 120 100">
                    <g stroke="#ec4899" stroke-width="1" fill="none">
                        <path d="M 20 20 Q 50 30, 80 20" />
                        <path d="M 20 50 Q 50 40, 80 50" />
                        <path d="M 20 80 Q 50 70, 80 80" />
                    </g>
                </svg>
                <p style="color: #ec4899;">❌ 非线性（线弯了）</p>
            </div>
        </div>
    </div>
</div>

<!-- SECTION 2 -->
<div class="section fade-in">
    <h2 class="section-title">🎛️ 3.2 矩阵：变换的"配方"</h2>

    <div class="content-block">
        <div class="aha-box">
            <div class="aha-title">核心洞察</div>
            <p>
                要完全确定一个线性变换，你<strong>只需要知道基向量去了哪里</strong>！
            </p>
            <p>因为所有向量都是基向量的线性组合，知道了"积木"去哪了，整个空间的变化就确定了。</p>
        </div>

        <div class="theorem-card">
            <div class="theorem-title">🔮 矩阵的秘密</div>
            <p><span class="term" data-en="Matrix">矩阵</span>的列，就是变换后的基向量！</p>
            <div style="display: flex; justify-content: center; margin: 1rem 0;">
                <div style="font-size: 1.3rem;">
                    $\begin{bmatrix} \color{#f97316}{a} & \color{#10b981}{b} \\ \color{#f97316}{c} & \color{#10b981}{d}
                    \end{bmatrix}$
                </div>
            </div>
            <p style="text-align: center;">
                <span style="color:#f97316">第1列 (a,c)</span> = î 变换后的位置<br>
                <span style="color:#10b981">第2列 (b,d)</span> = ĵ 变换后的位置
            </p>
        </div>

        <div class="example-ladder">
            <div class="example-step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <div class="step-label">旋转 90°</div>
                    <p>î → (0,1), ĵ → (-1,0)</p>
                    <p>矩阵：$\begin{bmatrix} 0 & -1 \\ 1 & 0 \end{bmatrix}$</p>
                </div>
            </div>
            <div class="example-step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <div class="step-label">水平翻转</div>
                    <p>î → (-1,0), ĵ → (0,1)</p>
                    <p>矩阵：$\begin{bmatrix} -1 & 0 \\ 0 & 1 \end{bmatrix}$</p>
                </div>
            </div>
            <div class="example-step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <div class="step-label">放大 2 倍</div>
                    <p>î → (2,0), ĵ → (0,2)</p>
                    <p>矩阵：$\begin{bmatrix} 2 & 0 \\ 0 & 2 \end{bmatrix}$</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- SECTION 3: 交互 -->
<div class="section fade-in">
    <h2 class="section-title">🕹️ 3.3 动手玩变换</h2>

    <div class="viz-container">
        <div class="viz-header">
            <span class="viz-title">变形工厂</span>
            <span class="viz-badge" style="background: var(--accent-purple);">互动实验</span>
        </div>
        <div class="viz-canvas-wrapper" style="height: 450px;">
            <canvas id="viz-matrix-transform" style="width: 100%; height: 100%;"></canvas>
        </div>
        <div class="viz-controls">
            <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; margin-bottom: 1rem;">
                <button class="btn btn-secondary" id="btn-shear">📐 剪切</button>
                <button class="btn btn-secondary" id="btn-rotate">🔄 旋转 45°</button>
                <button class="btn btn-secondary" id="btn-scale">🔍 放大 2x</button>
            </div>
            <div style="display: flex; gap: 1rem; justify-content: center; align-items: center;">
                <span>矩阵 =</span>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; max-width: 100px;">
                    <input type="number" id="val-a" value="1" step="0.1"
                        style="width: 40px; text-align: center; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 4px; color: #f97316; font-weight: bold;">
                    <input type="number" id="val-b" value="0" step="0.1"
                        style="width: 40px; text-align: center; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 4px; color: #10b981; font-weight: bold;">
                    <input type="number" id="val-c" value="0" step="0.1"
                        style="width: 40px; text-align: center; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 4px; color: #f97316; font-weight: bold;">
                    <input type="number" id="val-d" value="1" step="0.1"
                        style="width: 40px; text-align: center; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 4px; color: #10b981; font-weight: bold;">
                </div>
            </div>
        </div>
    </div>

    <div class="challenge-box">
        <div class="challenge-title">挑战</div>
        <p>试试把左上角的数字改成 -1，看看会发生什么？这代表什么变换？</p>
    </div>

    <!-- 新增：练习题 -->
    <div class="challenge-box" style="margin-top: 2rem;">
        <div class="challenge-title">✍️ 动手练习</div>
        <p><strong>为下列变换写出对应的矩阵：</strong></p>
        <ol>
            <li>把所有东西放大 3 倍</li>
            <li>水平方向翻转（左右镜像）</li>
            <li>顺时针旋转 90°</li>
        </ol>
        <details style="margin-top: 1rem;">
            <summary style="cursor: pointer; color: var(--accent-blue); font-weight: bold;">👆 点击查看答案</summary>
            <div style="margin-top: 0.5rem; padding: 1rem; background: rgba(16, 185, 129, 0.1); border-radius: 8px;">
                <ol>
                    <li>$\begin{bmatrix} 3 & 0 \\ 0 & 3 \end{bmatrix}$ — î 变成 (3,0)，ĵ 变成 (0,3)</li>
                    <li>$\begin{bmatrix} -1 & 0 \\ 0 & 1 \end{bmatrix}$ — î 变成 (-1,0)，ĵ 不变</li>
                    <li>$\begin{bmatrix} 0 & 1 \\ -1 & 0 \end{bmatrix}$ — î 变成 (0,-1)，ĵ 变成 (1,0)</li>
                </ol>
                <p style="margin-top: 0.5rem; font-size: 0.9em; color: var(--text-muted);">
                    💡 方法：画出变换后的 î 和 ĵ，把它们作为矩阵的两列！
                </p>
            </div>
        </details>
    </div>

    <!-- 新增：思考题 -->
    <div class="challenge-box" style="margin-top: 2rem;">
        <div class="challenge-title">🤔 想一想</div>
        <p><strong>单位矩阵 $\begin{bmatrix} 1 & 0 \\ 0 & 1 \end{bmatrix}$ 代表什么变换？</strong></p>
        <details style="margin-top: 1rem;">
            <summary style="cursor: pointer; color: var(--accent-blue); font-weight: bold;">👆 点击查看答案</summary>
            <div style="margin-top: 0.5rem; padding: 1rem; background: rgba(16, 185, 129, 0.1); border-radius: 8px;">
                <p><strong>答案</strong>："什么都不做"——恒等变换！</p>
                <p>î → (1,0) = î，ĵ → (0,1) = ĵ，基向量都不动，所以整个空间不变。</p>
                <p style="margin-top: 0.5rem; font-size: 0.9em; color: var(--text-muted);">
                    🎯 这就像数字中的 1（任何数乘以 1 都不变），单位矩阵是矩阵乘法的"1"。
                </p>
            </div>
        </details>
    </div>

    <!-- 新增：常见误区 -->
    <div class="definition-card" style="border-left-color: var(--accent-orange); margin-top: 2rem;">
        <div class="definition-title" style="color: var(--accent-orange);">⚠️ 常见误区</div>
        <p><strong>误区</strong>："矩阵只是一堆按行列排列的数字"</p>
        <p><strong>纠正</strong>：矩阵是<strong>变换的描述</strong>！每一列告诉你一个基向量变去了哪里。</p>
        <p style="margin-top: 0.5rem;">
            把矩阵想象成"变形配方"或"游戏手柄"——它控制着空间如何被扭曲和变形。
        </p>
    </div>

    <!-- 新增：趣味知识 -->
    <div class="deep-dive" style="margin-top: 2rem; border-left: 4px solid var(--accent-purple);">
        <div class="deep-title">🎬 趣味知识：电影特效中的矩阵</div>
        <p>
            好莱坞电影中的 3D 角色动画，全部由矩阵来控制！
        </p>
        <p style="margin-top: 0.5rem;">
            当皮克斯动画的角色抬起手臂时，计算机在幕后用一系列矩阵来计算每一根骨骼、每一块皮肤应该移动到哪里。
            一部动画电影可能有<strong>数百亿次矩阵运算</strong>！
        </p>
    </div>
</div>

<!-- 应用 -->
<div class="section fade-in">
    <h2 class="section-title">🌍 3.4 矩阵在现实中的应用</h2>

    <div class="real-world">
        <div class="real-world-item">
            <div class="rw-icon">🎮</div>
            <div class="rw-title">游戏角色</div>
            <div class="rw-desc">旋转、缩放、移动</div>
        </div>
        <div class="real-world-item">
            <div class="rw-icon">📷</div>
            <div class="rw-title">图像处理</div>
            <div class="rw-desc">滤镜、变形效果</div>
        </div>
        <div class="real-world-item">
            <div class="rw-icon">🤖</div>
            <div class="rw-title">机器人</div>
            <div class="rw-desc">关节运动控制</div>
        </div>
        <div class="real-world-item">
            <div class="rw-icon">📊</div>
            <div class="rw-title">数据分析</div>
            <div class="rw-desc">降维、特征变换</div>
        </div>
    </div>
</div>

<!-- ==================== 实战应用 ==================== -->
<div class="section fade-in">
    <h2 class="section-title">🎯 实战应用：用矩阵变换解决真实问题</h2>

    <div class="content-block">
        <p style="font-size: 1.1rem; margin-bottom: 2rem;">
            矩阵变换是计算机图形学的核心。每当你旋转一张图片、缩放一个游戏角色，背后都是矩阵在工作！
        </p>

        <!-- 问题 1：图片旋转 -->
        <div class="deep-dive" style="border-left: 4px solid var(--accent-blue); margin-bottom: 2rem;">
            <div class="deep-title">📷 问题 1：旋转一张图片</div>

            <div style="background: rgba(74, 158, 255, 0.05); padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                <p><strong>场景</strong>：你需要把一张图片<strong>逆时针旋转 90°</strong>。图片上有一个点 P 位于 $(3, 1)$。</p>
                <p><strong>问题</strong>：旋转后，点 P 会在什么位置？</p>
            </div>

            <div class="example-ladder">
                <div class="example-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <div class="step-label">识别概念：旋转 = 线性变换</div>
                        <p>逆时针旋转 90° 的矩阵：$\hat{i}$ 变成 $(0, 1)$，$\hat{j}$ 变成 $(-1, 0)$</p>
                        <div class="math-block">
                            $R_{90°} = \begin{bmatrix}0 & -1\\1 & 0\end{bmatrix}$
                        </div>
                    </div>
                </div>
                <div class="example-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <div class="step-label">应用变换：矩阵乘以向量</div>
                        <div class="math-block">
                            $R_{90°} \cdot P = \begin{bmatrix}0 & -1\\1 & 0\end{bmatrix}
                            \begin{bmatrix}3\\1\end{bmatrix} = \begin{bmatrix}0 \cdot 3 + (-1) \cdot 1\\1 \cdot 3 + 0
                            \cdot 1\end{bmatrix} = \begin{bmatrix}-1\\3\end{bmatrix}$
                        </div>
                    </div>
                </div>
                <div class="example-step">
                    <div class="step-number">✓</div>
                    <div class="step-content" style="background: rgba(16, 185, 129, 0.1);">
                        <div class="step-label" style="color: var(--accent-green);">答案</div>
                        <p>旋转后，点 P 移动到 <strong>(-1, 3)</strong>。</p>
                    </div>
                </div>
            </div>

            <div class="aha-box" style="margin-top: 1rem;">
                <div class="aha-title">💡 编程启示</div>
                <p>在 JavaScript Canvas 中，<code>ctx.rotate(angle)</code> 本质上就是在应用一个旋转矩阵！</p>
            </div>
        </div>

        <!-- 问题 2：游戏角色镜像 -->
        <div class="deep-dive" style="border-left: 4px solid var(--accent-orange); margin-bottom: 2rem;">
            <div class="deep-title">🎮 问题 2：角色翻转（镜像）</div>

            <div style="background: rgba(249, 115, 22, 0.05); padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                <p><strong>场景</strong>：在格斗游戏中，角色面向右边时使用原始贴图。当角色转向左边时，需要水平翻转贴图。</p>
                <p>角色的剑尖位于 $(2, 3)$（相对于角色中心）。</p>
                <p><strong>问题</strong>：水平翻转后，剑尖在什么位置？</p>
            </div>

            <div class="example-ladder">
                <div class="example-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <div class="step-label">识别概念：水平翻转 = 镜像变换</div>
                        <p>水平翻转矩阵：$\hat{i}$ 变成 $(-1, 0)$，$\hat{j}$ 不变</p>
                        <div class="math-block">
                            $M = \begin{bmatrix}-1 & 0\\0 & 1\end{bmatrix}$
                        </div>
                    </div>
                </div>
                <div class="example-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <div class="step-label">应用变换</div>
                        <div class="math-block">
                            $M \cdot \begin{bmatrix}2\\3\end{bmatrix} = \begin{bmatrix}-1 \cdot 2 + 0 \cdot 3\\0 \cdot 2
                            + 1 \cdot 3\end{bmatrix} = \begin{bmatrix}-2\\3\end{bmatrix}$
                        </div>
                    </div>
                </div>
                <div class="example-step">
                    <div class="step-number">✓</div>
                    <div class="step-content" style="background: rgba(16, 185, 129, 0.1);">
                        <div class="step-label" style="color: var(--accent-green);">答案</div>
                        <p>翻转后，剑尖在 <strong>(-2, 3)</strong>。X 坐标取反，Y 坐标不变。</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 问题 3：剪切变形 -->
        <div class="deep-dive" style="border-left: 4px solid var(--accent-purple);">
            <div class="deep-title">✍️ 问题 3：意大利斜体效果</div>

            <div style="background: rgba(139, 92, 246, 0.05); padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                <p><strong>场景</strong>：你想用"剪切"变换模拟斜体字效果。剪切系数为 0.3（每上升 1 单位，水平向右移动 0.3 单位）。</p>
                <p>字母顶部的一个点在 $(0, 2)$。</p>
                <p><strong>问题</strong>：剪切后这个点在哪里？</p>
            </div>

            <div class="example-ladder">
                <div class="example-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <div class="step-label">构建剪切矩阵</div>
                        <p>水平剪切：$\hat{i}$ 不变，$\hat{j}$ 变成 $(k, 1)$，其中 $k=0.3$</p>
                        <div class="math-block">
                            $S = \begin{bmatrix}1 & 0.3\\0 & 1\end{bmatrix}$
                        </div>
                    </div>
                </div>
                <div class="example-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <div class="step-label">应用变换</div>
                        <div class="math-block">
                            $S \cdot \begin{bmatrix}0\\2\end{bmatrix} = \begin{bmatrix}1 \cdot 0 + 0.3 \cdot 2\\0 \cdot
                            0 + 1 \cdot 2\end{bmatrix} = \begin{bmatrix}0.6\\2\end{bmatrix}$
                        </div>
                    </div>
                </div>
                <div class="example-step">
                    <div class="step-number">✓</div>
                    <div class="step-content" style="background: rgba(16, 185, 129, 0.1);">
                        <div class="step-label" style="color: var(--accent-green);">答案</div>
                        <p>剪切后，点移动到 <strong>(0.6, 2)</strong>。高度不变，但向右倾斜了。</p>
                    </div>
                </div>
            </div>

            <div class="aha-box" style="margin-top: 1rem;">
                <div class="aha-title">💡 这就是 CSS 的 skew!</div>
                <p>CSS 的 <code>transform: skewX(angle)</code> 本质上就是应用一个剪切矩阵。</p>
            </div>
        </div>

        <!-- 挑战题 -->
        <div class="challenge-box" style="margin-top: 2rem;">
            <div class="challenge-title">🚀 挑战：组合变换</div>
            <p><strong>问题</strong>：先放大 2 倍，再逆时针旋转 90°。点 $(1, 0)$ 最终会在哪里？</p>
            <details style="margin-top: 1rem;">
                <summary style="cursor: pointer; color: var(--accent-blue); font-weight: bold;">👆 点击查看答案</summary>
                <div
                    style="margin-top: 0.5rem; padding: 1rem; background: rgba(16, 185, 129, 0.1); border-radius: 8px;">
                    <p>放大 2 倍：$(1, 0) \rightarrow (2, 0)$</p>
                    <p>旋转 90°：$(2, 0) \rightarrow (0, 2)$</p>
                    <p>答案：<strong>(0, 2)</strong></p>
                </div>
            </details>
        </div>

    </div>
</div>

<!-- 总结 -->
<div class="section fade-in">
    <h2 class="section-title">🎯 本章收获</h2>

    <div class="content-block">
        <div class="theorem-card">
            <div class="theorem-title">核心要点</div>
            <ol style="margin: 0; padding-left: 1.5rem; line-height: 2.2;">
                <li><span class="term" data-en="Linear Transformation">线性变换</span>：保持直线和原点的"变形"</li>
                <li><span class="term" data-en="Matrix">矩阵</span>的列 = 变换后的基向量</li>
                <li>知道基向量去哪了，整个变换就确定了</li>
            </ol>
        </div>

        <div class="aha-box">
            <div class="aha-title">思维升级</div>
            <p>下次看到矩阵时，不要想"一堆数字"——要想"<strong>这是一个变形魔法！</strong>"</p>
        </div>
    </div>
</div>