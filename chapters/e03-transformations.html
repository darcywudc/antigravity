<div class="chapter-header fade-in">
    <span class="chapter-badge">Chapter 3</span>
    <h1 class="chapter-title">线性变换与矩阵 <br><small style="font-size: 0.6em; color: var(--text-muted);">Linear
            Transformations and Matrices</small></h1>
    <p class="chapter-description">
        "矩阵"不仅仅是一个装满数字的这种方块。它是对"空间变换"的一种描述。
        一旦你接受了"矩阵即变换"的观点，线性代数的大门就真正为你打开了。
    </p>
</div>

<!-- SECTION 1: What is a Linear Transformation? -->
<div class="section fade-in">
    <h2 class="section-title">3.1 什么是"线性变换"？ (What is a Linear Transformation?)</h2>
    <div class="content-block">
        <p>
            你可以把"变换"想象成一个<strong>函数</strong>。它输入一个向量，然后输出另一个向量。
            $$ \vec{v}_{out} = T(\vec{v}_{in}) $$
        </p>

        <div style="display: flex; flex-wrap: wrap; gap: 2rem; margin: 2rem 0; align-items: center;">
            <div style="flex: 1; min-width: 300px;">
                <p>
                    但不是所有的变换都是"线性"的。要成为线性变换，它必须满足两个直观的几何规则：
                </p>
                <div class="definition-card" style="border-left: 4px solid var(--accent-blue);">
                    <ul style="margin: 0; padding-left: 1.2rem;">
                        <li style="margin-bottom: 0.8rem;">
                            <strong>原点固定不动</strong> (The origin remains fixed)。
                            <br><small style="color:var(--text-muted)">如果你把原点挪走了，这就不叫线性变换（那是仿射变换）。</small>
                        </li>
                        <li>
                            <strong>网格线保持平行且等距</strong> (Grid lines remain parallel and evenly spaced)。
                            <br><small style="color:var(--text-muted)">它可以拉伸、旋转、剪切，但不能弯曲。</small>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Visual: Linear vs Non-Linear -->
            <div style="flex: 1; min-width: 300px; display: flex; gap: 1rem; justify-content: center;">
                <div style="text-align: center;">
                    <svg width="140" height="140" viewBox="0 0 140 140"
                        style="background: rgba(255,255,255,0.05); border-radius: 8px;">
                        <!-- Linear Shear -->
                        <g stroke="rgba(74, 158, 255, 0.5)" stroke-width="1">
                            <line x1="20" y1="20" x2="60" y2="20" />
                            <line x1="10" y1="60" x2="90" y2="60" />
                            <line x1="0" y1="100" x2="120" y2="100" />
                            <!-- Vertical (Sheared) -->
                            <line x1="20" y1="20" x2="0" y2="100" />
                            <line x1="60" y1="20" x2="40" y2="100" />
                            <line x1="100" y1="20" x2="80" y2="100" />
                        </g>
                        <circle cx="0" cy="140" r="0" /> <!-- Origin Ref fix -->
                        <text x="70" y="125" fill="#4a9eff" font-size="12" text-anchor="middle">Linear (OK)</text>
                    </svg>
                </div>
                <div style="text-align: center;">
                    <svg width="140" height="140" viewBox="0 0 140 140"
                        style="background: rgba(255,255,255,0.05); border-radius: 8px;">
                        <!-- Non-Linear Curve -->
                        <path d="M 20 20 Q 70 50 120 20" stroke="rgba(236, 72, 153, 0.5)" fill="none" />
                        <path d="M 20 60 Q 70 90 120 60" stroke="rgba(236, 72, 153, 0.5)" fill="none" />
                        <path d="M 20 100 Q 70 130 120 100" stroke="rgba(236, 72, 153, 0.5)" fill="none" />

                        <path d="M 20 20 Q 50 70 20 120" stroke="rgba(236, 72, 153, 0.5)" fill="none" />
                        <path d="M 60 20 Q 90 70 60 120" stroke="rgba(236, 72, 153, 0.5)" fill="none" />
                        <path d="M 100 20 Q 130 70 100 120" stroke="rgba(236, 72, 153, 0.5)" fill="none" />
                        <text x="70" y="125" fill="#ec4899" font-size="12" text-anchor="middle">Non-Linear (No)</text>
                    </svg>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- SECTION 2: Matrices as Descriptions -->
<div class="section fade-in">
    <h2 class="section-title">3.2 矩阵是变换的数字语言</h2>
    <div class="content-block">
        <div class="theorem-card">
            <div class="theorem-title">核心洞察：追踪基向量 (Track the Basis)</div>
            <p>
                如果你想描述一个线性变换，你只需要记录<strong>两个向量</strong>的去向：
                基向量 $\hat{i}$ 和 $\hat{j}$ 变换后的位置。
            </p>
        </div>

        <div style="display: flex; gap: 2rem; align-items: center; margin: 2rem 0; flex-wrap: wrap;">
            <div style="flex: 1; min-width: 300px; text-align: center;">
                <div style="font-size: 1.5rem; margin-bottom: 1rem;">
                    $$ A = \left[ \begin{array}{c|c} \color{#f97316}{\hat{i}_{new}} & \color{#10b981}{\hat{j}_{new}}
                    \end{array} \right] = \begin{bmatrix} a & b \\ c & d \end{bmatrix} $$
                </div>
                <p style="color: var(--text-secondary); font-size: 0.9em;">
                    矩阵的<strong>第一列</strong>就是 $\hat{i}$ 落地的地方。<br>
                    矩阵的<strong>第二列</strong>就是 $\hat{j}$ 落地的地方。
                </p>
            </div>
        </div>
    </div>

    <!-- Interactive Visualization -->
    <div class="viz-container">
        <div class="viz-header">
            <span class="viz-title">交互演示：观察基向量的运动</span>
            <span class="viz-badge">Core Visual</span>
        </div>
        <div class="viz-canvas-wrapper" style="height: 500px;">
            <canvas id="viz-matrix-transform" style="width: 100%; height: 100%;"></canvas>
        </div>
        <div class="viz-controls">
            <div style="display: flex; gap: 1rem; justify-content: center; margin-bottom: 1rem;">
                <!-- Buttons trigger animations in JS -->
                <button class="btn btn-secondary" id="btn-shear">剪切 (Shear)</button>
                <button class="btn btn-secondary" id="btn-rotate">旋转 (Rotate)</button>
                <button class="btn btn-secondary" id="btn-scale">缩放 (Scale)</button>
            </div>

            <div style="display: flex; gap: 2rem; justify-content: center; align-items: center;">
                <div class="matrix-input">
                    <div style="text-align: center; color: var(--text-muted); font-size: 0.8em; margin-bottom: 0.5rem;">
                        Transformed Basis <br> (Matrix A)
                    </div>
                    <div class="matrix-grid">
                        <input type="number" class="matrix-cell" id="val-a" value="1" step="0.1"
                            style="color:#f97316; font-weight:bold;">
                        <input type="number" class="matrix-cell" id="val-b" value="0" step="0.1"
                            style="color:#10b981; font-weight:bold;">
                        <input type="number" class="matrix-cell" id="val-c" value="0" step="0.1"
                            style="color:#f97316; font-weight:bold;">
                        <input type="number" class="matrix-cell" id="val-d" value="1" step="0.1"
                            style="color:#10b981; font-weight:bold;">
                    </div>
                </div>
            </div>
            <p style="text-align: center; margin-top: 1rem; color: var(--text-secondary); font-size: 0.9em;">
                提示：手动修改上面的矩阵数值，看看网格如何变化。
            </p>
        </div>
    </div>
</div>

<!-- SECTION 3: Why it works -->
<div class="section fade-in">
    <h2 class="section-title">3.3 为什么这有效？ (The Linear Property)</h2>
    <div class="content-block">
        <p>
            为什么只需要两个向量就能描述整个平面的变换？因为任何向量 $\vec{v}$ 都是 $\hat{i}$ 和 $\hat{j}$ 的线性组合。
        </p>
        <div class="math-block">
            如果 $\vec{v} = x\hat{i} + y\hat{j}$
            <br><br>
            那么 $T(\vec{v}) = x \cdot T(\hat{i}) + y \cdot T(\hat{j})$
        </div>
        <p>
            这就是所谓的<strong>线性性质</strong>。你知道了基向量的去向，你就知道了宇宙中一切事物的去向。
        </p>
    </div>
</div>