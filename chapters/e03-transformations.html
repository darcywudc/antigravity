<div class="chapter-header fade-in">
    <span class="chapter-badge">第 3 章</span>
    <h1 class="chapter-title">矩阵：空间的变形术 <br><small style="font-size: 0.6em; color: var(--text-muted);">Linear
            Transformations & Matrices</small></h1>
    <p class="chapter-description">
        如果你能把整个空间像橡皮泥一样拉伸、旋转、翻转，世界会变成什么样？
        矩阵就是控制这种"变形"的遥控器！
    </p>
</div>

<!-- 核心词汇 -->
<div class="section fade-in">
    <div class="vocab-summary">
        <div class="vocab-title">本章核心词汇</div>
        <div class="vocab-list">
            <div class="vocab-item"><span class="vocab-zh">线性变换</span><span class="vocab-en">Linear
                    Transformation</span></div>
            <div class="vocab-item"><span class="vocab-zh">矩阵</span><span class="vocab-en">Matrix</span></div>
            <div class="vocab-item"><span class="vocab-zh">旋转</span><span class="vocab-en">Rotation</span></div>
            <div class="vocab-item"><span class="vocab-zh">剪切</span><span class="vocab-en">Shear</span></div>
            <div class="vocab-item"><span class="vocab-zh">缩放</span><span class="vocab-en">Scaling</span></div>
        </div>
    </div>
</div>

<!-- SECTION 1 -->
<div class="section fade-in">
    <h2 class="section-title">🔄 3.1 什么是线性变换？</h2>

    <div class="content-block">
        <h3>📷 类比：照片滤镜</h3>
        <p>你用手机拍完照后可以加滤镜：</p>
        <ul>
            <li>放大照片 → <span class="term" data-en="Scaling">缩放</span></li>
            <li>旋转照片 → <span class="term" data-en="Rotation">旋转</span></li>
            <li>镜像翻转 → <span class="term" data-en="Reflection">反射</span></li>
            <li>倾斜照片 → <span class="term" data-en="Shear">剪切</span></li>
        </ul>
        <p>这些都是<span class="term" data-en="Linear Transformation">线性变换</span>的例子！</p>

        <div class="theorem-card">
            <div class="theorem-title">🔑 线性变换的两条规则</div>
            <ol>
                <li><strong>原点不动</strong>：中心永远是中心</li>
                <li><strong>直线保持为直线</strong>：不能把直线弯成曲线，网格线保持平行</li>
            </ol>
        </div>

        <div style="display: flex; gap: 2rem; justify-content: center; margin: 2rem 0; flex-wrap: wrap;">
            <div style="text-align: center;">
                <svg width="120" height="100" viewBox="0 0 120 100">
                    <g stroke="#4a9eff" stroke-width="1" fill="none">
                        <line x1="20" y1="20" x2="20" y2="80" />
                        <line x1="50" y1="20" x2="50" y2="80" />
                        <line x1="80" y1="20" x2="80" y2="80" />
                        <line x1="20" y1="20" x2="80" y2="20" />
                        <line x1="20" y1="50" x2="80" y2="50" />
                        <line x1="20" y1="80" x2="80" y2="80" />
                    </g>
                </svg>
                <p style="color: var(--accent-green);">✅ 线性变换</p>
            </div>
            <div style="text-align: center;">
                <svg width="120" height="100" viewBox="0 0 120 100">
                    <g stroke="#ec4899" stroke-width="1" fill="none">
                        <path d="M 20 20 Q 50 30, 80 20" />
                        <path d="M 20 50 Q 50 40, 80 50" />
                        <path d="M 20 80 Q 50 70, 80 80" />
                    </g>
                </svg>
                <p style="color: #ec4899;">❌ 非线性（线弯了）</p>
            </div>
        </div>
    </div>
</div>

<!-- SECTION 2 -->
<div class="section fade-in">
    <h2 class="section-title">🎛️ 3.2 矩阵：变换的"配方"</h2>

    <div class="content-block">
        <div class="aha-box">
            <div class="aha-title">核心洞察</div>
            <p>
                要完全确定一个线性变换，你<strong>只需要知道基向量去了哪里</strong>！
            </p>
            <p>因为所有向量都是基向量的线性组合，知道了"积木"去哪了，整个空间的变化就确定了。</p>
        </div>

        <div class="theorem-card">
            <div class="theorem-title">🔮 矩阵的秘密</div>
            <p><span class="term" data-en="Matrix">矩阵</span>的列，就是变换后的基向量！</p>
            <div style="display: flex; justify-content: center; margin: 1rem 0;">
                <div style="font-size: 1.3rem;">
                    $\begin{bmatrix} \color{#f97316}{a} & \color{#10b981}{b} \\ \color{#f97316}{c} & \color{#10b981}{d}
                    \end{bmatrix}$
                </div>
            </div>
            <p style="text-align: center;">
                <span style="color:#f97316">第1列 (a,c)</span> = î 变换后的位置<br>
                <span style="color:#10b981">第2列 (b,d)</span> = ĵ 变换后的位置
            </p>
        </div>

        <div class="example-ladder">
            <div class="example-step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <div class="step-label">旋转 90°</div>
                    <p>î → (0,1), ĵ → (-1,0)</p>
                    <p>矩阵：$\begin{bmatrix} 0 & -1 \\ 1 & 0 \end{bmatrix}$</p>
                </div>
            </div>
            <div class="example-step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <div class="step-label">水平翻转</div>
                    <p>î → (-1,0), ĵ → (0,1)</p>
                    <p>矩阵：$\begin{bmatrix} -1 & 0 \\ 0 & 1 \end{bmatrix}$</p>
                </div>
            </div>
            <div class="example-step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <div class="step-label">放大 2 倍</div>
                    <p>î → (2,0), ĵ → (0,2)</p>
                    <p>矩阵：$\begin{bmatrix} 2 & 0 \\ 0 & 2 \end{bmatrix}$</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- SECTION 3: 交互 -->
<div class="section fade-in">
    <h2 class="section-title">🕹️ 3.3 动手玩变换</h2>

    <div class="viz-container">
        <div class="viz-header">
            <span class="viz-title">变形工厂</span>
            <span class="viz-badge" style="background: var(--accent-purple);">互动实验</span>
        </div>
        <div class="viz-canvas-wrapper" style="height: 450px;">
            <canvas id="viz-matrix-transform" style="width: 100%; height: 100%;"></canvas>
        </div>
        <div class="viz-controls">
            <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; margin-bottom: 1rem;">
                <button class="btn btn-secondary" id="btn-shear">📐 剪切</button>
                <button class="btn btn-secondary" id="btn-rotate">🔄 旋转 45°</button>
                <button class="btn btn-secondary" id="btn-scale">🔍 放大 2x</button>
            </div>
            <div style="display: flex; gap: 1rem; justify-content: center; align-items: center;">
                <span>矩阵 =</span>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; max-width: 100px;">
                    <input type="number" id="val-a" value="1" step="0.1"
                        style="width: 40px; text-align: center; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 4px; color: #f97316; font-weight: bold;">
                    <input type="number" id="val-b" value="0" step="0.1"
                        style="width: 40px; text-align: center; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 4px; color: #10b981; font-weight: bold;">
                    <input type="number" id="val-c" value="0" step="0.1"
                        style="width: 40px; text-align: center; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 4px; color: #f97316; font-weight: bold;">
                    <input type="number" id="val-d" value="1" step="0.1"
                        style="width: 40px; text-align: center; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 4px; color: #10b981; font-weight: bold;">
                </div>
            </div>
        </div>
    </div>

    <div class="challenge-box">
        <div class="challenge-title">挑战</div>
        <p>试试把左上角的数字改成 -1，看看会发生什么？这代表什么变换？</p>
    </div>
</div>

<!-- 应用 -->
<div class="section fade-in">
    <h2 class="section-title">🌍 3.4 矩阵在现实中的应用</h2>

    <div class="real-world">
        <div class="real-world-item">
            <div class="rw-icon">🎮</div>
            <div class="rw-title">游戏角色</div>
            <div class="rw-desc">旋转、缩放、移动</div>
        </div>
        <div class="real-world-item">
            <div class="rw-icon">📷</div>
            <div class="rw-title">图像处理</div>
            <div class="rw-desc">滤镜、变形效果</div>
        </div>
        <div class="real-world-item">
            <div class="rw-icon">🤖</div>
            <div class="rw-title">机器人</div>
            <div class="rw-desc">关节运动控制</div>
        </div>
        <div class="real-world-item">
            <div class="rw-icon">📊</div>
            <div class="rw-title">数据分析</div>
            <div class="rw-desc">降维、特征变换</div>
        </div>
    </div>
</div>

<!-- 总结 -->
<div class="section fade-in">
    <h2 class="section-title">🎯 本章收获</h2>

    <div class="content-block">
        <div class="theorem-card">
            <div class="theorem-title">核心要点</div>
            <ol style="margin: 0; padding-left: 1.5rem; line-height: 2.2;">
                <li><span class="term" data-en="Linear Transformation">线性变换</span>：保持直线和原点的"变形"</li>
                <li><span class="term" data-en="Matrix">矩阵</span>的列 = 变换后的基向量</li>
                <li>知道基向量去哪了，整个变换就确定了</li>
            </ol>
        </div>

        <div class="aha-box">
            <div class="aha-title">思维升级</div>
            <p>下次看到矩阵时，不要想"一堆数字"——要想"<strong>这是一个变形魔法！</strong>"</p>
        </div>
    </div>
</div>