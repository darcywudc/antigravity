<div class="chapter-header fade-in">
    <span class="chapter-badge">第 3 章</span>
    <h1 class="chapter-title">变形金刚的数学 <br><small style="font-size: 0.6em; color: var(--text-muted);">Linear
            Transformations</small></h1>
    <p class="chapter-description">
        如果你能把整个空间像橡皮泥一样拉伸、旋转、翻转，世界会变成什么样？
        矩阵就是这种"变形"的遥控器！
    </p>
</div>

<!-- ==================== SECTION 1: 变换是什么 ==================== -->
<div class="section fade-in">
    <h2 class="section-title">🔄 3.1 空间可以被"变形"</h2>

    <div class="content-block">
        <h3>📷 滤镜类比</h3>
        <p>
            你用手机拍照后，可以加滤镜：
        </p>
        <ul>
            <li>放大照片 → <strong>缩放</strong></li>
            <li>旋转照片 → <strong>旋转</strong></li>
            <li>镜像翻转 → <strong>反射</strong></li>
            <li>倾斜照片 → <strong>剪切</strong></li>
        </ul>
        <p>
            这些都是<strong>线性变换</strong>——把空间中的每个点移动到新位置的操作。
        </p>

        <div class="theorem-card">
            <div class="theorem-title">🎯 线性变换的规则</div>
            <p>
                只有两条规则：
            </p>
            <ol>
                <li><strong>原点不动</strong>（中心始终是中心）</li>
                <li><strong>直线保持为直线</strong>（不能把直线弯成曲线）</li>
            </ol>
        </div>
    </div>

    <!-- 对比图 -->
    <div style="display: flex; gap: 2rem; justify-content: center; margin: 2rem 0; flex-wrap: wrap;">
        <div style="text-align: center;">
            <svg width="140" height="120" viewBox="0 0 140 120">
                <g stroke="#4a9eff" stroke-width="1.5" fill="none">
                    <line x1="20" y1="100" x2="120" y2="100" />
                    <line x1="20" y1="60" x2="120" y2="60" />
                    <line x1="20" y1="20" x2="120" y2="20" />
                    <line x1="40" y1="10" x2="60" y2="110" />
                    <line x1="80" y1="10" x2="100" y2="110" />
                </g>
                <circle cx="40" cy="100" r="3" fill="#10b981" />
            </svg>
            <p style="color: var(--accent-blue);">✅ 线性变换</p>
            <p style="font-size: 0.85em; color: var(--text-muted);">网格保持平行</p>
        </div>

        <div style="text-align: center;">
            <svg width="140" height="120" viewBox="0 0 140 120">
                <g stroke="#ec4899" stroke-width="1.5" fill="none">
                    <path d="M 20 100 Q 70 90, 120 100" />
                    <path d="M 20 60 Q 70 40, 120 60" />
                    <path d="M 20 20 Q 70 10, 120 20" />
                    <path d="M 40 10 Q 50 60, 55 110" />
                    <path d="M 100 10 Q 90 60, 85 110" />
                </g>
                <circle cx="40" cy="100" r="3" fill="#10b981" />
            </svg>
            <p style="color: #ec4899;">❌ 非线性变换</p>
            <p style="font-size: 0.85em; color: var(--text-muted);">线被弯曲了</p>
        </div>
    </div>
</div>

<!-- ==================== SECTION 2: 矩阵的秘密 ==================== -->
<div class="section fade-in">
    <h2 class="section-title">🎛️ 3.2 矩阵：变形的"配方"</h2>

    <div class="content-block">
        <h3>🕹️ 游戏控制器类比</h3>
        <p>
            想象矩阵是一个游戏控制器，有 4 个按钮：
        </p>

        <div style="display: flex; justify-content: center; margin: 2rem 0;">
            <div style="background: var(--bg-tertiary); padding: 2rem; border-radius: 16px; text-align: center;">
                <div
                    style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; font-size: 1.5rem; font-family: monospace;">
                    <div style="background: #f97316; color: white; padding: 1rem; border-radius: 8px;">a</div>
                    <div style="background: #10b981; color: white; padding: 1rem; border-radius: 8px;">b</div>
                    <div style="background: #f97316; color: white; padding: 1rem; border-radius: 8px;">c</div>
                    <div style="background: #10b981; color: white; padding: 1rem; border-radius: 8px;">d</div>
                </div>
                <p style="margin-top: 1rem; font-size: 1.2rem;">
                    $\begin{bmatrix} a & b \\ c & d \end{bmatrix}$
                </p>
            </div>
        </div>

        <div class="theorem-card">
            <div class="theorem-title">🔮 矩阵的秘密</div>
            <p>
                <span style="color:#f97316">第一列 (a, c)</span> = î（向右的箭头）会变到哪里<br>
                <span style="color:#10b981">第二列 (b, d)</span> = ĵ（向上的箭头）会变到哪里
            </p>
            <p style="margin-top: 1rem; font-size: 0.95em;">
                只要知道两个基向量去了哪里，整个空间的变换就确定了！
            </p>
        </div>
    </div>
</div>

<!-- ==================== SECTION 3: 常见变换 ==================== -->
<div class="section fade-in">
    <h2 class="section-title">🎨 3.3 常见变换图鉴</h2>

    <div class="content-block">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1.5rem;">
            <div class="definition-card">
                <div class="definition-title">🔄 旋转 90°</div>
                <div style="text-align: center; margin: 0.5rem 0;">
                    $\begin{bmatrix} 0 & -1 \\ 1 & 0 \end{bmatrix}$
                </div>
                <p style="font-size: 0.85em; color: var(--text-secondary);">
                    î 变成 ĵ，ĵ 变成 -î
                </p>
            </div>

            <div class="definition-card">
                <div class="definition-title">↔️ 水平翻转</div>
                <div style="text-align: center; margin: 0.5rem 0;">
                    $\begin{bmatrix} -1 & 0 \\ 0 & 1 \end{bmatrix}$
                </div>
                <p style="font-size: 0.85em; color: var(--text-secondary);">
                    î 反向，ĵ 不变
                </p>
            </div>

            <div class="definition-card">
                <div class="definition-title">📐 剪切</div>
                <div style="text-align: center; margin: 0.5rem 0;">
                    $\begin{bmatrix} 1 & 1 \\ 0 & 1 \end{bmatrix}$
                </div>
                <p style="font-size: 0.85em; color: var(--text-secondary);">
                    î 不变，ĵ 向右倾斜
                </p>
            </div>

            <div class="definition-card">
                <div class="definition-title">🔍 放大 2 倍</div>
                <div style="text-align: center; margin: 0.5rem 0;">
                    $\begin{bmatrix} 2 & 0 \\ 0 & 2 \end{bmatrix}$
                </div>
                <p style="font-size: 0.85em; color: var(--text-secondary);">
                    î 和 ĵ 都变成 2 倍长
                </p>
            </div>
        </div>
    </div>
</div>

<!-- ==================== SECTION 4: 交互 ==================== -->
<div class="section fade-in">
    <h2 class="section-title">🕹️ 3.4 动手玩变换</h2>

    <div class="viz-container">
        <div class="viz-header">
            <span class="viz-title">变形工厂</span>
            <span class="viz-badge" style="background: var(--accent-purple);">超级好玩</span>
        </div>
        <div class="viz-canvas-wrapper" style="height: 450px;">
            <canvas id="viz-matrix-transform" style="width: 100%; height: 100%;"></canvas>
        </div>
        <div class="viz-controls">
            <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; margin-bottom: 1.5rem;">
                <button class="btn btn-secondary" id="btn-shear">📐 剪切</button>
                <button class="btn btn-secondary" id="btn-rotate">🔄 旋转 45°</button>
                <button class="btn btn-secondary" id="btn-scale">🔍 放大 2x</button>
            </div>

            <div style="display: flex; gap: 2rem; justify-content: center; align-items: center; flex-wrap: wrap;">
                <div style="text-align: center;">
                    <p style="margin: 0 0 0.5rem 0; font-size: 0.9em;">矩阵 =</p>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; max-width: 120px;">
                        <input type="number" id="val-a" value="1" step="0.1"
                            style="padding: 0.5rem; text-align: center; font-size: 1rem; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 4px; color: #f97316; font-weight: bold;">
                        <input type="number" id="val-b" value="0" step="0.1"
                            style="padding: 0.5rem; text-align: center; font-size: 1rem; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 4px; color: #10b981; font-weight: bold;">
                        <input type="number" id="val-c" value="0" step="0.1"
                            style="padding: 0.5rem; text-align: center; font-size: 1rem; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 4px; color: #f97316; font-weight: bold;">
                        <input type="number" id="val-d" value="1" step="0.1"
                            style="padding: 0.5rem; text-align: center; font-size: 1rem; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 4px; color: #10b981; font-weight: bold;">
                    </div>
                </div>
                <p style="font-size: 0.9em; color: var(--text-muted); max-width: 250px;">
                    试试输入不同的数字！<br>
                    比如把左上角改成 -1 会怎样？
                </p>
            </div>
        </div>
    </div>
</div>

<!-- ==================== SECTION 5: 总结 ==================== -->
<div class="section fade-in">
    <h2 class="section-title">🎯 本章收获</h2>

    <div class="content-block">
        <div class="theorem-card">
            <div class="theorem-title">今天你学会了</div>
            <ol style="margin: 0; padding-left: 1.5rem; line-height: 2.2;">
                <li><strong>线性变换</strong> = 保持直线和原点的"变形"</li>
                <li><strong>矩阵</strong> = 变换的"配方"</li>
                <li>矩阵的两列告诉你 î 和 ĵ 分别去了哪里</li>
                <li>常见变换：旋转、缩放、剪切、翻转</li>
            </ol>
        </div>

        <div
            style="text-align: center; margin-top: 2rem; padding: 2rem; background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(59, 130, 246, 0.1)); border-radius: 12px;">
            <p style="font-size: 1.2rem; margin: 0;">
                🤯 <strong>思维升级</strong>
            </p>
            <p style="margin-top: 0.5rem;">
                下次看到一个矩阵时，不要想"一堆数字"，而要想"这是一个变形！"
            </p>
        </div>
    </div>
</div>